webpackJsonp([1],{"0For":function(e,t){},"7xIN":function(e,t){},"7yhV":function(e,t){},"9jAX":function(e,t){},Khgl:function(e,t){},LPdT:function(e,t){},"N+8p":function(e,t,a){e.exports=a.p+"static/img/Trinity.9d7f65f.png"},NHnr:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("7+uW"),s=a("TXMN"),o={name:"LeftNav",data:()=>({isLogin:!1,isNightMode:!1,navSelected:"1-1",isSignOutBoxShow:!1}),computed:{classObject:function(){return{"el-icon-ETH-yingwenyuyan":"cn"===this.$i18n.locale,"el-icon-ETH-zhongwenyuyan":"en"===this.$i18n.locale}}},watch:{isNightMode(e,t){console.log("当前夜间模式为"+e),this.$store.state.vuexStore.isNightMode=e,this.$parent.saveAsString("isNightMode",this.$store.state.vuexStore.isNightMode)},"$store.state.vuexStore.activeNavIndex":"storeToNav","$store.state.vuexStore.walletInfo.address":"getAddressInfo"},mounted(){this.$nextTick(function(){let e=this;e.isNightMode=e.$parent.fetchAsString("isNightMode"),e.$store.state.vuexStore.isLogin||e.$router.push("/start")})},methods:{switchLang(){"cn"===this.$i18n.locale?this.$i18n.locale="en":this.$i18n.locale="cn",this.$parent.saveAsString("lang",this.$i18n.locale)},switchNightMode(){!1===this.$store.state.vuexStore.isNightMode?this.$store.state.vuexStore.isNightMode=!0:this.$store.state.vuexStore.isNightMode=!1,this.$parent.saveAsString("isNightMode",this.$store.state.vuexStore.isNightMode)},switchNet(e){console.log("切换到"+e)},storeToNav(){this.navSelected=this.$store.state.vuexStore.activeNavIndex},selectItems(e){this.$store.state.vuexStore.activeNavIndex=e},toOtherForm(e){this.$store.state.vuexStore.isLogin&&""!=this.$store.state.vuexStore.isLogin?this.$router.push(e):this.$router.push("/start")},testFun(){let e={MessageType:"Rsmc",Sender:"0xDd1C2C608047Bd98962Abf15f9f074620f9d44bf@106.15.91.150:8089",Receiver:"0xDd1C2C608047Bd98962Abf15f9f074620f9d44bf@106.15.91.150:8089",TxNonce:1,ChannelName:1.2623152469958293e48,NetMagic:this.$store.state.vuexStore.NetMagic,MessageBody:{AssetType:"TNC",PaymentCount:2,SenderBalance:10,ReceiverBalance:10,Commitment:"0xDd1C2C608047Bd98962Abf15f9f074620f9d44bf0xDd1C2C608047Bd98962Abf15f9f074620f9d44bf"},Comments:{}};return this.$notify.info({title:"消息",duration:0,message:e.Sender.split("@")[0]+"正在向你转账,需要你解锁钱包,点击进行解锁",onClick:this.$parent.showReceiptInfoBox}),!1},getAddressInfo(){let e={messageType:"init",walletAddress:this.$store.state.vuexStore.walletInfo.address};this.$store.state.vuexStore.NodeUriWebSocket.send(JSON.stringify(e)),this.$store.state.vuexStore.channelList=this.$parent.fetchAsArray(this.$store.state.vuexStore.walletInfo.address+"@channelList"),this.$store.state.vuexStore.contactList=this.$parent.fetchAsArray(this.$store.state.vuexStore.walletInfo.address+"@contactList"),this.$store.state.vuexStore.recordList=this.$parent.fetchAsArray(this.$store.state.vuexStore.walletInfo.address+"@recordList"),this.getBalance(),this.cycleReconnectWebsocket()},getBalance(){this.getEthBalance(),this.getTncBalance(),this.$parent.getChannelBalance()},getEthBalance(){let e=this;e.$store.state.vuexStore.walletInfo.address&&web3.utils.checkAddressChecksum(e.$store.state.vuexStore.walletInfo.address)&&web3.eth.getBalance(e.$store.state.vuexStore.walletInfo.address).then(function(t){console.log(t);let a=web3.utils.fromWei(web3.utils.hexToNumberString(t));console.log(a),e.$store.state.vuexStore.balanceData.Chain.ETH=e.$parent.keepDecimalPlaces(a,3)})},getTncBalance(){let e=this;new web3.eth.Contract(e.$store.state.vuexStore.tncContractAbi,e.$store.state.vuexStore.tncContractAddress,{from:e.$store.state.vuexStore.walletInfo.address,gasPrice:"10000000000"}).methods.balanceOf(e.$store.state.vuexStore.walletInfo.address).call({from:"0x65096f2B7A8dc1592479F1911cd2B98dae4d2218"},function(t,a){if(t)console.log(t);else{let t=a/1e8;e.$store.state.vuexStore.balanceData.Chain.TNC=e.$parent.keepDecimalPlaces(t,3)}})},cycleReconnectWebsocket(){var e=this;e.$store.state.vuexStore.channelList.forEach(function(t,a){e.$parent.reconnectWebsocket(t.Ip+":8766",t.ChannelName)})},showSignOutBox(){1==this.$store.state.vuexStore.isLogin&&this.$parent.showSignOutBox()}}},r={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("nav",[a("h1",{on:{click:function(t){e.testFun()}}},[e._v(e._s(e.$t("navMenu.title")))]),e._v(" "),a("el-row",{staticClass:"tac"},[a("el-col",{attrs:{span:24}},[a("el-menu",{staticClass:"el-menu-vertical-demo",attrs:{"default-active":e.navSelected,active:e.navSelected,"background-color":"#545c64","text-color":"#fff","active-text-color":"#ffd04b","unique-opened":!0},on:{select:e.selectItems}},[a("el-submenu",{attrs:{index:"1"}},[a("template",{slot:"title"},[a("i",{staticClass:"el-icon-ETH-32"}),e._v(" "),a("span",[e._v(e._s(e.$t("navMenu.wallet.title")))])]),e._v(" "),a("el-menu-item-group",[a("el-menu-item",{attrs:{index:"1-1"},on:{click:function(t){e.toOtherForm("/")}}},[a("i",{staticClass:"el-icon-ETH-geren1"}),e._v(" "),a("span",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(e.$t("navMenu.wallet.index")))])]),e._v(" "),a("el-menu-item",{attrs:{index:"1-2"},on:{click:function(t){e.toOtherForm("/receive")}}},[a("i",{staticClass:"el-icon-ETH-zhuanzhang"}),e._v(" "),a("span",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(e.$t("navMenu.wallet.receive")))])]),e._v(" "),a("el-menu-item",{attrs:{index:"1-3"},on:{click:function(t){e.toOtherForm("/channelList")}}},[a("i",{staticClass:"el-icon-ETH-list"}),e._v(" "),a("span",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(e.$t("navMenu.wallet.channelList")))])]),e._v(" "),a("el-menu-item",{attrs:{index:"1-4"},on:{click:function(t){e.toOtherForm("/record")}}},[a("i",{staticClass:"el-icon-ETH-dujiayuniconzhenggao-19"}),e._v(" "),a("span",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(e.$t("navMenu.wallet.record")))])])],1)],2),e._v(" "),a("el-menu-item",{attrs:{index:"2"},on:{click:function(t){e.toOtherForm("/contact")}}},[a("i",{staticClass:"el-icon-ETH-lianxiren"}),e._v(" "),a("span",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(e.$t("navMenu.contact")))])]),e._v(" "),a("el-submenu",{attrs:{index:"3"}},[a("template",{slot:"title"},[a("i",{staticClass:"el-icon-setting"}),e._v(" "),a("span",[e._v(e._s(e.$t("navMenu.setting.title")))])]),e._v(" "),a("el-menu-item-group",[a("el-menu-item",{attrs:{index:"3-1"},on:{click:function(t){e.switchLang()}}},[a("i",{class:e.classObject}),e._v(" "),a("span",[e._v(e._s(e.$t("navMenu.setting.switchLang")))])]),e._v(" "),a("el-submenu",{attrs:{index:"3-2",disabled:""}},[a("template",{slot:"title"},[a("i",{staticClass:"el-icon-ETH-wangluo"}),e._v(" "),a("span",[e._v(e._s(e.$t("navMenu.setting.switchNet")))])]),e._v(" "),a("el-menu-item",{attrs:{index:"3-2-1"},on:{click:function(t){e.switchNet("Mainnet")}}},[e._v("Mainnet")]),e._v(" "),a("el-menu-item",{attrs:{index:"3-2-2"},on:{click:function(t){e.switchNet("Ropsten")}}},[e._v("Ropsten")])],2),e._v(" "),a("el-menu-item",{staticStyle:{position:"relative"},attrs:{index:"3-3",disabled:""}},[a("i",{staticClass:"el-icon-ETH-pifu"}),e._v(" "),a("span",[e._v(e._s(e.$t("navMenu.setting.nightMode"))+"\n                            "),a("el-switch",{staticStyle:{position:"absolute",top:"50%",right:"45px","margin-top":"-9px"},attrs:{"active-color":"#F8D163",disabled:""},model:{value:e.isNightMode,callback:function(t){e.isNightMode=t},expression:"isNightMode"}})],1)]),e._v(" "),a("el-menu-item",{attrs:{index:"3-4",disabled:""}},[a("i",{staticClass:"el-icon-ETH-xiugaimima"}),e._v(" "),a("span",[e._v(e._s(e.$t("navMenu.setting.changePass")))])]),e._v(" "),a("el-menu-item",{attrs:{index:"3-5"},on:{click:function(t){e.toOtherForm("/backup")}}},[a("i",{staticClass:"el-icon-ETH-fuzhi"}),e._v(" "),a("span",[e._v(e._s(e.$t("navMenu.setting.backup")))])]),e._v(" "),a("el-menu-item",{attrs:{index:"3-6"},on:{click:function(t){e.showSignOutBox()}}},[a("i",{staticClass:"el-icon-ETH-tuichu"}),e._v(" "),a("span",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(e.$t("navMenu.setting.signOut")))])])],1)],2),e._v(" "),a("el-menu-item",{attrs:{index:"4"},on:{click:function(t){e.toOtherForm("/about")}}},[a("i",{staticClass:"el-icon-ETH-xinxi"}),e._v(" "),a("span",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(e.$t("navMenu.about")))])])],1)],1)],1)],1)},staticRenderFns:[]};var l=a("VU/8")(o,r,!1,function(e){a("h8HD")},"data-v-24d634c0",null).exports,c={name:"headBox",data:()=>({}),mounted(){this.$nextTick(function(){})},methods:{}},d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"headBox"},[a("i",{staticClass:"listIcon el-icon-ETH-liebiao",on:{click:function(t){e.$store.state.vuexStore.isNavShow=!e.$store.state.vuexStore.isNavShow}}}),e._v(" "),a("el-badge",{staticClass:"item",staticStyle:{float:"right"},attrs:{value:3,max:99}},[a("i",{staticClass:"notificationIcon el-icon-ETH-xiaoxi",on:{click:function(t){e.$store.state.vuexStore.isMessageBoxShow=!e.$store.state.vuexStore.isMessageBoxShow}}})])],1)},staticRenderFns:[]};var u=a("VU/8")(c,d,!1,function(e){a("oM9L")},"data-v-d8eacd86",null).exports,h={name:"messageBox",data:()=>({msg:"coming soon"}),mounted(){this.$nextTick(function(){})},methods:{clearAll(){return console.log("清除全部"),this.$store.state.vuexStore.channelList=[],this.$parent.StoreChannel(),this.$store.state.vuexStore.recordList=[],this.$parent.StoreRecordList(),!1}}},p={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("transition",{attrs:{name:"el-fade-in-linear"}},[e.$store.state.vuexStore.isMessageBoxShow?a("div",{staticStyle:{width:"100%",height:"100%",position:"absolute"},on:{click:function(t){e.$store.state.vuexStore.isMessageBoxShow=!1}}},[a("div",{staticClass:"messageBox"},[a("div",{staticClass:"content_text"},[a("a",{staticClass:"clearAllBtn",on:{click:function(t){t.stopPropagation(),e.clearAll()}}},[e._v("清除全部")]),e._v(" "),a("h1",[e._v("消息")]),e._v(" "),a("hr",{staticStyle:{color:"#606266"}}),e._v(" "),a("div",{staticClass:"ulBox"},[a("ul",[a("li",[e._v("欢迎点击消息中心")]),e._v(" "),a("li",[e._v("目前该功能还未投入使用")]),e._v(" "),a("li",[e._v("敬请期待")])])])])])]):e._e()])},staticRenderFns:[]};var v=a("VU/8")(h,p,!1,function(e){a("lQqF")},"data-v-665ef38c",null).exports,y={name:"footerBox",data(){return{FooterList:[{index:"1-1",icon:"el-icon-ETH-geren1",name:this.$t("navMenu.wallet.index"),router:"/"},{index:"1-2",icon:"el-icon-ETH-zhuanzhang",name:"Receive",router:"/receive"},{index:"1-3",icon:"el-icon-ETH-list",name:"Channel",router:"/channelList"},{index:"1-4",icon:"el-icon-ETH-dujiayuniconzhenggao-19",name:"Record",router:"/record"}],navSelected:"1-1"}},mounted(){this.$nextTick(function(){})},watch:{"$store.state.vuexStore.activeNavIndex":"storeToFooter"},methods:{selectItems(e){this.$store.state.vuexStore.activeNavIndex=e},storeToFooter(){this.navSelected=this.$store.state.vuexStore.activeNavIndex}}},m={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return"/start"!=e.$route.path&&"/create"!=e.$route.path&&"/loginByPrivateKey"!=e.$route.path&&"/loginByKeyStore"!=e.$route.path?a("footer",{staticClass:"footer"},[a("el-menu",{staticClass:"el-menu-demo",attrs:{"default-active":e.navSelected,active:e.navSelected,mode:"horizontal"},on:{select:e.selectItems}},[a("el-menu-item",{attrs:{index:"1-1"}},[a("router-link",{staticClass:"clearfloat",attrs:{to:"/"}},[a("span",[a("i",{staticClass:"el-icon-ETH-geren1"})]),e._v(" "),a("span",[e._v(e._s(e.$t("navMenu.wallet.index")))])])],1),e._v(" "),a("el-menu-item",{attrs:{index:"1-2"}},[a("router-link",{staticClass:"clearfloat",attrs:{to:"/receive"}},[a("span",[a("i",{staticClass:"el-icon-ETH-zhuanzhang"})]),e._v(" "),a("span",[e._v(e._s(e.$t("navMenu.wallet.receive")))])])],1),e._v(" "),a("el-menu-item",{attrs:{index:"1-3"}},[a("router-link",{staticClass:"clearfloat",attrs:{to:"/channelList"}},[a("span",[a("i",{staticClass:"el-icon-ETH-list"})]),e._v(" "),a("span",[e._v(e._s(e.$t("navMenu.wallet.channelList")))])])],1),e._v(" "),a("el-menu-item",{attrs:{index:"1-4"}},[a("router-link",{staticClass:"clearfloat",attrs:{to:"/record"}},[a("span",[a("i",{staticClass:"el-icon-ETH-dujiayuniconzhenggao-19"})]),e._v(" "),a("span",[e._v(e._s(e.$t("navMenu.wallet.record")))])])],1)],1)],1):e._e()},staticRenderFns:[]};var f=a("VU/8")(y,m,!1,function(e){a("hEZ2")},"data-v-3e37d034",null).exports,g={name:"App",data(){return{isFeeInfoBoxShow:!1,isReceiptRsmcInfoBox:!1,isReceiptHtlcInfoBox:!1,isSettleInfoBox:!1,isSignOutBoxShow:!1,activeInfo:{redata:[],keyStorePass:""},paymentInfo:{redata:[],keyStorePass:"",fee:0},confirmReceiptRules:{keyStorePass:[{validator:(e,t,a)=>{if(!t)return a(new Error("钱包密码不能为空，否则将无法交易"));{let e=this.decryptPrivateKey(this.$store.state.vuexStore.walletInfo.keyStore,this.activeInfo.keyStorePass);setTimeout(()=>{if(!e)return a(new Error("钱包解锁失败 - 可能是密码错误"));a()},2e3)}},trigger:"blur"}]}}},components:{headNav:l,headBox:u,footerBox:f,messageBox:v},mounted(){this.$nextTick(function(){this.connectWebSocketForNodeUri()})},methods:{connectWebSocketForNodeUri(){let e=this;e.$notify.closeAll();if(e.$store.state.vuexStore.NodeUriWebSocket=new WebSocket("ws://47.104.81.20:9000/"),e.$store.state.vuexStore.NodeUriWebSocket.onmessage=e.nodeUriWebsocketOnMessage,e.$store.state.vuexStore.NodeUriWebSocket.onclose=e.nodeUriWebsocketClose,e.$notify.info({title:"消息",duration:2e3,message:"正在连接至Trinity网络"}),1==e.$store.state.vuexStore.isLogin){let t={messageType:"init",walletAddress:e.$store.state.vuexStore.walletInfo.address};e.$store.state.vuexStore.NodeUriWebSocket.send(JSON.stringify(t))}},backToStart(){this.$router.push("/start")},fetchAsArray:function(e){let t=e.toString();return JSON.parse(window.localStorage.getItem(t)||"[]")},fetchAsString:function(e){let t=e.toString();return window.localStorage.getItem(t)||""},saveAsArray:function(e,t){let a=e.toString();window.localStorage.setItem(a,JSON.stringify(t))},saveAsString:function(e,t){let a=e.toString();window.localStorage.setItem(a,t)},keepDecimalPlaces(e,t){let a;return a=isNaN(e)?NaN:parseInt(e*Math.pow(10,t))/Math.pow(10,t)},getChannelBalance(){let e=this,t=0,a=0;e.$store.state.vuexStore.channelList.forEach(function(n,s){n.isTestNet==e.$store.state.vuexStore.isTestNet&&3==n.State&&"TNC"==n.assetType?t+=n.SelfBalance:n.isTestNet==e.$store.state.vuexStore.isTestNet&&3==n.State&&"ETH"==n.assetType&&(a+=n.SelfBalance)}),s.a.set(e.$store.state.vuexStore.balanceData.Channel,"TNC",e.keepDecimalPlaces(t/1e8,3)),s.a.set(e.$store.state.vuexStore.balanceData.Channel,"ETH",e.keepDecimalPlaces(a/1e8,3))},showLoading:function(){loading=this.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)",target:document.querySelector(".appBox")})},closeLoading(){loading.close()},showSignOutBox(){this.isSignOutBoxShow=!0},SignOut(){this.$store.state.vuexStore.walletInfo={keyStore:"",publicKey:"",address:""},location.reload()},decryptPrivateKey(e,t){let a,n=this;try{a=web3.eth.accounts.decrypt(e,t)}catch(e){return"Key derivation failed - possibly wrong password"==e.message?(n.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"钱包解锁失败 - 可能是密码错误",duration:3e3}),!1):(n.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:e.message,duration:3e3}),!1)}return a},uri2Ip(e,t){let a=e.split("@")[1];return a=null==t?a.split(":")[0]:a.split(":")[0]+":"+t},assetContractAddress2AssetType(e){let t="";if(console.log(this.$store.state.vuexStore.isTestNet),this.$store.state.vuexStore.isTestNet)switch(console.log(1),e){case"0x65096f2B7A8dc1592479F1911cd2B98dae4d2218":t="TNC";break;case"ETH":t="ETH";break;default:t=Error}else switch(e){case"0x65096f2B7A8dc1592479F1911cd2B98dae4d2218":t="TNC";break;case"ETH":t="0x602c79718b16e442de58778e148d0b1084e3b2dffd5de6b7b16cee7969282de7";break;default:t=Error}return console.log(t),t},AssetType2AssetContractAddress(e){let t="";if(this.$store.state.vuexStore.isTestNet)switch(e){case"TNC":t=this.$store.state.vuexStore.tncContractAddress;break;case"ETH":t="0x602c79718b16e442de58778e148d0b1084e3b2dffd5de6b7b16cee7969282de7";break;default:t=Error}else switch(e){case"TNC":t="08e8c4400f1af2c20c28e0018f29535eb85d15b6";break;case"ETH":t="0x602c79718b16e442de58778e148d0b1084e3b2dffd5de6b7b16cee7969282de7";break;default:t=Error}return t},getChannelSerial(e,t,a){let n;return this.$store.state.vuexStore.channelList.forEach(function(s,o){if(s[e]===t){if(null==a)return void(n=o);if("open"==a){if(3==s.State&&1==s.isConnect)return void(n=o);n=-2}}else n=-1}),n},cycleGetTransactionReceipt(e){let t=this;setTimeout(function(){web3.eth.getTransactionReceipt(e).then(function(a){return null==a?t.cycleGetTransactionReceipt(e):(console.log(a),1==a.status?(t.$notify({title:"成功",dangerouslyUseHTMLString:!0,message:"交易已确认",duration:3e3,type:"success"}),t.$store.state.vuexStore.recordList.forEach(function(e,n){e.transactionHash==a.transactionHash&&(e.blockHash=a.blockHash,e.state=1,console.log("修改状态成功"),t.StoreRecordList())}),a):0==a.status?(t.$notify({title:"失败",dangerouslyUseHTMLString:!0,message:"交易确认失败",duration:3e3,type:"error"}),t.$store.state.vuexStore.recordList.forEach(function(e,n){e.transactionHash==a.transactionHash&&(e.blockHash=a.blockHash,e.state=-1,console.log("修改状态成功"),t.StoreRecordList())}),a):void 0)})},4e3)},nodeUriWebsocketOnMessage(e){let t=this;if("connected to server"===e.data)t.$notify.closeAll(),t.$notify({title:"成功",dangerouslyUseHTMLString:!0,message:"已连接到Trinity网络",duration:3e3,type:"success"});else{let a=JSON.parse(e.data),n=a.messageType;switch(console.log(a),n){case"monitorDeposit":t.OnMesMonitorDeposit(a);break;case"monitorQuickCloseChannel":t.OnMesMonitorQuickCloseChannel(a)}}},OnMesMonitorDeposit(e){console.log(e);let t=this,a=t.getChannelSerial("ChannelName",e.channelId);if(console.log(a),null!==a){if(console.log(e.amount),console.log(t.$store.state.vuexStore.channelList[a].SelfBalance+t.$store.state.vuexStore.channelList[a].OtherBalance),e.amount==t.$store.state.vuexStore.channelList[a].SelfBalance+t.$store.state.vuexStore.channelList[a].OtherBalance){t.$notify({title:"成功",dangerouslyUseHTMLString:!0,message:"通道已开通",duration:3e3,type:"success"});let e=t.$store.state.vuexStore.channelList[a];console.log(e),e.State=3,console.log(e),s.a.set(t.$store.state.vuexStore.channelList,a,e),console.log(t.$store.state.vuexStore.channelList[a]),t.StoreChannel(),t.getChannelBalance()}}else t.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"未找到该通道,请重试一次",duration:3e3})},OnMesMonitorQuickCloseChannel(e){let t=this,a=t.getChannelSerial("ChannelName",e.channelId);console.log(a),null!==a?(console.log(e.amountA),console.log(e.amountB),console.log(t.$store.state.vuexStore.channelList[a].SelfBalance),console.log(t.$store.state.vuexStore.channelList[a].OtherBalance),e.amountA==t.$store.state.vuexStore.channelList[a].SelfBalance&&e.amountB==t.$store.state.vuexStore.channelList[a].OtherBalance&&(t.$notify({title:"成功",dangerouslyUseHTMLString:!0,message:"通道已关闭",duration:3e3,type:"success"}),t.$store.state.vuexStore.channelList.splice(a,1),t.StoreChannel(),t.getChannelBalance())):t.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"未找到该通道,请重试一次",duration:3e3})},nodeUriWebsocketClose(e){console.log("已断开websocket"),console.log(e),this.$notify({title:"警告",dangerouslyUseHTMLString:!0,message:"与Trinity网络断开连接,点击进行重连",duration:0,type:"error",onClick:this.connectWebSocketForNodeUri})},websocketOnmessage(e){let t=this,a=JSON.parse(e.data),n=a.MessageType;switch(console.log(a),n){case"Founder":t.OnMesFounder(a);break;case"FounderSign":t.OnMesFounderSign(a);break;case"Rsmc":t.OnMesRsmc(a);break;case"RsmcSign":t.OnMesRsmcSign(a);break;case"AckRouterInfo":t.OnMesAckRouterInfo(a);break;case"Htlc":t.OnMesHtlc(a);break;case"HtlcSign":t.OnMesHtlcSign(a);break;case"RResponse":t.OnMesRResponse(a);break;case"Settle":t.OnMesSettle(a);break;case"SettleSign":t.OnMesSettleSign(a);break;case"ChannelInfo":t.OnMesChannelInfo(a)}},OnMesFounder:function(e){var t=this;let a=t.getChannelSerial("ChannelName",e.ChannelName),n=e.MessageBody,s=t.$parent.decryptPrivateKey(t.$store.state.vuexStore.walletInfo.keyStore,t.addChannelForm.keyStorePass);t.$store.state.vuexStore.FoundertxDataSign=signData(n.Founder.txData,s);let o=signData(n.Commitment.txData,s),r=signData(n.RevocableDelivery.txData,s),i={MessageType:"FounderSign",Sender:e.Receiver,Receiver:e.Sender,ChannelName:e.ChannelName,TxNonce:e.TxNonce,MessageBody:{Founder:{txDataSign:t.$store.state.vuexStore.FoundertxDataSign,originalData:n.Founder},Commitment:{txDataSign:o,originalData:n.Commitment},RevocableDelivery:{txDataSign:r,originalData:n.RevocableDelivery},AssetType:e.MessageBody.AssetType,Deposit:e.MessageBody.Deposit,RoleIndex:e.MessageBody.RoleIndex}};t.websock[a].data.send(JSON.stringify(i));t.uri2Ip(e.Sender,20556);axios({method:"post",url:t.RpcUrl,headers:{"Content-Type":"application/json;charset=UTF-8"},data:JSON.stringify({jsonrpc:"2.0",method:"FunderTransaction",params:[e.Sender.split("@")[0],e.Receiver.split("@")[0],n.Founder.addressFunding,n.Founder.scriptFunding,e.MessageBody.Deposit,e.MessageBody.Deposit,n.Founder.txId,e.MessageBody.AssetType],id:1})}).then(function(s){console.log(s.data);var o={MessageType:"Founder",Sender:e.Receiver,Receiver:e.Sender,TxNonce:e.TxNonce,ChannelName:e.ChannelName,MessageBody:{Founder:n.Founder,Commitment:s.data.result.C_TX,RevocableDelivery:s.data.result.R_TX,AssetType:e.MessageBody.AssetType,Deposit:e.MessageBody.Deposit,RoleIndex:e.MessageBody.RoleIndex+1}};t.$store.state.vuexStore.channelList.websock[a].data.send(JSON.stringify(o))}),n.ChannelName=e.ChannelName,t.TxList.push(n),t.StoreFounder()},OnMesFounderSign:function(e){var t=this;"RESPONSE_OK"==e.Status?web3.eth.getGasPrice().then(function(a){console.log(a);new web3.eth.Contract(t.$store.state.vuexStore.trinityContractAbi,t.$store.state.vuexStore.trinityContractAddress,{from:t.$store.state.vuexStore.walletInfo.address,gasPrice:3*a});let n=t.decryptPrivateKey(t.$store.state.vuexStore.walletInfo.keyStore,t.$store.state.vuexStore.addChannelInfo.keyStorePass);web3.eth.getTransactionCount(t.$store.state.vuexStore.walletInfo.address,web3.eth.defaultBlock.pending).then(function(s){let o=web3.eth.abi.encodeFunctionSignature("deposit(bytes32,uint256,address,uint256,address,uint256,bytes,bytes)");console.log(o),console.log(t.$store.state.vuexStore.addChannelInfo.channelName),console.log("0"),console.log(t.$store.state.vuexStore.walletInfo.address),console.log(1e8*t.$store.state.vuexStore.addChannelInfo.selfDeposit),console.log(t.$store.state.vuexStore.addChannelInfo.uri.split("@")[0]),console.log(1e8*t.$store.state.vuexStore.addChannelInfo.otherDeposit),console.log(t.$store.state.vuexStore.addChannelInfo.selfSignedData),console.log(e.MessageBody.Commitment);let r=web3.eth.abi.encodeParameters(["bytes32","uint256","address","uint256","address","uint256","bytes","bytes"],[t.$store.state.vuexStore.addChannelInfo.channelName,"0",t.$store.state.vuexStore.walletInfo.address,1e8*t.$store.state.vuexStore.addChannelInfo.selfDeposit,t.$store.state.vuexStore.addChannelInfo.uri.split("@")[0],1e8*t.$store.state.vuexStore.addChannelInfo.otherDeposit,t.$store.state.vuexStore.addChannelInfo.selfSignedData,e.MessageBody.Commitment]);console.log(r);var i={nonce:web3.utils.toHex(s++),gasPrice:web3.utils.toHex(3*a),gasLimit:web3.utils.toHex(45e5),to:t.$store.state.vuexStore.trinityContractAddress,from:t.$store.state.vuexStore.walletInfo.address,value:"0x00",data:o+r.substr(2)};console.log(i);let l=signData(i,n.privateKey);console.log(l);let c=(new Date).getTime();web3.eth.sendSignedTransaction("0x"+l).on("transactionHash",function(e){console.log(e),t.$notify({title:"成功",dangerouslyUseHTMLString:!0,message:"上链成功，请交易确认",duration:3e3,type:"success"});let a={date:c,name:t.$store.state.vuexStore.addChannelInfo.uri.split("@")[0],Amount:1e8*t.$store.state.vuexStore.addChannelInfo.selfDeposit,assetType:"TNC",isOnChannel:!1,isPay:!0,state:0,isTestNet:t.$store.state.vuexStore.isTestNet,transactionHash:e,blockHash:""};t.$store.state.vuexStore.recordList.push(a);let n={date:c,name:t.$store.state.vuexStore.addChannelInfo.uri.split("@")[0],Amount:1e8*t.$store.state.vuexStore.addChannelInfo.selfDeposit,assetType:"TNC",isOnChannel:!0,isPay:!1,state:0,isTestNet:t.$store.state.vuexStore.isTestNet,transactionHash:e,blockHash:""};t.$store.state.vuexStore.recordList.push(n),t.StoreRecordList(),t.cycleGetTransactionReceipt(e)}).on("receipt",function(e){}).on("confirmation",function(e,t){t.status}).on("error",function(e){let a=t.getChannelSerial("ChannelName",t.$store.state.vuexStore.addChannelInfo.channelName);return t.$store.state.vuexStore.channelList.splice(a,1),t.StoreChannel(),!1});let d={messageType:"monitorDeposit",walletAddress:t.$store.state.vuexStore.walletInfo.address,chainType:e.MessageBody.AssetType,playload:e.ChannelName,comments:""};t.$store.state.vuexStore.NodeUriWebSocket.send(JSON.stringify(d))})}):console.log("Status异常")},OnMesRsmc:function(e){let t=this.$parent.getChannelSerial("ChannelName",e.ChannelName,"open");return-1==t?(this.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"未与该Uri建立通道",duration:0}),!1):-2==t?(this.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"该通道未Open或者未连接上websocket",duration:0}),!1):(this.activeInfo.redata=e,void this.$notify.info({title:"消息",duration:0,message:this.$store.state.vuexStore.channelList[t].Alice+"通道有收款消息,需要你解锁钱包.<br/>点击进行解锁",onClick:this.showReceiptRsmcInfoBox}))},showReceiptRsmcInfoBox(){this.isReceiptRsmcInfoBox=!0},RsmcSign(){let e=this;e.$refs.activeInfo.validate(t=>{if(!t)return console.log("error submit!!"),!1;{let t=e.getChannelSerial("ChannelName",e.activeInfo.redata.ChannelName,"open"),a=web3.utils.soliditySha3({t:"bytes32",v:e.$store.state.vuexStore.channelList[t].ChannelName},{t:"uint256",v:e.$store.state.vuexStore.channelList[t].TxNonce},{t:"address",v:e.$store.state.vuexStore.channelList[t].OtherUri.split("@")[0]},{t:"uint256",v:e.$store.state.vuexStore.channelList[t].OtherBalance-1e8*e.activeInfo.redata.PaymentCount},{t:"address",v:e.$store.state.vuexStore.walletInfo.address},{t:"uint256",v:e.$store.state.vuexStore.channelList[t].SelfBalance+1e8*e.activeInfo.redata.PaymentCount});console.log(a);let n,s=e.decryptPrivateKey(e.$store.state.vuexStore.walletInfo.keyStore,e.activeInfo.keyStorePass),o=ecSign(a,s.privateKey);if(console.log(o),e.activeInfo.redata.SenderBalance==e.$store.state.vuexStore.channelList[t].SelfBalance&&e.activeInfo.redata.ReceiverBalance==e.$store.state.vuexStore.channelList[t].OtherBalance){e.activeInfo.redata.Receiver,e.activeInfo.redata.Sender,e.$store.state.vuexStore.channelList[t].TxNonce,e.activeInfo.redata.ChannelName,e.$store.state.vuexStore.NetMagic,e.$store.state.vuexStore.channelList[t].assetType,e.activeInfo.redata.PaymentCount,e.$store.state.vuexStore.channelList[t].SelfBalance,e.$store.state.vuexStore.channelList[t].OtherBalance}}})},OnMesRsmcSign:function(e){let t=this,a=t.getChannelSerial("ChannelName",t.$store.state.vuexStore.txOnChannelInfo.ChannelName);if(console.log(a),-1!=a){let n=web3.utils.soliditySha3({t:"bytes32",v:t.$store.state.vuexStore.channelList[a].ChannelName},{t:"uint256",v:t.$store.state.vuexStore.channelList[a].TxNonce+1},{t:"address",v:t.$store.state.vuexStore.walletInfo.address},{t:"uint256",v:t.$store.state.vuexStore.channelList[a].SelfBalance-2e7},{t:"address",v:t.$store.state.vuexStore.channelList[a].OtherUri.split("@")[0]},{t:"uint256",v:t.$store.state.vuexStore.channelList[a].OtherBalance+2e7});console.log(n);let o=t.decryptPrivateKey(t.$store.state.vuexStore.walletInfo.keyStore,t.$store.state.vuexStore.txOnChannelInfo.keyStorePass),r=ecSign(n,o.privateKey);console.log(r);let i={MessageType:"RsmcSign",Sender:e.Receiver,Receiver:e.Sender,TxNonce:t.$store.state.vuexStore.channelList[a].TxNonce+1,ChannelName:e.ChannelName,NetMagic:t.$store.state.vuexStore.NetMagic,MessageBody:{AssetType:t.$store.state.vuexStore.txOnChannelInfo.assetType,PaymentCount:t.$store.state.vuexStore.txOnChannelInfo.value/1e8,SenderBalance:(t.$store.state.vuexStore.channelList[a].SelfBalance-t.$store.state.vuexStore.txOnChannelInfo.value)/1e8,ReceiverBalance:(t.$store.state.vuexStore.channelList[a].OtherBalance+t.$store.state.vuexStore.txOnChannelInfo.value)/1e8,Commitment:r},Comments:{},Status:"RESPONSE_OK"};t.$store.state.vuexStore.channelList[a].websock.send(JSON.stringify(i));let l=t.$store.state.vuexStore.channelList[a];l.SelfBalance-=t.$store.state.vuexStore.txOnChannelInfo.value,l.OtherBalance+=t.$store.state.vuexStore.txOnChannelInfo.value,l.TxNonce+=1,s.a.set(t.$store.state.vuexStore.channelList,a,l),console.log(t.$store.state.vuexStore.channelList[a]),t.StoreChannel(),t.getChannelBalance();let c={date:(new Date).getTime(),name:e.Sender.split("@")[0],Amount:t.$store.state.vuexStore.txOnChannelInfo.value,assetType:t.$store.state.vuexStore.txOnChannelInfo.assetType,isOnChannel:!0,isPay:!0,state:1,isTestNet:t.$store.state.vuexStore.isTestNet,transactionHash:"none",blockHash:"none"};t.$store.state.vuexStore.recordList.push(c),t.StoreRecordList(),t.$store.state.vuexStore.txOnChannelInfo=[],t.$notify({title:"成功",dangerouslyUseHTMLString:!0,message:"转账确认",duration:3e3,type:"success"})}else t.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"未找到该通道",duration:3e3})},OnMesAckRouterInfo:function(e){if(null===e.RouterInfo)return _this.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"路由为空,没有可用的通道",duration:3e3}),!1;{let a=this,n=e.RouterInfo.FullPath;8766==a.TxOnChannelInfo.ReceiverUrl.split(":")[1]&&(n.unshift([a.TxOnChannelInfo.SendUrl,0]),n.push([a.TxOnChannelInfo.ReceiverUrl,0]));let s=0;for(var t=0;t<n.length-1;t++)s+=e.RouterInfo.FullPath[t][1];s=1e8*parseFloat(s).toFixed(8),a.$store.state.vuexStore.txOnChannelInfo.fee=s/1e8,a.isFeeInfoBoxShow=!0}},sendHtlcMes(){let e=this,t=e.getChannelSerial("OtherUri",redata.RouterInfo.Next,"open");return-1==t?(e.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"未与该Uri建立通道",duration:0}),!1):-2==t?(e.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"该通道未Open或者未连接上websocket",duration:0}),!1):void web3.eth.getBlockNumber().then(function(a){console.log(a);let n=a+4*(Router.length-1)*60*24;console.log(n);let s=e.UriToIp(redata.RouterInfo.Next,8766),o={MessageType:"Htlc",Sender:e.$store.state.vuexStore.walletInfo.address+"@"+s,Receiver:redata.RouterInfo.Next,TxNonce:e.$store.state.vuexStore.channelList[t].TxNonce,ChannelName:e.$store.state.vuexStore.channelList[t].ChannelName,AssetType:e.$store.state.vuexStore.channelList[t].AssetType,NetMagic:e.$store.state.vuexStore.channelList[t].NetMagic,Router:Router,Next:redata.RouterInfo.Next,MessageBody:{SenderBalance:e.$store.state.vuexStore.channelList[t].SelfBalance,ReceiverBalance:e.$store.state.vuexStore.channelList[t].OtherBalance,Commitment:"",Payment:e.$store.state.vuexStore.channelList[t].AssetType+e.$store.state.vuexStore.txOnChannelInfo.fee,DelayBlock:n,DelayCommitment:"",HashR:e.$store.state.vuexStore.txOnChannelInfo.HashR}};e.$store.state.vuexStore.channelList[t].websock.send(JSON.stringify(o))})},OnMesHtlc:function(e){let t=this.$parent.getChannelSerial("ChannelName",e.ChannelName,"open");return-1==t?(this.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"未与该Uri建立通道",duration:0}),!1):-2==t?(this.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"该通道未Open或者未连接上websocket",duration:0}),!1):(this.activeInfo.redata=e,void this.$notify.info({title:"消息",duration:0,message:this.$store.state.vuexStore.channelList[t].Alice+"通道有收款消息,需要你解锁钱包.<br/>点击进行解锁",onClick:this.showReceiptInfoBox}))},showReceiptHtlcInfoBox(){this.isReceiptInfoBox=!0},HtlcSign(){let e=this;e.$refs.activeInfo.validate(t=>{if(!t)return console.log("error submit!!"),!1;{let t=e.getChannelSerial("ChannelName",e.activeInfo.redata.ChannelName,"open"),a=web3.utils.soliditySha3({t:"bytes32",v:e.$store.state.vuexStore.channelList[t].ChannelName},{t:"uint256",v:e.$store.state.vuexStore.channelList[t].TxNonce},{t:"address",v:e.$store.state.vuexStore.channelList[t].OtherUri.split("@")[0]},{t:"uint256",v:e.$store.state.vuexStore.channelList[t].OtherBalance-1e8*e.activeInfo.redata.PaymentCount},{t:"address",v:e.$store.state.vuexStore.walletInfo.address},{t:"uint256",v:e.$store.state.vuexStore.channelList[t].SelfBalance+1e8*e.activeInfo.redata.PaymentCount});console.log(a);let n,s=e.decryptPrivateKey(e.$store.state.vuexStore.walletInfo.keyStore,e.activeInfo.keyStorePass),o=ecSign(a,s.privateKey);if(console.log(o),e.activeInfo.redata.SenderBalance==e.$store.state.vuexStore.channelList[t].SelfBalance&&e.activeInfo.redata.ReceiverBalance==e.$store.state.vuexStore.channelList[t].OtherBalance){e.activeInfo.redata.Receiver,e.activeInfo.redata.Sender,e.$store.state.vuexStore.channelList[t].TxNonce,e.activeInfo.redata.ChannelName,e.$store.state.vuexStore.NetMagic,e.$store.state.vuexStore.channelList[t].assetType,e.activeInfo.redata.PaymentCount,e.$store.state.vuexStore.channelList[t].SelfBalance,e.$store.state.vuexStore.channelList[t].OtherBalance}}})},OnMesHtlcSign:function(e){let t=this,a=e.MessageBody,n=t.getChannelSerial("ChannelName",e.ChannelName);if(-1==n)return t.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"未与该Uri建立通道",duration:0}),!1;if(-2==n)return t.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"该通道未Open或者未连接上websocket",duration:0}),!1;if(console.log(n),0===a.RoleIndex){let e=web3.utils.soliditySha3({t:"bytes32",v:t.$store.state.vuexStore.channelList[n].ChannelName},{t:"uint256",v:t.$store.state.vuexStore.channelList[n].TxNonce+1},{t:"address",v:t.$store.state.vuexStore.walletInfo.address},{t:"uint256",v:t.$store.state.vuexStore.channelList[n].SelfBalance-1e8*a.Payment},{t:"address",v:t.$store.state.vuexStore.channelList[n].OtherUri.split("@")[0]},{t:"uint256",v:t.$store.state.vuexStore.channelList[n].OtherBalance+1e8*a.Payment});console.log(e);let o=t.$parent.decryptPrivateKey(t.$store.state.vuexStore.walletInfo.keyStore,t.$store.state.vuexStore.walletInfo.txOnChannelInfo.keyStorePass),r=ecSign(e,o.privateKey);console.log(r);let i={MessageType:"HtlcSign",Sender:t.paymentInfo.redata.Receiver,Receiver:t.paymentInfo.redata.Sender,TxNonce:t.$store.state.vuexStore.channelList[n].TxNonce+1,ChannelName:t.paymentInfo.redata.ChannelName,NetMagic:t.$store.state.vuexStore.NetMagic,MessageBody:{AssetType:t.paymentInfo.redata.MessageBody.AssetType,PaymentCount:t.paymentInfo.redata.MessageBody.PaymentCount,SenderBalance:t.$store.state.vuexStore.channelList[n].SelfBalance,ReceiverBalance:t.$store.state.vuexStore.channelList[n].OtherBalance,Commitment:r},Comments:{},Status:"RESPONSE_OK"};t.$store.state.vuexStore.channelList[n].websock.send(JSON.stringify(i));let l=t.$store.state.vuexStore.channelList[n];l.SelfBalance-=1e8*t.paymentInfo.redata.MessageBody.PaymentCount,l.OtherBalance+=1e8*t.paymentInfo.redata.MessageBody.PaymentCount,l.TxNonce+=1,s.a.set(t.$store.state.vuexStore.channelList,n,l),console.log(t.$store.state.vuexStore.channelList[n]),t.StoreChannel(),t.$notify({title:"成功",dangerouslyUseHTMLString:!0,message:"转账确认",duration:3e3,type:"success"})}if(1===a.RoleIndex){let n="";console.log("HashR:"+e.MessageBody.HashR),t.RList.forEach(function(e,t){e.Hr===a.HashR&&(console.log(e.Hr),n=e.R)});let s={MessageType:"RResponse",Sender:e.Receiver,Receiver:e.Sender,TxNonce:e.TxNonce,ChannelName:e.ChannelName,Router:e.RouterInfo,Next:e.Next,MessageBody:{RoleIndex:0,Comments:"",Count:e.MessageBody.Count,AssetType:e.MessageBody.AssetType,R:n,HR:e.MessageBody.HashR}};t.websock[i].data.send(JSON.stringify(s))}},OnMesRResponse:function(e){if(hex_sha1(e.MessageBody.R)===e.MessageBody.HR){console.log("进入R交易");e.MessageBody;let t=this.getChannelSerial("ChannelName",e.ChannelName);if(-1==t)return this.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"未与该Uri建立通道",duration:0}),!1;if(-2==t)return this.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"该通道未Open或者未连接上websocket",duration:0}),!1;{console.log(t);let e={MessageType:"Rsmc",Sender:this.txOnChannelInfo.sendUri,Receiver:this.txOnChannelInfo.receiverUri,TxNonce:this.$store.state.vuexStore.channelList[t].TxNonce,ChannelName:this.$store.state.vuexStore.channelList[t].ChannelName,NetMagic:this.$store.state.vuexStore.NetMagic,MessageBody:{AssetType:this.txOnChannelInfo.assetType,PaymentCount:this.txOnChannelInfo.value,SenderBalance:this.$store.state.vuexStore.channelList[t].SelfBalance,ReceiverBalance:this.$store.state.vuexStore.channelList[t].OtherBalance,Commitment:""},Comments:{}};this.$store.state.vuexStore.channelList[t].websock.send(JSON.stringify(e))}}},OnMesSettle:function(e){let t=this.$parent.getChannelSerial("ChannelName",e.ChannelName,"open");return-1==t?(this.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"未与该Uri建立通道",duration:0}),!1):-2==t?(this.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"该通道未Open或者未连接上websocket",duration:0}),!1):(this.activeInfo.redata=e,this.activeInfo.redata.ReceiverBalance=e.MessageBody.ReceiverBalance,this.activeInfo.redata.SenderBalance=e.MessageBody.SenderBalance,void this.$notify.info({title:"消息",duration:0,message:this.$store.state.vuexStore.channelList[t].Alice+"通道有关闭通道消息,需要你解锁钱包.<br/>点击进行解锁",onClick:this.showSettleInfoBox}))},showSettleInfoBox(){this.isSettleInfoBox=!0},SettleSign(){let e=this;e.$refs.activeInfo.validate(t=>{if(t){let t=e.getChannelSerial("ChannelName",e.activeInfo.redata.ChannelName,"open"),a=web3.utils.soliditySha3({t:"bytes32",v:e.$store.state.vuexStore.channelList[t].ChannelName},{t:"uint256",v:e.$store.state.vuexStore.channelList[t].TxNonce},{t:"address",v:e.$store.state.vuexStore.channelList[t].OtherUri.split("@")[0]},{t:"uint256",v:e.$store.state.vuexStore.channelList[t].OtherBalance-1e8*e.activeInfo.redata.PaymentCount},{t:"address",v:e.$store.state.vuexStore.walletInfo.address},{t:"uint256",v:e.$store.state.vuexStore.channelList[t].SelfBalance+1e8*e.activeInfo.redata.PaymentCount});console.log(a);let n,s=e.decryptPrivateKey(e.$store.state.vuexStore.walletInfo.keyStore,e.activeInfo.keyStorePass),o=ecSign(a,s.privateKey);if(console.log(o),e.activeInfo.redata.SenderBalance!=e.$store.state.vuexStore.channelList[t].SelfBalance||e.activeInfo.redata.ReceiverBalance!=e.$store.state.vuexStore.channelList[t].OtherBalance)return console.log("error submit!!"),!1;{let t={MessageType:"SettleSign",NetMagic:e.activeInfo.redata.NetMagic,Receiver:e.activeInfo.redata.Sender,Sender:e.activeInfo.redata.Receiver,ChannelName:e.activeInfo.redata.ChannelName,MessageBody:{AssetType:e.activeInfo.redata.MessageBody.AssetType,Commitment:n},Status:"RESPONSE_OK",TxNonce:e.activeInfo.redata.TxNonce};e.$store.state.vuexStore.channelList.websock[i].data.send(JSON.stringify(t))}}})},OnMesSettleSign:function(e){var t=this;"RESPONSE_OK"==e.Status?web3.eth.getGasPrice().then(function(a){console.log(a);new web3.eth.Contract(t.$store.state.vuexStore.trinityContractAbi,t.$store.state.vuexStore.trinityContractAddress,{from:t.$store.state.vuexStore.walletInfo.address,gasPrice:3*a});web3.eth.getTransactionCount(t.$store.state.vuexStore.walletInfo.address,web3.eth.defaultBlock.pending).then(function(n){console.log(n);let s=web3.eth.abi.encodeFunctionSignature("quickCloseChannel(bytes32,uint256,address,uint256,address,uint256,bytes,bytes)");console.log(s);let o=web3.eth.abi.encodeParameters(["bytes32","uint256","address","uint256","address","uint256","bytes","bytes"],[t.$store.state.vuexStore.closeChannelInfo.ChannelName,4294967295,t.$store.state.vuexStore.walletInfo.address,t.$store.state.vuexStore.closeChannelInfo.SelfBalance,t.$store.state.vuexStore.closeChannelInfo.OtherUri.split("@")[0],t.$store.state.vuexStore.closeChannelInfo.OtherBalance,t.$store.state.vuexStore.closeChannelInfo.selfSignedData,e.MessageBody.Commitment]);console.log(o);var r={nonce:web3.utils.toHex(n++),gasPrice:web3.utils.toHex(3*a),gasLimit:web3.utils.toHex(45e5),to:t.$store.state.vuexStore.trinityContractAddress,from:t.$store.state.vuexStore.walletInfo.address,value:"0x00",data:s+o.substr(2)};console.log(r);let i=t.decryptPrivateKey(t.$store.state.vuexStore.walletInfo.keyStore,t.$store.state.vuexStore.closeChannelInfo.keyStorePass),l=signData(r,i.privateKey);console.log(l);let c=(new Date).getTime();web3.eth.sendSignedTransaction("0x"+l,function(e,a){if(e)console.log(e);else{console.log(a),t.$notify({title:"成功",dangerouslyUseHTMLString:!0,message:"上链成功，请交易确认",duration:3e3,type:"success"});let e={date:c,name:t.$store.state.vuexStore.closeChannelInfo.OtherUri.split("@")[0],Amount:t.$store.state.vuexStore.closeChannelInfo.SelfBalance,assetType:"TNC",isOnChannel:!0,isPay:!0,state:0,isTestNet:t.$store.state.vuexStore.isTestNet,transactionHash:a,blockHash:""};t.$store.state.vuexStore.recordList.push(e);let n={date:c,name:t.$store.state.vuexStore.trinityContractAddress,Amount:t.$store.state.vuexStore.closeChannelInfo.SelfBalance,assetType:"TNC",isOnChannel:!1,isPay:!1,state:0,isTestNet:t.$store.state.vuexStore.isTestNet,transactionHash:a,blockHash:""};t.$store.state.vuexStore.recordList.push(n),t.StoreRecordList(),t.cycleGetTransactionReceipt(a)}});let d={messageType:"monitorQuickCloseChannel",walletAddress:t.$store.state.vuexStore.walletInfo.address,chainType:e.MessageBody.AssetType,playload:e.ChannelName,comments:""};t.$store.state.vuexStore.NodeUriWebSocket.send(JSON.stringify(d))})}):console.log("Status异常")},OnMesChannelInfo:function(e){let t=this;for(var a=0;a<e.Peers.length;a++)t.ChannelItems.forEach(function(t,n){t.Url.split("@")[0]===e.Peers[a]&&(t.Flag=4,t.oldFlag=5)})},websocketClose(e){console.log("已断开websocket");let t=this,a=e.currentTarget.url.split("/")[2].split(":")[0];console.log(a);let n=t.getChannelSerial("Ip",a);console.log(n),null!==n?(t.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"与"+a+"断开连接",duration:3e3}),t.$store.state.vuexStore.channelList[n].isConnect=!1):t.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"未找到该通道,请重试一次",duration:3e3})},reconnectWebsocket(e,t){let a=this;const n="ws://"+e+"/";var s=a.getChannelSerial("ChannelName",t);console.log(s),null!==s?(console.log(1),a.$store.state.vuexStore.channelList[s].websock=new WebSocket(n),a.$store.state.vuexStore.channelList[s].websock.onmessage=a.websocketOnmessage,a.$store.state.vuexStore.channelList[s].websock.onclose=a.websocketClose,a.$store.state.vuexStore.channelList[s].isConnect=!0,console.log(a.$store.state.vuexStore.channelList)):a.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"未找到该通道,请重试一次",duration:3e3})},StoreChannel(){console.log(this.$store.state.vuexStore.channelList),this.saveAsArray(this.$store.state.vuexStore.walletInfo.address+"@channelList",this.$store.state.vuexStore.channelList)},StoreRecordList(){console.log(this.$store.state.vuexStore.recordList),this.saveAsArray(this.$store.state.vuexStore.walletInfo.address+"@recordList",this.$store.state.vuexStore.recordList)}}},S={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"clearfloat appBox",attrs:{id:"app",mode:"in-out"}},[a("div",{staticStyle:{position:"relative",margin:"0 auto",width:"100%","max-width":"1400px",height:"100%"}},[a("div",{staticClass:"rightBox",class:{fullPage:!e.$store.state.vuexStore.isNavShow}},[a("head-box"),e._v(" "),a("router-view"),e._v(" "),a("message-box"),e._v(" "),a("footer-box")],1),e._v(" "),a("head-nav"),e._v(" "),a("el-dialog",{attrs:{title:"注意",visible:e.isFeeInfoBoxShow,width:"30%",center:""},on:{"update:visible":function(t){e.isFeeInfoBoxShow=t}}},[a("span",[e._v("你将支付"+e._s(e.$store.state.vuexStore.txOnChannelInfo.fee)+e._s(e.$store.state.vuexStore.txOnChannelInfo.assetType)+"作为本次交易的路由费用")]),a("br"),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"交易的路由费用由于通过多个路由节点而产生",placement:"top"}},[a("span",{staticStyle:{"margin-top":"20px",display:"inline-block","text-decoration":"underline"}},[e._v("什么是路由费用")])]),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.sendHtlcMes()}}},[e._v(" 确定 ")]),e._v(" "),a("el-button",{on:{click:function(t){e.isFeeInfoBoxShow=!1}}},[e._v(" 取消 ")])],1)],1),e._v(" "),a("el-dialog",{staticClass:"receiptRsmcInfoBox",attrs:{title:"收款",visible:e.isReceiptRsmcInfoBox,width:"30%",center:"","modal-append-to-body":!1},on:{"update:visible":function(t){e.isReceiptRsmcInfoBox=t}}},[a("span",[e._v(e._s(e.activeInfo.redata.Sender)+"向你转账")]),e._v(" "),a("span",{staticStyle:{color:"#F56C6C"}},[e._v(e._s(e.activeInfo.redata.PaymentCount)+" "+e._s(e.activeInfo.redata.AssetType))]),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-form",{ref:"activeInfo",staticClass:"demo-ruleForm",attrs:{model:e.activeInfo,"status-icon":"",rules:e.confirmReceiptRules,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"密码",prop:"keyStorePass"}},[a("el-input",{attrs:{placeholder:"在此输入密码",type:"password","auto-complete":"off"},model:{value:e.activeInfo.keyStorePass,callback:function(t){e.$set(e.activeInfo,"keyStorePass",t)},expression:"activeInfo.keyStorePass"}})],1),e._v(" "),a("el-form-item",{staticStyle:{"text-align":"center","margin-left":"-80px"}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.RsmcSign()}}},[e._v(" 确定 ")]),e._v(" "),a("el-button",{on:{click:function(t){e.isReceiptRsmcInfoBox=!1}}},[e._v(" 取消 ")])],1)],1)],1)]),e._v(" "),a("el-dialog",{staticClass:"receiptHtlcInfoBox",attrs:{title:"收款",visible:e.isReceiptHtlcInfoBox,width:"30%",center:"","modal-append-to-body":!1},on:{"update:visible":function(t){e.isReceiptHtlcInfoBox=t}}},[a("span",[e._v(e._s(e.activeInfo.redata.Sender)+"向你转账")]),e._v(" "),a("span",{staticStyle:{color:"#F56C6C"}},[e._v(e._s(e.activeInfo.redata.PaymentCount)+" "+e._s(e.activeInfo.redata.AssetType))]),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-form",{ref:"activeInfo",staticClass:"demo-ruleForm",attrs:{model:e.activeInfo,"status-icon":"",rules:e.confirmReceiptRules,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"密码",prop:"keyStorePass"}},[a("el-input",{attrs:{placeholder:"在此输入密码",type:"password","auto-complete":"off"},model:{value:e.activeInfo.keyStorePass,callback:function(t){e.$set(e.activeInfo,"keyStorePass",t)},expression:"activeInfo.keyStorePass"}})],1),e._v(" "),a("el-form-item",{staticStyle:{"text-align":"center","margin-left":"-80px"}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.HtlcSign()}}},[e._v(" 确定 ")]),e._v(" "),a("el-button",{on:{click:function(t){e.isReceiptHtlcInfoBox=!1}}},[e._v(" 取消 ")])],1)],1)],1)]),e._v(" "),a("el-dialog",{staticClass:"settleInfoBox",attrs:{title:"关闭通道",visible:e.isSettleInfoBox,width:"30%",center:"","modal-append-to-body":!1},on:{"update:visible":function(t){e.isSettleInfoBox=t}}},[a("span",[e._v(e._s(e.activeInfo.redata.Sender)+"申请关闭通道")]),e._v(" "),a("span",{staticStyle:{color:"#F56C6C"}},[e._v("本端余额:"+e._s(e.activeInfo.redata.ReceiverBalance)+" "+e._s(e.activeInfo.redata.AssetType))]),e._v(" "),a("span",{staticStyle:{color:"#F56C6C"}},[e._v("对端余额:"+e._s(e.activeInfo.redata.SenderBalance)+" "+e._s(e.activeInfo.redata.AssetType))]),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-form",{ref:"activeInfo",staticClass:"demo-ruleForm",attrs:{model:e.activeInfo,"status-icon":"",rules:e.confirmReceiptRules,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"密码",prop:"keyStorePass"}},[a("el-input",{attrs:{placeholder:"在此输入密码",type:"password","auto-complete":"off"},model:{value:e.activeInfo.keyStorePass,callback:function(t){e.$set(e.activeInfo,"keyStorePass",t)},expression:"activeInfo.keyStorePass"}})],1),e._v(" "),a("el-form-item",{staticStyle:{"text-align":"center","margin-left":"-80px"}},[a("el-button",{attrs:{type:"danger"},on:{click:function(t){e.HtlcSign()}}},[e._v(" 确定 ")]),e._v(" "),a("el-button",{on:{click:function(t){e.isSettleInfoBox=!1}}},[e._v(" 取消 ")])],1)],1)],1)]),e._v(" "),a("el-dialog",{attrs:{title:"退出",visible:e.isSignOutBoxShow,width:"30%",center:""},on:{"update:visible":function(t){e.isSignOutBoxShow=t}}},[a("span",[e._v("即将退出钱包")]),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"danger"},on:{click:function(t){e.SignOut()}}},[e._v(" 确定 ")]),e._v(" "),a("el-button",{on:{click:function(t){e.isSignOutBoxShow=!1}}},[e._v(" 取消 ")])],1)])],1)])},staticRenderFns:[]};var x=a("VU/8")(g,S,!1,function(e){a("9jAX")},null,null).exports,b=a("/ocq"),C={name:"indexForm",data(){var e=(e,t,a)=>{if(!t)return a(new Error("钱包密码不能为空，否则将无法交易"));{let e=this.$parent.decryptPrivateKey(this.$store.state.vuexStore.walletInfo.keyStore,t);setTimeout(()=>{if(!e)return a(new Error("钱包解锁失败 - 可能是密码错误"));a()},2e3)}};return{isShowMoreAsset:!1,paymentCode:"",txOnChainInfo:{address:"",assetType:"",amount:"",keyStorePass:""},txOnChainRules:{address:[{validator:(e,t,a)=>{if(!t)return a(new Error("地址不能为空"));42!==t.length?a(new Error("请输入正确的地址")):a()},trigger:"blur"}],amount:[{validator:(e,t,a)=>{if(!t)return a(new Error("金额不能为空"));isNaN(t)?a(new Error("请输入数字值")):t<0?a(new Error("金额必须大于0")):a()},trigger:"blur"}],assetType:[{validator:(e,t,a)=>{if(!t)return a(new Error("资产类型不能为空"));a()},trigger:"change"}],keyStorePass:[{validator:e,trigger:"blur"}]},txOnChannelInfo:{sendUri:"",receiverUri:"",hr:"",assetType:"",value:0,fee:0,description:"",ChannelName:"",keyStorePass:""},txOnChannelRules:{keyStorePass:[{validator:e,trigger:"blur"}]},ShowTxOnChainBox:!1,ShowTxOnChannelBox:!1,contact:""}},computed:{balanceData(){return this.$store.state.vuexStore.balanceData}},mounted(){this.$nextTick(function(){this.$route.params.address&&(this.paymentCode=this.$route.params.address)})},watch:{},methods:{showMoreAsset(){this.isShowMoreAsset=!this.isShowMoreAsset},decryptPaymentCode(){let e=this;if(""!=e.paymentCode.length){if(42===e.paymentCode.length)return e.paymentCode===e.$store.state.vuexStore.walletInfo.address?void e.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"收付款地址不能相同",duration:3e3}):(e.txOnChainInfo.address=e.paymentCode,void(e.ShowTxOnChainBox=!0));if("TN"==e.paymentCode.substr(0,2)){let t;console.log("进入通道交易");try{t=base58decode(e.paymentCode.substring(2)).toString()}catch(t){return e.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"付款码解析错误1",duration:3e3}),!1}if(console.log(t),!(t.indexOf("&")>-1))return e.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"付款码解析错误，请确认",duration:3e3}),!1;{let a=t.split("&");if(e.txOnChannelInfo.receiverUri=a[0],e.txOnChannelInfo.hr=a[1],e.txOnChannelInfo.assetType=e.$parent.assetContractAddress2AssetType(a[2]),e.txOnChannelInfo.value=1e8*a[3],e.txOnChannelInfo.description=a[4],console.log(e.txOnChannelInfo),!web3.utils.isAddress(e.txOnChannelInfo.receiverUri.split("@")[0]))return void e.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"付款码解析错误2",duration:3e3});if(""==e.txOnChannelInfo.hr)return void e.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"付款码解析错误3",duration:3e3});if(""==e.txOnChannelInfo.assetType)return void e.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"付款码解析错误4",duration:3e3});if(0==e.txOnChannelInfo.value)return void e.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"付款码解析错误5",duration:3e3});if(e.$store.state.vuexStore.walletInfo.address===e.txOnChannelInfo.receiverUri.split("@")[0])return void e.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"收付款地址不能相同",duration:3e3});e.ShowTxOnChannelBox=!0}}else this.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"付款码错误，请确认",duration:3e3})}else e.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"付款码/地址不能为空",duration:3e3})},contactChange(){this.paymentCode=this.contact},txOnChain(){let e=this;e.$refs.txOnChainInfo.validate(t=>{if(!t)return console.log("error submit!!"),!1;"ETH"==e.txOnChainInfo.assetType?e.txEthOnChain():e.txTncOnChain()})},txEthOnChain(){let e=this,t=e.$parent.decryptPrivateKey(e.$store.state.vuexStore.walletInfo.keyStore,e.txOnChainInfo.keyStorePass);web3.eth.getTransactionCount(e.$store.state.vuexStore.walletInfo.address,web3.eth.defaultBlock.pending).then(function(a){console.log(a),web3.eth.getGasPrice().then(function(n){console.log(n);var s={nonce:web3.utils.toHex(a++),gasLimit:web3.utils.toHex(45e5),gasPrice:web3.utils.toHex(5*n),to:e.txOnChainInfo.address,from:e.$store.state.vuexStore.walletInfo.address,value:web3.utils.toHex(1e18*e.txOnChainInfo.amount),data:""};console.log(s);let o=signData(s,t.privateKey);console.log(o);let r=(new Date).getTime();web3.eth.sendSignedTransaction("0x"+o,function(t,a){if(t)console.log(t);else{console.log(a),e.$notify({title:"成功",dangerouslyUseHTMLString:!0,message:"上链成功，请交易确认",duration:3e3,type:"success"}),e.ShowTxOnChainBox=!1;let t={date:r,name:e.txOnChainInfo.address,Amount:1e8*e.txOnChainInfo.amount,assetType:"ETH",isOnChannel:!1,isPay:!0,isSuccess:!0,isTestNet:e.$store.state.vuexStore.isTestNet,transactionHash:a,blockHash:""};e.$store.state.vuexStore.recordList.push(t),e.$parent.StoreRecordList(e.$store.state.vuexStore.recordList),e.$parent.cycleGetTransactionReceipt(a),e.clearTxData()}})})})},txTncOnChain(){let e=this,t=e.$parent.decryptPrivateKey(e.$store.state.vuexStore.walletInfo.keyStore,e.txOnChainInfo.keyStorePass);web3.eth.getTransactionCount(e.$store.state.vuexStore.walletInfo.address,web3.eth.defaultBlock.pending).then(function(a){console.log(a),web3.eth.getGasPrice().then(function(n){console.log(n);var s=web3.utils.sha3("transfer(address,uint256)").substr(2,8);console.log(s);var o={nonce:web3.utils.toHex(a++),gasPrice:web3.utils.toHex(5*n),gasLimit:web3.utils.toHex(45e5),to:e.$store.state.vuexStore.tncContractAddress,from:e.$store.state.vuexStore.walletInfo.address,value:"0x00",data:"0x"+s+web3.utils.padLeft(e.txOnChainInfo.address.slice(2),64)+web3.utils.padLeft(web3.utils.toHex(1e8*e.txOnChainInfo.amount).substr(2),64)};console.log(o);let r=signData(o,t.privateKey);console.log(r);let i=(new Date).getTime();web3.eth.sendSignedTransaction("0x"+r,function(t,a){if(t)console.log(t);else{console.log(a),e.$notify({title:"成功",dangerouslyUseHTMLString:!0,message:"上链成功，请交易确认",duration:3e3,type:"success"}),e.ShowTxOnChainBox=!1;let t={date:i,name:e.txOnChainInfo.address,Amount:1e8*e.txOnChainInfo.amount,assetType:"TNC",isOnChannel:!1,isPay:!0,state:0,isTestNet:e.$store.state.vuexStore.isTestNet,transactionHash:a,blockHash:""};console.log(e.txOnChainInfo.address),console.log(t),e.$store.state.vuexStore.recordList.push(t),e.$parent.StoreRecordList(e.$store.state.vuexStore.recordList),e.$parent.cycleGetTransactionReceipt(a),e.clearTxData()}})})})},confirmTx(){let e=this;e.$refs.txOnChannelInfo.validate(t=>{if(!t)return console.log("error submit!!"),!1;"ETH"==e.txOnChannelInfo.assetType?e.txEthOnChannel():"TNC"==e.txOnChannelInfo.assetType&&e.txTncOnChannel()})},txEthOnChannel(){},txTncOnChannel(){let e=this;console.log("进入通道交易TNC");let t=e.$parent.getChannelSerial("OtherUri",e.txOnChannelInfo.receiverUri,"open");if(t>=0){e.txOnChannelInfo.sendUri=e.$store.state.vuexStore.channelList[t].SelfUri,e.txOnChannelInfo.ChannelName=e.$store.state.vuexStore.channelList[t].ChannelName,console.log(t);let a={MessageType:"Rsmc",Sender:e.txOnChannelInfo.sendUri,Receiver:e.txOnChannelInfo.receiverUri,TxNonce:e.$store.state.vuexStore.channelList[t].TxNonce+1,ChannelName:e.$store.state.vuexStore.channelList[t].ChannelName,NetMagic:e.$store.state.vuexStore.NetMagic,MessageBody:{AssetType:e.txOnChannelInfo.assetType,PaymentCount:e.txOnChannelInfo.value/1e8,SenderBalance:(e.$store.state.vuexStore.channelList[t].SelfBalance-e.txOnChannelInfo.value)/1e8,ReceiverBalance:(e.$store.state.vuexStore.channelList[t].OtherBalance+e.txOnChannelInfo.value)/1e8,Commitment:""},Comments:{}};e.$store.state.vuexStore.txOnChannelInfo=e.txOnChannelInfo,console.log(e.$store.state.vuexStore.txOnChannelInfo),e.$store.state.vuexStore.channelList[t].websock.send(JSON.stringify(a)),e.ShowTxOnChannelBox=!1,e.clearTxData()}else{if(-1!=t)return-2==t?(e.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"通道未打开",duration:3e3}),e.ShowTxOnChannelBox=!1,void e.clearTxData()):void e.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"未知错误,l值为"+t,duration:3e3});{e.$notify.error({title:"提醒",dangerouslyUseHTMLString:!0,message:"未与该Uri建立通道,开始查询路由",duration:3e3});let t=-1;if(e.$store.state.vuexStore.channelList.forEach(function(e,t){3!==e[State]||3!=e.State||1!=e.isConnect||(i=t)}),t<0)return e.$notify.error({title:"提醒",dangerouslyUseHTMLString:!0,message:"没有开通的通道,请先建立通道",duration:3e3}),!1;{let a={MessageType:"GetRouterInfo",Sender:e.txOnChannelInfo.sendUri,Receiver:e.txOnChannelInfo.receiverUri,Magic:e.$store.state.vuexStore.NetMagic,MessageBody:{AssetType:e.txOnChannelInfo.assetType,NodeList:UrlList}};e.$store.state.vuexStore.txOnChannelInfo=e.txOnChannelInfo,console.log(e.$store.state.vuexStore.txOnChannelInfo),e.$store.state.vuexStore.channelList[t].websock.send(JSON.stringify(a))}}}},clearTxData(){this.txOnChainInfo={address:"",assetType:"",amount:"",keyStorePass:""},this.txOnChannelInfo={sendUri:"",receiverUri:"",hr:"",assetType:"",value:0,fee:0,description:"",ChannelName:"",keyStorePass:""},this.paymentCode="",this.contact=""}}},$={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"indexBox",class:{fullPage:!e.$store.state.vuexStore.isNavShow}},[a("div",{staticClass:"assetBox"},[a("h1",[e._v(e._s(e.$store.state.vuexStore.balanceData.Chain.TNC)+" TNC")]),e._v(" "),a("el-collapse-transition",[a("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowMoreAsset,expression:"isShowMoreAsset"}]},[a("table",{staticClass:"assetTable"},[a("thead",[a("tr",[a("th",[e._v("资产类型")]),e._v(" "),a("th",[e._v("链上金额")]),e._v(" "),a("th",[e._v("通道金额")])])]),e._v(" "),a("tbody",[a("tr",[a("td",[e._v("TNC")]),e._v(" "),a("td",[e._v(e._s(e.balanceData.Chain.TNC))]),e._v(" "),a("td",[e._v(e._s(e.balanceData.Channel.TNC))])]),e._v(" "),a("tr",[a("td",[e._v("ETH")]),e._v(" "),a("td",[e._v(e._s(e.balanceData.Chain.ETH))]),e._v(" "),a("td",[e._v(e._s(e.balanceData.Channel.ETH))])])])])])]),e._v(" "),a("el-button",{staticClass:"showMoreAssetBtn",class:{showMoreAssetBtn_active:e.isShowMoreAsset},attrs:{type:"primary",icon:"el-icon-arrow-down",circle:""},on:{click:function(t){e.showMoreAsset()}}})],1),e._v(" "),a("div",{staticClass:"contentBox"},[a("h2",[e._v("转账")]),e._v(" "),a("hr",{staticStyle:{height:"2px",border:"none","border-top":"2px dotted #EBEEF5"}}),e._v(" "),a("el-form",{ref:"form",staticClass:"indexForm"},[a("label",[e._v("支付码/地址")]),e._v(" "),a("el-select",{staticStyle:{float:"right","margin-bottom":"12px"},attrs:{size:"mini",filterable:"",clearable:"",placeholder:"从联系人里转账"},on:{change:e.contactChange},model:{value:e.contact,callback:function(t){e.contact=t},expression:"contact"}},e._l(e.$store.state.vuexStore.contactList,function(t){return a("el-option",{key:t.address,attrs:{label:t.name,value:t.address}},[a("span",{staticStyle:{float:"left"}},[e._v(e._s(t.name))]),e._v(" "),a("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px",overflow:"hidden","margin-left":"20px",width:"175px","text-overflow":"ellipsis","white-space":"nowrap"}},[e._v(e._s(t.address))])])})),e._v(" "),a("el-form-item",{staticStyle:{"margin-top":"10px"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.paymentCode,callback:function(t){e.paymentCode=t},expression:"paymentCode"}})],1),e._v(" "),a("el-form-item",{staticStyle:{"text-align":"center"}},[a("el-button",{staticClass:"transferBtn",attrs:{type:"primary"},on:{click:function(t){e.decryptPaymentCode()}}},[e._v("转账")])],1)],1)],1),e._v(" "),a("el-dialog",{staticClass:"txOnChainBox",attrs:{title:"链上转账",visible:e.ShowTxOnChainBox,width:"30%",center:"","modal-append-to-body":!1},on:{"update:visible":function(t){e.ShowTxOnChainBox=t}}},[a("el-form",{ref:"txOnChainInfo",staticClass:"demo-ruleForm",attrs:{model:e.txOnChainInfo,"status-icon":"",rules:e.txOnChainRules,"label-width":"70px"}},[a("el-form-item",{attrs:{label:"地址",prop:"address"}},[a("el-input",{attrs:{readonly:"readonly","auto-complete":"off"},model:{value:e.txOnChainInfo.address,callback:function(t){e.$set(e.txOnChainInfo,"address",t)},expression:"txOnChainInfo.address"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"资产类型",prop:"assetType"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择资产类型"},model:{value:e.txOnChainInfo.assetType,callback:function(t){e.$set(e.txOnChainInfo,"assetType",t)},expression:"txOnChainInfo.assetType"}},[a("el-option",{attrs:{label:"TNC",value:"TNC"}}),e._v(" "),a("el-option",{attrs:{label:"ETH",value:"ETH"}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"金额",prop:"amount"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.txOnChainInfo.amount,callback:function(t){e.$set(e.txOnChainInfo,"amount",e._n(t))},expression:"txOnChainInfo.amount"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"密码",prop:"keyStorePass"}},[a("el-input",{attrs:{type:"password","auto-complete":"off"},model:{value:e.txOnChainInfo.keyStorePass,callback:function(t){e.$set(e.txOnChainInfo,"keyStorePass",t)},expression:"txOnChainInfo.keyStorePass"}})],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.txOnChain()}}},[e._v("转账")]),e._v(" "),a("el-button",{on:{click:function(t){e.ShowTxOnChainBox=!1}}},[e._v("取 消")])],1)],1),e._v(" "),a("el-dialog",{staticClass:"txOnChannelBox",attrs:{title:"通道转账",visible:e.ShowTxOnChannelBox,width:"30%",center:"","modal-append-to-body":!1},on:{"update:visible":function(t){e.ShowTxOnChannelBox=t}}},[a("span",[e._v("向"+e._s(e.txOnChannelInfo.receiverUri.split("@")[0]))]),e._v(" "),a("span",{staticStyle:{color:"#F56C6C"}},[e._v("转账"+e._s(e.txOnChannelInfo.value/1e8)+" "+e._s(e.txOnChannelInfo.assetType))]),e._v(" "),a("el-form",{ref:"txOnChannelInfo",staticClass:"demo-ruleForm",attrs:{model:e.txOnChannelInfo,"status-icon":"",rules:e.txOnChannelRules,"label-width":"70px"}},[a("el-form-item",{attrs:{label:"密码",prop:"keyStorePass"}},[a("el-input",{attrs:{type:"password","auto-complete":"off"},model:{value:e.txOnChannelInfo.keyStorePass,callback:function(t){e.$set(e.txOnChannelInfo,"keyStorePass",t)},expression:"txOnChannelInfo.keyStorePass"}})],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.confirmTx()}}},[e._v("转账")]),e._v(" "),a("el-button",{on:{click:function(t){e.ShowTxOnChannelBox=!1}}},[e._v("取 消")])],1)],1)],1)},staticRenderFns:[]};var w=a("VU/8")(C,$,!1,function(e){a("RkMI")},"data-v-590d979b",null).exports,_={name:"startForm",data:()=>({}),methods:{toOtherForm(e){this.$router.push(e)},switchLang(){"cn"===this.$i18n.locale?this.$i18n.locale="en":this.$i18n.locale="cn",this.$parent.saveAsString("lang",this.$i18n.locale)}}},k={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"startForm"},[a("div",{staticClass:"contentBox"},[a("h2",[e._v(e._s(e.$t("start.title")))]),e._v(" "),a("hr",{staticStyle:{height:"2px",border:"none","border-top":"2px dotted #EBEEF5"}}),e._v(" "),a("div",{staticClass:"clooseLoginBox clooseLoginBox-blue",on:{click:function(t){e.toOtherForm("./create")}}},[a("h3",[e._v(e._s(e.$t("start.createWallet")))]),e._v(" "),a("p",[e._v(e._s(e.$t("start.createWalletTxt")))])]),e._v(" "),a("div",{staticClass:"clooseLoginBox clooseLoginBox-green",on:{click:function(t){e.toOtherForm("./loginByPrivateKey")}}},[a("h3",[e._v(e._s(e.$t("start.loginByPrivateKey")))]),e._v(" "),a("p",[e._v(e._s(e.$t("start.loginByPrivateKeyTxt")))])]),e._v(" "),a("div",{staticClass:"clooseLoginBox clooseLoginBox-gray",on:{click:function(t){e.toOtherForm("./loginByKeyStore")}}},[a("h3",[e._v(e._s(e.$t("start.loginByKeystore")))]),e._v(" "),a("p",[e._v(e._s(e.$t("start.loginByKeystoreTxt")))])]),e._v(" "),a("a",{staticClass:"backToStartBtn",on:{click:function(t){e.switchLang()}}},[e._v(e._s(e.$t("navMenu.setting.switchLang")))])])])},staticRenderFns:[]};var I=a("VU/8")(_,k,!1,function(e){a("fGaG")},"data-v-333eb440",null).exports,T={name:"createForm",data(){return{createForm:{pass:"",checkPass:""},createRules:{pass:[{validator:(e,t,a)=>{""===t?a(new Error(this.$t("loginByPrivateKey.callback-1"))):(""!==this.createForm.checkPass&&this.$refs.createForm.validateField("checkPass"),a())},trigger:"blur"}],checkPass:[{validator:(e,t,a)=>{""===t?a(new Error(this.$t("loginByPrivateKey.callback-2"))):t!==this.createForm.pass?a(new Error(this.$t("loginByPrivateKey.callback-3"))):a()},trigger:"blur"}]}}},mounted(){this.$nextTick(function(){})},methods:{toLoginForm(){this.$refs.createForm.validate(e=>{if(!e)return console.log("error submit!!"),!1;{let e=web3.eth.accounts.create().privateKey.slice(2);console.log(e);let t=web3.eth.accounts.encrypt("0x"+e,this.createForm.pass);console.log(t);let a=web3.utils.toChecksumAddress(t.address);console.log(a),web3.utils.checkAddressChecksum(a)&&(this.$store.state.vuexStore.walletInfo.keyStore=t,this.$store.state.vuexStore.walletInfo.address=a,this.$store.state.vuexStore.isLogin=!0,this.$notify({title:this.$t("loginByPrivateKey.callback-4"),dangerouslyUseHTMLString:!0,message:this.$t("loginByPrivateKey.callback-5"),duration:3e3,type:"success"})),this.$router.push("/backup")}this.createForm.pass="",this.createForm.checkPass=""})}}},B={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"createForm",class:{fullPage:!e.$store.state.vuexStore.isNavShow}},[a("div",{staticClass:"contentBox"},[a("h2",[e._v(e._s(e.$t("create.title")))]),e._v(" "),a("hr",{staticStyle:{height:"2px",border:"none","border-top":"2px dotted #EBEEF5"}}),e._v(" "),a("el-form",{ref:"createForm",staticClass:"demo-ruleForm",attrs:{model:e.createForm,"status-icon":"",rules:e.createRules,"label-width":"80px"}},[a("el-form-item",{attrs:{label:e.$t("create.password"),prop:"pass"}},[a("el-input",{attrs:{type:"password","auto-complete":"off"},model:{value:e.createForm.pass,callback:function(t){e.$set(e.createForm,"pass",t)},expression:"createForm.pass"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("create.checkPass"),prop:"checkPass"}},[a("el-input",{attrs:{type:"password","auto-complete":"off"},model:{value:e.createForm.checkPass,callback:function(t){e.$set(e.createForm,"checkPass",t)},expression:"createForm.checkPass"}})],1),e._v(" "),a("el-form-item",{staticStyle:{"text-align":"center"}},[a("el-button",{staticStyle:{"margin-left":"-40px",width:"120px"},attrs:{type:"primary"},on:{click:function(t){e.toLoginForm()}}},[e._v(e._s(e.$t("create.create")))])],1)],1),e._v(" "),a("a",{staticClass:"backToStartBtn",on:{click:function(t){e.$parent.backToStart()}}},[e._v(e._s(e.$t("loginByPrivateKey.backToStart")))])],1)])},staticRenderFns:[]};var L=a("VU/8")(T,B,!1,function(e){a("Khgl")},"data-v-24935bab",null).exports,N={name:"loginByPrivateKeyForm",data(){return{loginByPrivateKeyForm:{privateKey:"",pass:"",checkPass:""},loginByPrivateKeyRules:{privateKey:[{validator:(e,t,a)=>{if(!t)return a(new Error(this.$t("loginByPrivateKey.callback-1")));64!==t.length?a(new Error(this.$t("loginByPrivateKey.callback-2"))):a()},trigger:"blur"}],pass:[{validator:(e,t,a)=>{""===t?a(new Error(this.$t("loginByPrivateKey.callback-3"))):(""!==this.loginByPrivateKeyForm.checkPass&&this.$refs.loginByPrivateKeyForm.validateField("checkPass"),a())},trigger:"blur"}],checkPass:[{validator:(e,t,a)=>{""===t?a(new Error(this.$t("loginByPrivateKey.callback-4"))):t!==this.loginByPrivateKeyForm.pass?a(new Error(this.$t("loginByPrivateKey.callback-5"))):a()},trigger:"blur"}]}}},mounted(){this.$nextTick(function(){})},methods:{Login(){this.$refs.loginByPrivateKeyForm.validate(e=>{if(!e)return console.log("error submit!!"),!1;{let e=web3.eth.accounts.encrypt("0x"+this.loginByPrivateKeyForm.privateKey,this.loginByPrivateKeyForm.pass);console.log(e);let t=web3.utils.toChecksumAddress(e.address);console.log(t),web3.utils.checkAddressChecksum(t)?(this.$store.state.vuexStore.walletInfo.keyStore=e,this.$store.state.vuexStore.walletInfo.address=t,this.$store.state.vuexStore.isLogin=!0,this.$notify({title:this.$t("loginByPrivateKey.callback-6"),dangerouslyUseHTMLString:!0,message:this.$t("loginByPrivateKey.callback-7"),duration:3e3,type:"success"}),this.$router.push("/backup"),this.$store.state.vuexStore.activeNavIndex="3-5"):this.$notify.error({title:this.$t("loginByPrivateKey.callback-8"),dangerouslyUseHTMLString:!0,message:this.$t("loginByPrivateKey.callback-9"),duration:3e3}),this.loginByPrivateKeyForm.privateKey="",this.loginByPrivateKeyForm.pass="",this.loginByPrivateKeyForm.checkPass=""}})}}},F={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"loginByPrivateKeyForm",class:{fullPage:!e.$store.state.vuexStore.isNavShow}},[a("div",{staticClass:"contentBox"},[a("h2",[e._v(e._s(e.$t("loginByPrivateKey.title")))]),e._v(" "),a("hr",{staticStyle:{height:"2px",border:"none","border-top":"2px dotted #EBEEF5"}}),e._v(" "),a("el-form",{ref:"loginByPrivateKeyForm",staticClass:"demo-ruleForm",attrs:{model:e.loginByPrivateKeyForm,"status-icon":"",rules:e.loginByPrivateKeyRules,"label-width":"80px"}},[a("el-form-item",{attrs:{label:e.$t("loginByPrivateKey.privateKey"),prop:"privateKey"}},[a("el-input",{model:{value:e.loginByPrivateKeyForm.privateKey,callback:function(t){e.$set(e.loginByPrivateKeyForm,"privateKey",t)},expression:"loginByPrivateKeyForm.privateKey"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("loginByPrivateKey.password"),prop:"pass"}},[a("el-input",{attrs:{type:"password","auto-complete":"off"},model:{value:e.loginByPrivateKeyForm.pass,callback:function(t){e.$set(e.loginByPrivateKeyForm,"pass",t)},expression:"loginByPrivateKeyForm.pass"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("loginByPrivateKey.checkPass"),prop:"checkPass"}},[a("el-input",{attrs:{type:"password","auto-complete":"off"},model:{value:e.loginByPrivateKeyForm.checkPass,callback:function(t){e.$set(e.loginByPrivateKeyForm,"checkPass",t)},expression:"loginByPrivateKeyForm.checkPass"}})],1),e._v(" "),a("el-form-item",{staticStyle:{"text-align":"center"}},[a("el-button",{staticStyle:{"margin-left":"-40px",width:"120px"},attrs:{type:"primary"},on:{click:function(t){e.Login()}}},[e._v(e._s(e.$t("loginByPrivateKey.import")))])],1)],1),e._v(" "),a("a",{staticClass:"backToStartBtn",on:{click:function(t){e.$parent.backToStart()}}},[e._v(e._s(e.$t("loginByPrivateKey.backToStart")))])],1)])},staticRenderFns:[]};var O=a("VU/8")(N,F,!1,function(e){a("oBBk")},"data-v-3e48d75b",null).exports,M=a("PH7Z"),P={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"loginByKeyStoreForm",class:{fullPage:!e.$store.state.vuexStore.isNavShow}},[a("div",{staticClass:"contentBox loginByKeyStoreContentBox"},[a("h2",[e._v(e._s(e.$t("loginByKeyStore.title")))]),e._v(" "),a("hr",{staticStyle:{height:"2px",border:"none","border-top":"2px dotted #EBEEF5"}}),e._v(" "),a("el-form",{ref:"loginByKeyStoreForm",staticClass:"demo-ruleForm",attrs:{"status-icon":"","label-position":"top","label-width":"80px"}},[a("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{"on-change":e.handleChange,"file-list":e.fileList,accept:".json","auto-upload":!1,limit:1,action:"/"}},[a("el-button",{attrs:{slot:"trigger"},slot:"trigger"},[e._v(e._s(e.$t("loginByKeyStore.chooseKeyStore")))])],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("loginByKeyStore.password"),prop:"keyStorePass"}},[a("el-input",{attrs:{type:"password","auto-complete":"off"},model:{value:e.keyStorePass,callback:function(t){e.keyStorePass=t},expression:"keyStorePass"}})],1),e._v(" "),a("el-form-item",{staticStyle:{"text-align":"center"}},[a("el-button",{staticStyle:{width:"120px"},attrs:{type:"primary"},on:{click:function(t){e.login()}}},[e._v(e._s(e.$t("loginByKeyStore.import")))])],1)],1),e._v(" "),a("a",{staticClass:"backToStartBtn",on:{click:function(t){e.$parent.backToStart()}}},[e._v(e._s(e.$t("loginByPrivateKey.backToStart")))])],1)])},staticRenderFns:[]};var R=function(e){a("fBkZ")},H=a("VU/8")(M.a,P,!1,R,"data-v-19a4e9d1",null).exports,A={name:"backupForm",data:()=>({}),methods:{backup(){if(console.log(this.$store.state.vuexStore.walletInfo.keyStore),this.$store.state.vuexStore.walletInfo.keyStore){var e=JSON.stringify(this.$store.state.vuexStore.walletInfo.keyStore),t=new Blob([e],{type:"text/plain;charset=utf-8"});saveAs(t,this.$store.state.vuexStore.walletInfo.keyStore.id+".json")}else this.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"备份失败，请确认正确导入钱包",duration:3e3})}}},E={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"backupForm",class:{fullPage:!e.$store.state.vuexStore.isNavShow}},[a("div",{staticClass:"contentBox"},[a("h2",[e._v(e._s(e.$t("backup.title")))]),e._v(" "),a("hr",{staticStyle:{height:"2px",border:"none","border-top":"2px dotted #EBEEF5"}}),e._v(" "),a("el-button",{staticStyle:{margin:"10px 0"},attrs:{type:"primary",icon:"el-icon-edit",plain:""},on:{click:function(t){e.backup()}}},[e._v(e._s(e.$t("backup.backupBtn")))]),e._v(" "),a("div",{staticClass:"tipBox tipBox-red"},[a("h3",[e._v(e._s(e.$t("backup.tips")))]),e._v(" "),a("p",[e._v(e._s(e.$t("backup.tipsContent")))])])],1)])},staticRenderFns:[]};var K=a("VU/8")(A,E,!1,function(e){a("VMDT")},"data-v-4a709c01",null).exports,U={name:"contactBox",data(){return{contactList:[],multipleSelection:[],centerDialogVisible:!1,addContactForm:{name:"",address:""},addContactRules:{name:[{validator:(e,t,a)=>{if(""===t)return a(new Error("姓名不能为空"));a()},trigger:"blur"}],address:[{validator:(e,t,a)=>{let n=!1;this.$store.state.vuexStore.contactList.forEach(function(e,a){e.address===t&&(n=!0)}),""===t?a(new Error("地址不能为空")):42!==t.length?a(new Error("地址检测错误")):n?a(new Error("地址已经存在")):a()},trigger:"blur"}]}}},mounted(){this.$nextTick(function(){this.$store.state.vuexStore.isLogin?this.contactList=this.$store.state.vuexStore.contactList:this.$router.push("/start")})},methods:{toggleSelection(e){e?e.forEach(e=>{this.$refs.multipleTable.toggleRowSelection(e)}):this.$refs.multipleTable.clearSelection()},handleSelectionChange(e){this.multipleSelection=e},addContact(){this.$refs.addContactForm.validate(e=>{if(!e)return console.log("error submit!!"),!1;{let e={name:this.addContactForm.name,address:this.addContactForm.address};this.$store.state.vuexStore.contactList.push(e),this.saveAsArray(this.$store.state.vuexStore.walletInfo.address+"@contactList",this.$store.state.vuexStore.contactList),this.centerDialogVisible=!1,this.$message({showClose:!0,message:"添加联系人成功",type:"success"})}})},DeltableData(){let e=this;e.multipleSelection.forEach(function(t,a){e.$store.state.vuexStore.contactList.forEach(function(a,n){a.address===t.address&&e.$store.state.vuexStore.contactList.splice(n,1)}),e.saveAsArray(e.$store.state.vuexStore.walletInfo.address+"@contactList",e.$store.state.vuexStore.contactList)})},transfer(){let e=this.multipleSelection[0].address;this.$store.state.vuexStore.activeNavIndex="1-1",this.$router.push({name:"index",params:{address:e}})},saveAsArray:function(e,t){let a=e.toString();window.localStorage.setItem(a,JSON.stringify(t))}}},D={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"contactBox",class:{fullPage:!e.$store.state.vuexStore.isNavShow}},[a("div",{staticClass:"contentBox"},[a("h2",[e._v("我的联系人")]),e._v(" "),a("hr",{staticStyle:{height:"2px",border:"none","border-top":"2px dotted #EBEEF5"}}),e._v(" "),a("el-button",{staticStyle:{margin:"10px 0"},attrs:{type:"primary",icon:"el-icon-plus",plain:""},on:{click:function(t){e.centerDialogVisible=!0}}},[e._v("添加联系人")]),e._v(" "),a("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.contactList,"tooltip-effect":"dark"},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"60"}}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:"姓名",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:"address",label:"地址"}})],1),e._v(" "),a("div",{staticStyle:{"margin-top":"20px"}},[a("el-button",{attrs:{disabled:1!=e.multipleSelection.length,type:"success",plain:""},on:{click:function(t){e.transfer()}}},[e._v("转账")]),e._v(" "),a("el-button",{attrs:{type:"danger",plain:""},on:{click:function(t){e.DeltableData()}}},[e._v("删除")]),e._v(" "),a("el-button",{attrs:{plain:""},on:{click:function(t){e.toggleSelection()}}},[e._v("取消选择")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"添加联系人",visible:e.centerDialogVisible,width:"40%",center:"","modal-append-to-body":!1},on:{"update:visible":function(t){e.centerDialogVisible=t}}},[a("el-form",{ref:"addContactForm",staticClass:"demo-ruleForm",attrs:{model:e.addContactForm,"status-icon":"",rules:e.addContactRules,"label-width":"50px"}},[a("el-form-item",{attrs:{label:"名称",prop:"name"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.addContactForm.name,callback:function(t){e.$set(e.addContactForm,"name",t)},expression:"addContactForm.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"地址",prop:"address"}},[a("el-input",{model:{value:e.addContactForm.address,callback:function(t){e.$set(e.addContactForm,"address",t)},expression:"addContactForm.address"}})],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.addContact()}}},[e._v("添加")]),e._v(" "),a("el-button",{on:{click:function(t){e.centerDialogVisible=!1}}},[e._v("取 消")])],1)],1)],1)},staticRenderFns:[]};var W=a("VU/8")(U,D,!1,function(e){a("TehK")},"data-v-14c64d76",null).exports,V=a("f3u+"),J=a.n(V);n.default.use(J.a);var z={name:"receiveForm",data:()=>({paymentCodeForm:{amount:"",assetType:"",assetContractAddress:"",selfUri:"",R:"",Hr:"",Code:""},paymentCodeRules:{amount:[{validator:(e,t,a)=>{if(!t)return a(new Error("金额不能为空"));t<0?a(new Error("请输入正确的数字值")):a()},trigger:"blur"}],assetType:[{validator:(e,t,a)=>{""===t?a(new Error("请选择资产类型")):a()},trigger:"change"}]},isPaymentCodeBoxShow:!1}),watch:{},mounted(){this.$nextTick(function(){})},methods:{copyfun(){let e=this;clipboard&&clipboard.destroy(),clipboard=new ClipboardJS(".btncopy"),clipboard.on("success",function(t){e.$notify.info({title:"消息",dangerouslyUseHTMLString:!0,message:"复制成功",duration:3e3})}),clipboard.on("error",function(t){e.$notify.info({title:"警告",dangerouslyUseHTMLString:!0,message:"复制失败，请自行复制",duration:3e3,type:"warning"})})},createPaymentCode(){let e=this;e.$refs.paymentCodeForm.validate(t=>{if(!t)return console.log("error submit!!"),!1;{if(console.log("submit!"),"TNC"==e.paymentCodeForm.assetType)e.paymentCodeForm.assetContractAddress=e.$store.state.vuexStore.tncContractAddress;else{if("ETH"!=e.paymentCodeForm.assetType)return e.$notify.info({title:"警告",dangerouslyUseHTMLString:!0,message:"资产类型出错",duration:3e3,type:"warning"}),!1;e.paymentCodeForm.assetContractAddress=""}if(e.paymentCodeForm.R=createR(),e.paymentCodeForm.Hr=createHr(e.paymentCodeForm.R),e.$store.state.vuexStore.channelList.forEach(function(t,a){3==t.State&&t.assetType==e.paymentCodeForm.assetType&&(e.paymentCodeForm.selfUri=t.SelfUri)}),""==e.paymentCodeForm.selfUri)return e.$notify.info({title:"警告",dangerouslyUseHTMLString:!0,message:"没有该资产类型的通道",duration:3e3,type:"warning"}),!1;let t=e.paymentCodeForm.selfUri+"&"+e.paymentCodeForm.Hr+"&"+e.paymentCodeForm.assetContractAddress+"&"+e.paymentCodeForm.amount+"&PaymentCode";console.log(t),e.paymentCodeForm.Code="TN"+base58encode(t),console.log(e.paymentCodeForm.Code),e.isPaymentCodeBoxShow=!0}})},resetForm(){this.isPaymentCodeBoxShow=!1,this.paymentCodeForm={amount:"",assetType:"",selfUri:"",R:"",Hr:"",Code:""}}}},G={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"receiveForm",class:{fullPage:!e.$store.state.vuexStore.isNavShow}},[a("div",{staticClass:"contentBox"},[a("h2",[e._v("收款")]),e._v(" "),a("hr",{staticStyle:{height:"2px",border:"none","border-top":"2px dotted #EBEEF5"}}),e._v(" "),a("el-tabs",{staticStyle:{width:"100%","max-width":"440px"},attrs:{type:"border-card",stretch:!0}},[a("el-tab-pane",{attrs:{label:"链上"}},[a("div",{staticClass:"QRCodeBox QRCodeBox-white"},[a("h3",[e._v("收款地址")]),e._v(" "),a("qriously",{attrs:{value:this.$store.state.vuexStore.walletInfo.address,level:"H",size:210}}),e._v(" "),a("p",{domProps:{textContent:e._s(this.$store.state.vuexStore.walletInfo.address)}})],1),e._v(" "),a("el-input",{attrs:{id:"receiveAddress",placeholder:"Address",readonly:"readonly"},model:{value:this.$store.state.vuexStore.walletInfo.address,callback:function(t){e.$set(this.$store.state.vuexStore.walletInfo,"address",t)},expression:"this.$store.state.vuexStore.walletInfo.address"}},[a("el-button",{staticClass:"btncopy",attrs:{slot:"append","data-clipboard-target":"#receiveAddress",icon:"el-icon-share"},on:{click:function(t){e.copyfun()}},slot:"append"},[e._v("Copy")])],1)],1),e._v(" "),a("el-tab-pane",{attrs:{label:"通道"}},[e.isPaymentCodeBoxShow?e._e():a("el-form",{ref:"paymentCodeForm",staticClass:"demo-ruleForm",staticStyle:{"text-align":"center"},attrs:{model:e.paymentCodeForm,"status-icon":"",rules:e.paymentCodeRules,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"金额",prop:"amount"}},[a("el-input",{attrs:{type:"number","auto-complete":"off"},model:{value:e.paymentCodeForm.amount,callback:function(t){e.$set(e.paymentCodeForm,"amount",e._n(t))},expression:"paymentCodeForm.amount"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"资产类型",prop:"assetType"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择资产类型"},model:{value:e.paymentCodeForm.assetType,callback:function(t){e.$set(e.paymentCodeForm,"assetType",t)},expression:"paymentCodeForm.assetType"}},[a("el-option",{attrs:{label:"TNC",value:"TNC"}}),e._v(" "),a("el-option",{attrs:{label:"ETH",value:"ETH"}})],1)],1),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.createPaymentCode()}}},[e._v("创建")])],1),e._v(" "),e.isPaymentCodeBoxShow?a("div",[a("el-button",{on:{click:function(t){e.resetForm("ruleForm")}}},[e._v("重置")]),e._v(" "),a("div",{staticClass:"QRCodeBox QRCodeBox-white"},[a("h3",[e._v("收款码")]),e._v(" "),a("qriously",{attrs:{value:e.paymentCodeForm.Code,level:"H",size:210}}),e._v(" "),a("p",{staticStyle:{width:"378px","text-overflow":"ellipsis","white-space":"nowrap",overflow:"hidden"}},[e._v(e._s(e.paymentCodeForm.Code))])],1),e._v(" "),a("el-input",{attrs:{id:"receivePaymentCode",placeholder:"Receive Payment Code"},model:{value:e.paymentCodeForm.Code,callback:function(t){e.$set(e.paymentCodeForm,"Code",t)},expression:"paymentCodeForm.Code"}},[a("el-button",{staticClass:"btncopy",attrs:{slot:"append","data-clipboard-target":"#receivePaymentCode",icon:"el-icon-search"},on:{click:function(t){e.copyfun()}},slot:"append"},[e._v("Copy")])],1)],1):e._e()],1)],1)],1)])},staticRenderFns:[]};var j=a("VU/8")(z,G,!1,function(e){a("0For")},"data-v-16238996",null).exports,q={name:"addChannelForm",data(){return{addChannelForm:{uri:"",assetType:"",selfDeposit:0,otherDeposit:0,alice:"",channelName:"",selfSignedData:"",keyStorePass:""},addChannelRules:{uri:[{validator:(e,t,a)=>{let n=this;if(!t)return a(new Error("对端URI不能为空"));t.indexOf("@")<-1?a(new Error("URI格式不正确")):42!==t.split("@")[0].length?a(new Error("URI格式不正确")):(n.$store.state.vuexStore.channelList.forEach(function(e,t){e.otherUri===n.addChannelForm.uri&&a(new Error("你已经和这个TNAP有一个通道了"))}),a())},trigger:"blur"}],assetType:[{validator:(e,t,a)=>{""===t?a(new Error("请选择资产类型")):a()},trigger:"change"}],selfDeposit:[{validator:(e,t,a)=>{if(""===t)a(new Error("本端押金数量不能为空"));else if(t<=0)a(new Error("本端押金数量必须大于0"));else if(t>this.$store.state.vuexStore.balanceData.Chain[this.addChannelForm.assetType])a(new Error("押金数量不能大于钱包余额"));else if(String(t).indexOf(".")>-1){let e=String(t).indexOf(".")+1;String(t).length-e>8?a(new Error("本端押金小数最多为8位")):a()}else a()},trigger:"blur"}],otherDeposit:[{validator:(e,t,a)=>{""===t?a(new Error("对端押金数量不能为空")):t<=0?a(new Error("对端押金数量必须大于0")):a()},trigger:"blur"}],alice:[{validator:(e,t,a)=>{""===t?a(new Error("通道名称不能为空")):a()},trigger:"blur"}],keyStorePass:[{validator:(e,t,a)=>{if(!t)return a(new Error("钱包密码不能为空，否则将无法交易"));{let e=this.$parent.decryptPrivateKey(this.$store.state.vuexStore.walletInfo.keyStore,t);setTimeout(()=>{if(!e)return a(new Error("钱包解锁失败 - 可能是密码错误"));a()},2e3)}},trigger:"blur"}]}}},methods:{addChannel(){let e=this;e.$refs.addChannelForm.validate(t=>{if(!t)return console.log("error submit!!"),!1;e.$parent.showLoading(),web3.eth.getGasPrice().then(function(t){console.log(t);new web3.eth.Contract(e.$store.state.vuexStore.tncContractAbi,e.$store.state.vuexStore.tncContractAddress,{from:e.$store.state.vuexStore.walletInfo.address,gasPrice:3*t});let a=e.$parent.decryptPrivateKey(e.$store.state.vuexStore.walletInfo.keyStore,e.addChannelForm.keyStorePass);web3.eth.getTransactionCount(e.$store.state.vuexStore.walletInfo.address,web3.eth.defaultBlock.pending).then(function(n){console.log(n);let s=web3.eth.abi.encodeFunctionSignature("approve(address,uint256)");console.log(s);let o=web3.eth.abi.encodeParameters(["address","uint256"],[e.$store.state.vuexStore.trinityContractAddress,1e8*e.addChannelForm.selfDeposit]);console.log(o);var r={nonce:web3.utils.toHex(n++),gasPrice:web3.utils.toHex(3*t),gasLimit:web3.utils.toHex(45e5),to:e.$store.state.vuexStore.tncContractAddress,from:e.$store.state.vuexStore.walletInfo.address,value:"0x00",data:s+o.substr(2)};console.log(r);let i=signData(r,a.privateKey);console.log(i),web3.eth.sendSignedTransaction("0x"+i).on("transactionHash",function(e){console.log(e)}).on("receipt",function(t){console.log(t);let a=e.$parent.uri2Ip(e.addChannelForm.uri,8766);const n="ws://"+a+"/";var s=e.$store.state.vuexStore.channelList.length;console.log(s);let o=e.$store.state.vuexStore.walletInfo.address+"@"+a,r=e.addChannelForm.uri.split("@")[0],i=(new Date).getTime(),l=md5encode(e.addChannelForm.uri,i),c=md5encode(o,i);e.addChannelForm.channelName="0x"+l+c,console.log(e.addChannelForm.channelName);var d={websock:new WebSocket(n)};console.log(d),e.$store.state.vuexStore.channelList.push(d),e.$store.state.vuexStore.channelList[s].websock.onmessage=e.$parent.websocketOnmessage,e.$store.state.vuexStore.channelList[s].websock.onclose=e.$parent.websocketClose;let u=web3.utils.soliditySha3({t:"bytes32",v:e.addChannelForm.channelName},{t:"uint256",v:0},{t:"address",v:e.$store.state.vuexStore.walletInfo.address},{t:"uint256",v:1e8*e.addChannelForm.selfDeposit},{t:"address",v:r},{t:"uint256",v:1e8*e.addChannelForm.otherDeposit});console.log(u);let h=e.$parent.decryptPrivateKey(e.$store.state.vuexStore.walletInfo.keyStore,e.addChannelForm.keyStorePass),p=ecSign(u,h.privateKey);console.log(p),e.addChannelForm.selfSignedData=p;var v={MessageType:"Founder",Sender:o,Receiver:e.addChannelForm.uri,TxNonce:0,ChannelName:e.addChannelForm.channelName,NetMagic:e.$store.state.vuexStore.NetMagic,MessageBody:{FounderDeposit:parseInt(1e8*e.addChannelForm.selfDeposit)/1e8,PartnerDeposit:parseInt(1e8*e.addChannelForm.otherDeposit)/1e8,Commitment:e.addChannelForm.selfSignedData,AssetType:e.addChannelForm.assetType}};setTimeout(function(){e.$store.state.vuexStore.channelList[s].websock.send(JSON.stringify(v))},2e3),e.$store.state.vuexStore.addChannelInfo=e.addChannelForm,console.log(e.$store.state.vuexStore.addChannelInfo),e.$store.state.vuexStore.channelList[s].ChannelName=e.addChannelForm.channelName,e.$store.state.vuexStore.channelList[s].Alice=e.addChannelForm.alice,e.$store.state.vuexStore.channelList[s].State=2,e.$store.state.vuexStore.channelList[s].isConnect=!0,e.$store.state.vuexStore.channelList[s].SelfBalance=1e8*e.addChannelForm.selfDeposit,e.$store.state.vuexStore.channelList[s].OtherBalance=1e8*e.addChannelForm.otherDeposit,e.$store.state.vuexStore.channelList[s].assetType=e.addChannelForm.assetType,e.$store.state.vuexStore.channelList[s].isTestNet=!0,e.$store.state.vuexStore.channelList[s].SelfUri=o,e.$store.state.vuexStore.channelList[s].OtherUri=e.addChannelForm.uri,e.$store.state.vuexStore.channelList[s].TxNonce=0,e.$store.state.vuexStore.channelList[s].date=i,e.$store.state.vuexStore.channelList[s].Ip=e.$parent.uri2Ip(e.addChannelForm.uri,null),e.$parent.StoreChannel(),e.$router.push("/channelList"),e.$parent.closeLoading()}).on("confirmation",function(e,t){}).on("error",console.error)})})})},CreateFounder(){},removeAddChannelData(){this.$refs.addChannelForm.resetFields(),this.$router.push("/channelList")}}},Q={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"addChannelBox"},[a("div",{staticClass:"contentBox"},[a("div",[e.addChannelForm.assetType?a("p",{staticStyle:{float:"right",margin:"5px 0"}},[e._v("资产余额："+e._s(e.$store.state.vuexStore.balanceData.Chain[e.addChannelForm.assetType])+e._s(e.addChannelForm.assetType))]):e._e(),e._v(" "),a("h2",[e._v("添加通道")])]),e._v(" "),a("hr",{staticStyle:{height:"2px",border:"none","border-top":"2px dotted #EBEEF5"}}),e._v(" "),a("el-form",{ref:"addChannelForm",staticClass:"addChannelForm",attrs:{model:e.addChannelForm,"status-icon":"",rules:e.addChannelRules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"对端URI",prop:"uri"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.addChannelForm.uri,callback:function(t){e.$set(e.addChannelForm,"uri",t)},expression:"addChannelForm.uri"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"资产类型",prop:"assetType"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择资产类型"},model:{value:e.addChannelForm.assetType,callback:function(t){e.$set(e.addChannelForm,"assetType",t)},expression:"addChannelForm.assetType"}},[a("el-option",{attrs:{label:"TNC",value:"TNC"}}),e._v(" "),a("el-option",{attrs:{label:"ETH",value:"ETH",disabled:""}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"本端押金",prop:"selfDeposit"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.addChannelForm.selfDeposit,callback:function(t){e.$set(e.addChannelForm,"selfDeposit",e._n(t))},expression:"addChannelForm.selfDeposit"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"对端押金",prop:"otherDeposit"}},[a("el-slider",{attrs:{"show-input-controls":!1,max:e.addChannelForm.selfDeposit,step:1e-8,"show-input":""},model:{value:e.addChannelForm.otherDeposit,callback:function(t){e.$set(e.addChannelForm,"otherDeposit",t)},expression:"addChannelForm.otherDeposit"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"通道名称",prop:"alice"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.addChannelForm.alice,callback:function(t){e.$set(e.addChannelForm,"alice",t)},expression:"addChannelForm.alice"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"密码",prop:"keyStorePass"}},[a("el-input",{attrs:{type:"password","auto-complete":"off"},model:{value:e.addChannelForm.keyStorePass,callback:function(t){e.$set(e.addChannelForm,"keyStorePass",t)},expression:"addChannelForm.keyStorePass"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.addChannel()}}},[e._v("添加通道")]),e._v(" "),a("el-button",{on:{click:function(t){e.removeAddChannelData()}}},[e._v("返回")])],1)],1)],1)])},staticRenderFns:[]};var Z=a("VU/8")(q,Q,!1,function(e){a("sGfP")},"data-v-16cfde55",null).exports,X={name:"channelListForm",data(){return{isChannelInfoBoxShow:!1,activeInfo:{Alice:"",date:"",ChannelName:"",SelfUri:"",SelfBalance:"",OtherUri:"",OtherBalance:"",assetType:"",isConnect:"",isTestNet:"",State:"",keyStorePass:""},isConfirmCloseChannel:!1,confirmCloseRules:{keyStorePass:[{validator:(e,t,a)=>{if(!t)return a(new Error("钱包密码不能为空，否则将无法交易"));{let e=this.$parent.decryptPrivateKey(this.$store.state.vuexStore.walletInfo.keyStore,this.activeInfo.keyStorePass);setTimeout(()=>{if(!e)return a(new Error("钱包解锁失败 - 可能是密码错误"));a()},2e3)}},trigger:"blur"}]}}},computed:{channelList(){return this.$store.state.vuexStore.channelList}},filters:{formatStatus:function(e){let t;switch(e){case 1:t="Closing";break;case 2:t="Opening";break;case 3:t="Open";break;default:t="Error"}return t},formatBalance:function(e){let t;return t=e<0||isNaN(e)?"error":e/1e8},formatDateTime:function(e){let t=new Date;t.setTime(e);let a=t.getFullYear(),n=t.getMonth()+1;n=n<10?"0"+n:n;let s=t.getDate();return a+"-"+n+"-"+(s=s<10?"0"+s:s)},formatConnect:function(e){let t;return t=e?"已连接":"未连接"},formatNet:function(e){let t;return t=e?"测试网":"主网"}},mounted(){this.$nextTick(function(){0==this.$store.state.vuexStore.channelList.length&&this.$router.push("/addChannel")})},watch:{"$store.state.vuexStore.walletInfo.channelList":"getAddressInfo"},methods:{showChannelInfo(e,t){this.isChannelInfoBoxShow=!0,this.activeInfo=e,this.activeInfo.keyStorePass="",console.log(t),console.log(e)},showConfirmCloseChannelData(){this.isConfirmCloseChannel=!0},closeChannel(){let e=this;e.$refs.activeInfo.validate(t=>{if(!t)return console.log("error submit!!"),!1;{let t=this.$parent.getChannelSerial("ChannelName",e.activeInfo.ChannelName);if(console.log(t),-1===t)return void e.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"未找到该通道,请重试一次",duration:3e3});if(console.log(e.$store.state.vuexStore.channelList[t].isConnect),1==e.$store.state.vuexStore.channelList[t].isConnect){let a=web3.utils.soliditySha3({t:"bytes32",v:e.activeInfo.ChannelName},{t:"uint256",v:4294967295},{t:"address",v:e.$store.state.vuexStore.walletInfo.address},{t:"uint256",v:e.activeInfo.SelfBalance},{t:"address",v:e.activeInfo.OtherUri.split("@")[0]},{t:"uint256",v:e.activeInfo.OtherBalance});console.log(a);let n=e.$parent.decryptPrivateKey(e.$store.state.vuexStore.walletInfo.keyStore,e.activeInfo.keyStorePass),s=ecSign(a,n.privateKey);console.log(s);let o={MessageType:"Settle",Sender:e.activeInfo.SelfUri,Receiver:e.activeInfo.OtherUri,TxNonce:4294967295,ChannelName:e.activeInfo.ChannelName,AssetType:e.activeInfo.assetType,NetMagic:e.$store.state.vuexStore.NetMagic,MessageBody:{Commitment:s,SenderBalance:e.activeInfo.SelfBalance/1e8,ReceiverBalance:e.activeInfo.OtherBalance/1e8},Comments:{}};e.$store.state.vuexStore.channelList[t].websock.send(JSON.stringify(o)),e.$store.state.vuexStore.closeChannelInfo=e.activeInfo,console.log(e.$store.state.vuexStore.closeChannelInfo.keyStorePass),e.$store.state.vuexStore.closeChannelInfo.selfSignedData=s,e.$store.state.vuexStore.channelList[t].State=1,e.isChannelInfoBoxShow=!1,e.isConfirmCloseChannel=!1}else console.log("\b进入强制拆通道")}})}}},Y={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"channelListForm",class:{fullPage:!e.$store.state.vuexStore.isNavShow}},[a("div",{staticClass:"contentBox"},[a("div",[a("router-link",{staticStyle:{float:"right"},attrs:{to:"/addChannel"}},[a("el-button",{attrs:{size:"mini",icon:"el-icon-plus",type:"primary"}},[e._v("添加通道")])],1),e._v(" "),a("h2",[e._v("通道列表")])],1),e._v(" "),a("hr",{staticStyle:{height:"2px",border:"none","border-top":"2px dotted #EBEEF5"}}),e._v(" "),e.channelList.length?a("ul",e._l(e.channelList,function(t,n){return a("li",{key:n,on:{click:function(a){e.showChannelInfo(t,n)}}},[a("h3",[e._v(e._s(t.Alice))]),a("br"),e._v(" "),a("p",[e._v(e._s(e._f("formatDateTime")(t.date)))]),e._v(" "),t.isConnect?a("p",[e._v("State："+e._s(e._f("formatStatus")(t.State)))]):e._e(),e._v(" "),t.isConnect?e._e():a("p",[e._v("State：NotConnect")]),e._v(" "),a("span",[e._v(e._s(e._f("formatBalance")(t.SelfBalance))),a("sup",[e._v(e._s(t.assetType))])])])})):e._e(),e._v(" "),e.channelList.length?e._e():a("p",{staticStyle:{"text-align":"center","margin-top":"20vh","font-size":"14px",color:"#5e6d82","line-height":"1.5em","font-weight":"400"}},[e._v("\n          还没有通道，立即去添加\n      ")])]),e._v(" "),a("el-dialog",{staticClass:"channelInfoBox",attrs:{title:e.activeInfo.Alice,visible:e.isChannelInfoBoxShow,width:"30%",center:"","modal-append-to-body":!1},on:{"update:visible":function(t){e.isChannelInfoBoxShow=t}}},[a("span",[e._v("通道名称："+e._s(e.activeInfo.ChannelName))]),e._v(" "),a("span",[e._v("开通时间："+e._s(e._f("formatDateTime")(e.activeInfo.date)))]),e._v(" "),a("span",[e._v("本端地址："+e._s(e.activeInfo.SelfUri))]),e._v(" "),a("span",[e._v("本端余额："+e._s(e._f("formatBalance")(e.activeInfo.SelfBalance))+e._s(e.activeInfo.assetType))]),e._v(" "),a("span",[e._v("对端地址："+e._s(e.activeInfo.OtherUri))]),e._v(" "),a("span",[e._v("对端余额："+e._s(e._f("formatBalance")(e.activeInfo.OtherBalance))+e._s(e.activeInfo.assetType))]),e._v(" "),a("span",[e._v("通道状态："+e._s(e._f("formatStatus")(e.activeInfo.State)))]),e._v(" "),a("span",[e._v("是否连接："+e._s(e._f("formatConnect")(e.activeInfo.isConnect)))]),e._v(" "),a("span",[e._v("网络："+e._s(e._f("formatNet")(e.activeInfo.isTestNet)))]),e._v(" "),e.isConfirmCloseChannel?e._e():a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"danger"},on:{click:function(t){e.showConfirmCloseChannelData()}}},[e._v(" 关闭通道 ")])],1),e._v(" "),e.isConfirmCloseChannel?a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-form",{ref:"activeInfo",staticClass:"demo-ruleForm",attrs:{model:e.activeInfo,"status-icon":"",rules:e.confirmCloseRules,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"密码",prop:"keyStorePass"}},[a("el-input",{attrs:{placeholder:"在此输入密码",type:"password","auto-complete":"off"},model:{value:e.activeInfo.keyStorePass,callback:function(t){e.$set(e.activeInfo,"keyStorePass",t)},expression:"activeInfo.keyStorePass"}})],1),e._v(" "),a("el-form-item",{staticStyle:{"text-align":"center","margin-left":"-80px"}},[a("el-button",{attrs:{type:"danger"},on:{click:function(t){e.closeChannel()}}},[e._v(" 确定 ")]),e._v(" "),a("el-button",{on:{click:function(t){e.isChannelInfoBoxShow=!1,e.isConfirmCloseChannel=!1}}},[e._v(" 取消 ")])],1)],1)],1):e._e()])],1)},staticRenderFns:[]};var ee=a("VU/8")(X,Y,!1,function(e){a("LPdT")},"data-v-7e21c17e",null).exports,te={name:"recordForm",data:()=>({isRecordInfoBoxShow:!1,activeInfo:{date:"",name:"",Amount:"",assetType:"",isOnChannel:!0,isPay:!0,isSuccess:!0,transactionHash:""}}),filters:{formatAddress:function(e){return e.replace(/(.{5}).*(.{5})/,"$1......$2")},formatIsOnChannel:function(e){return e?"通道":"链上"},formatState:function(e){let t;switch(e){case-1:t="Fail";break;case 0:t="Pending";break;case 1:t="Success"}return t},formatIsPay:function(e){return e?"-":"+"},formatDateTime:function(e){var t=new Date,a=t.getFullYear(),n=t.getMonth()+1;n=n<10?"0"+n:n;var s=t.getDate();return a+"-"+n+"-"+(s=s<10?"0"+s:s)}},computed:{recordList(){return this.$store.state.vuexStore.recordList}},methods:{showRecordInfo(e){this.isRecordInfoBoxShow=!0,this.activeInfo=e,console.log(e)},formatRecordList(e){let t=[];var a;this.$store.state.vuexStore.isTestNet?e.forEach(function(e,a){e.isTestNet&&t.push(e)}):e.forEach(function(e,a){!1===e.isTestNet&&t.push(e)});for(var n=0;n<t.length;n++)for(var s=n;s<t.length;s++)t[n].date<t[s].date&&(a=t[s],t[s]=t[n],t[n]=a);return t},testfun(){let e="0xDd1C2C608047Bd98962Abf15f9f074620f9d44bf@106.15.91.150:8089&48c3075df5730554ea78c5529efe279cda2a236b&0x65096f2B7A8dc1592479F1911cd2B98dae4d2218&1&PaymentCode";console.log(e);let t="TN"+base58encode(e);console.log(t);let a={messageType:"test",walletAddress:this.$store.state.vuexStore.walletInfo.address,comments:""};this.$store.state.vuexStore.NodeUriWebSocket.send(JSON.stringify(a))}}},ae={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"recordForm",class:{fullPage:!e.$store.state.vuexStore.isNavShow}},[a("div",{staticClass:"contentBox"},[a("h2",{on:{click:function(t){e.testfun()}}},[e._v("交易记录")]),e._v(" "),a("hr",{staticStyle:{height:"2px",border:"none","border-top":"2px dotted #EBEEF5"}}),e._v(" "),e.formatRecordList(e.recordList).length?a("ul",e._l(e.formatRecordList(e.recordList),function(t,n){return a("li",{key:n,on:{click:function(a){e.showRecordInfo(t,n)}}},[a("h3",[e._v(e._s(e._f("formatAddress")(t.name))+" - "+e._s(e._f("formatIsOnChannel")(t.isOnChannel)))]),a("br"),e._v(" "),a("p",[e._v(e._s(e._f("formatDateTime")(t.date)))]),e._v(" "),a("p",[e._v("State："+e._s(e._f("formatState")(t.state)))]),e._v(" "),a("span",[e._v(e._s(e._f("formatIsPay")(t.isPay))+e._s(t.Amount/1e8)),a("sup",[e._v(e._s(t.assetType))])])])})):e._e(),e._v(" "),e.formatRecordList(e.recordList).length?e._e():a("p",{staticStyle:{"text-align":"center","margin-top":"20vh","font-size":"14px",color:"#5e6d82","line-height":"1.5em","font-weight":"400"}},[e._v("\n          还没有交易，立即去转账\n      ")])]),e._v(" "),a("el-dialog",{staticClass:"recordInfoBox",attrs:{title:"通道信息",visible:e.isRecordInfoBoxShow,width:"30%",center:"","modal-append-to-body":!1},on:{"update:visible":function(t){e.isRecordInfoBoxShow=t}}},[a("span",[e._v("对端地址："+e._s(e.activeInfo.name))]),e._v(" "),a("span",[e._v("交易时间："+e._s(e._f("formatDateTime")(e.activeInfo.date)))]),e._v(" "),a("span",[e._v("交易金额："+e._s(e.activeInfo.Amount/1e8)+e._s(e.activeInfo.assetType))]),e._v(" "),a("span",[e._v("交易方式："+e._s(e._f("formatIsOnChannel")(e.activeInfo.isOnChannel)))]),e._v(" "),a("span",[e._v("交易结果："+e._s(e._f("formatState")(e.activeInfo.state)))]),e._v(" "),a("span",[e._v("transactionHash: "+e._s(e.activeInfo.transactionHash))]),e._v(" "),a("span",[e._v("blockHash: "+e._s(e.activeInfo.blockHash))]),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.isRecordInfoBoxShow=!1}}},[e._v(" 关闭 ")])],1)])],1)},staticRenderFns:[]};var ne=a("VU/8")(te,ae,!1,function(e){a("l9/a")},"data-v-3d9c505e",null).exports,se={name:"aboutForm",data:()=>({}),filters:{},methods:{}},oe={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"aboutForm",class:{fullPage:!e.$store.state.vuexStore.isNavShow}},[n("div",{staticClass:"contentBox"},[n("h2",[e._v("关于我们")]),e._v(" "),n("hr",{staticStyle:{height:"2px",border:"none","border-top":"2px dotted #EBEEF5"}}),e._v(" "),n("div",{staticStyle:{"text-align":"center"}},[n("img",{attrs:{src:a("N+8p"),alt:"Trinity"}}),e._v(" "),n("h4",[e._v("Trinity Wallet for ETH")]),e._v(" "),n("p",[e._v("Version: V"+e._s(e.$store.state.vuexStore.version))])]),e._v(" "),e._m(0)])])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("p",[this._v("The Trinity Wallet was created to be an extraordinary wallet of the state channel, it supports Trinity  Protocol to be a universal scaling solution for any blockchain.")]),this._v(" "),t("p",[t("b",[this._v("Tips:  ")]),this._v("Please keep your private key, and confirm that the channel has been closed before unloading the App or deleting the date of the it, otherwise the infomation of channel will be lost.")])])}]};var re=a("VU/8")(se,oe,!1,function(e){a("7yhV")},"data-v-e2e4e278",null).exports;n.default.use(b.a);var ie=new b.a({routes:[{path:"/",name:"index",component:w},{path:"/backup",name:"BackupForm",component:K},{path:"/contact",name:"contactForm",component:W},{path:"/receive",name:"receiveForm",component:j},{path:"/start",name:"startForm",component:I},{path:"/create",name:"createForm",component:L},{path:"/loginByPrivateKey",name:"loginByPrivateKeyForm",component:O},{path:"/loginByKeyStore",name:"loginByKeyStoreForm",component:H},{path:"/addChannel",name:"addChannelForm",component:Z},{path:"/about",name:"aboutForm",component:re},{path:"/channelList",name:"channelListForm",component:ee},{path:"/record",name:"recordForm",component:ne}],mode:"hash"}),le=a("zL8q"),ce=a.n(le),de=(a("tvR6"),a("NYxO")),ue=a("urW8"),he=a.n(ue),pe=a("TXmL");a("wUZ8");var ve={navMenu:{title:"Menu",wallet:{title:"Wallet",index:"Home",receive:"Receive",addChannel:"Add Channel",channelList:"Channel",record:"Record"},contact:"Contact",setting:{title:"Setting",switchLang:"更改语言",switchNet:"Switch Net",nightMode:"Night Mode",changePass:"Change Pass",backup:"Backup",signOut:"Sign Out"},about:"About Us"},start:{title:"Welcome",createWallet:"Create Wallet",loginByPrivateKey:"Import by Private Key",loginByKeystore:"Restore form the Backup File",createWalletTxt:"Create a new wallet and start a transaction of crypto asset",loginByPrivateKeyTxt:"You can import your wallet by your private key",loginByKeystoreTxt:"If you once backed up your files, you can import the wallet by the files"},create:{title:"Create Wallet",password:"Password",checkPass:"CheckPass",create:"Create","callback-1":"Please input the password","callback-2":"Please repeat the password","callback-3":"Passwords don't match","callback-4":"Succeed","callback-5":"Create Succeed","callback-6":"Succeed","callback-7":"Warning","callback-8":"Create failed, please again"},loginByPrivateKey:{title:"Import the Private Key",privateKey:"PrivateKey",password:"Password",checkPass:"CheckPass",import:"Import",backToStart:"Back to start page","callback-1":"Private key can not be empty","callback-2":"Please input the correct private key","callback-3":"Please input the password","callback-4":"Please repeat the password","callback-5":"Passwords don't match","callback-6":"Succeed","callback-7":"Import succeed","callback-8":"Warning","callback-9":"Import failed, please confirm the private key"},loginByKeyStore:{title:"Restore form the Backup File",chooseKeyStore:"Choose the File",password:"Password",import:"Import","callback-1":"Warning","callback-2":"KeyStore file read error","callback-3":"Warning","callback-4":"KeyStore file can not be empty","callback-5":"Warning","callback-6":"Please input the password","callback-7":"Warning","callback-8":"Key derivation failed - possibly wrong password","callback-9":"Warning","callback-10":"Succeed","callback-11":"Restore succeed","callback-12":"Warning","callback-12":"Restore failed，please confirm the file and password"},backup:{title:"Backup",backupBtn:"Backup Wallet",tips:"Tips",tipsContent:"After backed up the wallet, the system will generate a wallet backup file. When you clear the data, change the browser, or reinstall the system, you can use the wallet backup file to restore the wallet. Please save the file and the wallet password. Once lost wallet files or forgotten wallet passwords you may lost your assets."}};a("Vi3T");var ye={en:ve,cn:{navMenu:{title:"菜单",wallet:{title:"钱包",index:"首页",receive:"收款",addChannel:"添加通道",channelList:"通道",record:"交易记录"},contact:"联系人",setting:{title:"设置",switchLang:"Switch Language",switchNet:"选择网络",nightMode:"夜间模式",changePass:"修改密码",backup:"备份",signOut:"退出"},about:"关于我们"},start:{title:"欢迎",createWallet:"创建新钱包",loginByPrivateKey:"从私钥导入",loginByKeystore:"从备份文件恢复",createWalletTxt:"创建新钱包开始加密货币交易之旅",loginByPrivateKeyTxt:"可以通过导入私钥的方式将钱包导入",loginByKeystoreTxt:"如果之前备份文件，也可以通过备份文件的方式导入钱包"},create:{title:"创建钱包",password:"密码",checkPass:"确认密码",create:"创建","callback-1":"请输入密码","callback-2":"请再次输入密码","callback-3":"两次输入密码不一致","callback-4":"成功","callback-5":"创建成功","callback-6":"成功","callback-7":"警告","callback-8":"创建失败,请再试一次"},loginByPrivateKey:{title:"导入私钥",privateKey:"私钥",password:"密码",checkPass:"确认密码",import:"导入",backToStart:"返回开始界面","callback-1":"私钥不能为空","callback-2":"请输入正确的私钥","callback-3":"请输入密码","callback-4":"请再次输入密码","callback-5":"两次输入密码不一致","callback-6":"成功","callback-7":"导入成功","callback-8":"警告","callback-9":"导入失败，请确认私钥正确"},loginByKeyStore:{title:"从备份文件恢复",chooseKeyStore:"选取文件",password:"密码",import:"导入","callback-1":"警告","callback-2":"KeyStore文件读取错误","callback-3":"警告","callback-4":"KeyStore文件不能为空","callback-5":"警告","callback-6":"密码不能为空","callback-7":"警告","callback-8":"钱包解锁失败 - 可能是密码错误","callback-9":"警告","callback-10":"成功","callback-11":"导入成功","callback-12":"警告","callback-12":"导入失败，请确认KeyStore和密码正确"},backup:{title:"备份",backupBtn:"备份钱包",tips:"温馨提醒",tipsContent:"备份当前钱包后，浏览器会生成一个钱包备份文件，当您清空数据库、或者更换 浏览器、重装系统后，可以使用钱包备份文件恢复当前钱包。同时保存好文件和 钱包密码，钱包文件丢失或忘记密码可能会导致您的资产丢失。"}}};n.default.use(pe.a);const me=new pe.a({locale:localStorage.lang||"cn",messages:ye});he.a.i18n((e,t)=>me.vm._t(e,t));var fe=me,ge=(a("7xIN"),{state:{version:"0.0.1",isLogin:!1,isTestNet:!0,isNightMode:!1,activeNavIndex:"1-1",isNavShow:!0,isMessageBoxShow:!1,NetMagic:"195378745719990331",NodeUriWebSocket:"",tncContractAddress:"0x65096f2B7A8dc1592479F1911cd2B98dae4d2218",tncContractAbi:[{constant:!0,inputs:[],name:"mintingFinished",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"name",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_spender",type:"address"},{name:"_value",type:"uint256"}],name:"approve",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"totalSupply",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_from",type:"address"},{name:"_to",type:"address"},{name:"_value",type:"uint256"}],name:"transferFrom",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"decimals",outputs:[{name:"",type:"uint8"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"cap",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[],name:"unpause",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"_to",type:"address"},{name:"_amount",type:"uint256"}],name:"mint",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"_value",type:"uint256"}],name:"burn",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"paused",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_spender",type:"address"},{name:"_subtractedValue",type:"uint256"}],name:"decreaseApproval",outputs:[{name:"success",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"_owner",type:"address"}],name:"balanceOf",outputs:[{name:"balance",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[],name:"finishMinting",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[],name:"pause",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"owner",outputs:[{name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"symbol",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_to",type:"address"},{name:"_value",type:"uint256"}],name:"transfer",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"_spender",type:"address"},{name:"_addedValue",type:"uint256"}],name:"increaseApproval",outputs:[{name:"success",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"_owner",type:"address"},{name:"_spender",type:"address"}],name:"allowance",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"newOwner",type:"address"}],name:"transferOwnership",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"burner",type:"address"},{indexed:!1,name:"value",type:"uint256"}],name:"Burn",type:"event"},{anonymous:!1,inputs:[],name:"Pause",type:"event"},{anonymous:!1,inputs:[],name:"Unpause",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"to",type:"address"},{indexed:!1,name:"amount",type:"uint256"}],name:"Mint",type:"event"},{anonymous:!1,inputs:[],name:"MintFinished",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"owner",type:"address"},{indexed:!0,name:"spender",type:"address"},{indexed:!1,name:"value",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"from",type:"address"},{indexed:!0,name:"to",type:"address"},{indexed:!1,name:"value",type:"uint256"}],name:"Transfer",type:"event"}],trinityContractAddress:"0x1002D9FE1afD4DDB629E3fcdB578297EFf380106",trinityContractAbi:[{anonymous:!1,inputs:[{indexed:!1,name:"tokenValue",type:"address"}],name:"SetToken",type:"event"},{constant:!1,inputs:[{name:"channelId",type:"bytes32"},{name:"nonce",type:"uint256"},{name:"closer",type:"address"},{name:"closeBalance",type:"uint256"},{name:"partner",type:"address"},{name:"partnerBalance",type:"uint256"},{name:"closerSignature",type:"bytes"},{name:"partnerSignature",type:"bytes"}],name:"closeChannel",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"channelId",type:"bytes32"},{name:"nonce",type:"uint256"},{name:"funderAddress",type:"address"},{name:"funderAmount",type:"uint256"},{name:"partnerAddress",type:"address"},{name:"partnerAmount",type:"uint256"},{name:"funderSignature",type:"bytes"},{name:"partnerSignature",type:"bytes"}],name:"deposit",outputs:[],payable:!0,stateMutability:"payable",type:"function"},{constant:!1,inputs:[{name:"channelId",type:"bytes32"},{name:"nonce",type:"uint256"},{name:"closer",type:"address"},{name:"closerBalance",type:"uint256"},{name:"partner",type:"address"},{name:"partnerBalance",type:"uint256"},{name:"closerSignature",type:"bytes"},{name:"partnerSignature",type:"bytes"}],name:"quickCloseChannel",outputs:[],payable:!0,stateMutability:"payable",type:"function"},{constant:!1,inputs:[{name:"blockNumber",type:"uint256"}],name:"setSettleTimeout",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"channelId",type:"bytes32"}],name:"settleTransaction",outputs:[],payable:!0,stateMutability:"payable",type:"function"},{constant:!1,inputs:[{name:"tokenAddress",type:"address"}],name:"setToken",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"channelId",type:"bytes32"},{name:"nonce",type:"uint256"},{name:"funderAddress",type:"address"},{name:"funderAmount",type:"uint256"},{name:"partnerAddress",type:"address"},{name:"partnerAmount",type:"uint256"},{name:"funderSignature",type:"bytes"},{name:"partnerSignature",type:"bytes"}],name:"updateDeposit",outputs:[],payable:!0,stateMutability:"payable",type:"function"},{constant:!1,inputs:[{name:"channelId",type:"bytes32"},{name:"nonce",type:"uint256"},{name:"partnerA",type:"address"},{name:"updateBalanceA",type:"uint256"},{name:"partnerB",type:"address"},{name:"updateBalanceB",type:"uint256"},{name:"signedStringA",type:"bytes"},{name:"signedStringB",type:"bytes"}],name:"updateTransaction",outputs:[],payable:!0,stateMutability:"payable",type:"function"},{constant:!1,inputs:[{name:"channelId",type:"bytes32"},{name:"nonce",type:"uint256"},{name:"sender",type:"address"},{name:"receiver",type:"address"},{name:"lockTime",type:"uint256"},{name:"lockAmount",type:"uint256"},{name:"lockHash",type:"bytes32"},{name:"partnerAsignature",type:"bytes"},{name:"partnerBsignature",type:"bytes"},{name:"secret",type:"bytes32"}],name:"withdraw",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"channelId",type:"bytes32"},{name:"nonce",type:"uint256"},{name:"sender",type:"address"},{name:"receiver",type:"address"},{name:"lockTime",type:"uint256"},{name:"lockAmount",type:"uint256"},{name:"lockHash",type:"bytes32"},{name:"partnerAsignature",type:"bytes"},{name:"partnerBsignature",type:"bytes"},{name:"secret",type:"bytes32"}],name:"withdrawSettle",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"channelId",type:"bytes32"},{name:"nonce",type:"uint256"},{name:"sender",type:"address"},{name:"receiver",type:"address"},{name:"lockTime",type:"uint256"},{name:"lockAmount",type:"uint256"},{name:"lockHash",type:"bytes32"},{name:"partnerAsignature",type:"bytes"},{name:"partnerBsignature",type:"bytes"}],name:"withdrawUpdate",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!1,name:"channleId",type:"bytes32"},{indexed:!1,name:"hashLock",type:"bytes32"}],name:"WithdrawUpdate",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"timeoutBlock",type:"uint256"}],name:"SetSettleTimeout",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"channleId",type:"bytes32"},{indexed:!1,name:"hashLock",type:"bytes32"}],name:"WithdrawSettle",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"channleId",type:"bytes32"},{indexed:!1,name:"hashLock",type:"bytes32"}],name:"Withdraw",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"channleId",type:"bytes32"},{indexed:!1,name:"partnerA",type:"address"},{indexed:!1,name:"partnerB",type:"address"},{indexed:!1,name:"amountB",type:"uint256"}],name:"Deposit",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"channleId",type:"bytes32"},{indexed:!1,name:"partnerA",type:"address"},{indexed:!1,name:"partnerB",type:"address"},{indexed:!1,name:"amountB",type:"uint256"}],name:"DepositFalture",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"channleId",type:"bytes32"},{indexed:!1,name:"partnerA",type:"address"},{indexed:!1,name:"partnerB",type:"address"},{indexed:!1,name:"amountB",type:"uint256"}],name:"UpdateDeposit",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"channleId",type:"bytes32"},{indexed:!1,name:"closer",type:"address"},{indexed:!1,name:"amount1",type:"uint256"},{indexed:!1,name:"partner",type:"address"},{indexed:!1,name:"amount2",type:"uint256"}],name:"QuickCloseChannel",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"channleId",type:"bytes32"},{indexed:!1,name:"closer",type:"address"},{indexed:!1,name:"partner",type:"address"}],name:"CloseChannel",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"channleId",type:"bytes32"},{indexed:!1,name:"partnerA",type:"address"},{indexed:!1,name:"amountA",type:"uint256"},{indexed:!1,name:"partnerB",type:"address"},{indexed:!1,name:"amountB",type:"uint256"}],name:"UpdateTransaction",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"channleId",type:"bytes32"},{indexed:!1,name:"sender",type:"address"},{indexed:!1,name:"amount",type:"uint256"}],name:"Settle",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"re_addr",type:"address"}],name:"Logger",type:"event"},{inputs:[{name:"token_address",type:"address"},{name:"Timeout",type:"uint256"}],payable:!0,stateMutability:"payable",type:"constructor"},{constant:!0,inputs:[{name:"channelId",type:"bytes32"}],name:"getChannelBalance",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"channelId",type:"bytes32"}],name:"getChannelById",outputs:[{name:"channelCloser",type:"address"},{name:"channelSettler",type:"address"},{name:"timeLockVerifier",type:"address"},{name:"partner1",type:"address"},{name:"partner2",type:"address"},{name:"channelTotalBalance",type:"uint256"},{name:"closingNonce",type:"uint256"},{name:"withdrawNonce",type:"uint256"},{name:"expectedSettleBlock",type:"uint256"},{name:"closerSettleBalance",type:"uint256"},{name:"partnerSettleBalance",type:"uint256"},{name:"channelStatus",type:"uint8"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"getChannelCount",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"Mytoken",outputs:[{name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"trinityData",outputs:[{name:"channelNumber",type:"uint8"},{name:"settleTimeout",type:"uint256"},{name:"contractOwner",type:"address"}],payable:!1,stateMutability:"view",type:"function"}],rpcIp:"",walletInfo:{keyStore:"",publicKey:"",address:""},balanceData:{Chain:{TNC:0,ETH:0},Channel:{TNC:0,ETH:0}},channelList:[],addChannelInfo:[],txOnChannelInfo:[],closeChannelInfo:[],contactList:{},recordList:[],FoundertxDataSign:""},getters:{channelList:e=>!e.channelList},mutations:{switch_dialog(e){e.show=!e.show}},actions:{switch_dialog(e){e.commit("switch_dialog")}}});n.default.use(de.a);var Se=new de.a.Store({modules:{vuexStore:ge}});n.default.use(ce.a),n.default.use(de.a),n.default.config.productionTip=!1,new n.default({el:"#app",router:ie,store:Se,i18n:fe,components:{App:x},template:"<App/>"})},PH7Z:function(e,t,a){"use strict";(function(e){t.a={name:"loginByKeyStoreForm",data:()=>({fileList:[],keyStoreContent:"",keyStorePass:""}),mounted(){this.$nextTick(function(){})},methods:{handleChange(e,t){var a=this;if(e.raw){let t=new FileReader;t.onload=function(e){a.keyStoreContent=JSON.parse(e.target.result),40!==a.keyStoreContent.address.length&&(a.$notify.error({title:a.$t("loginByKeyStore.callback-1"),dangerouslyUseHTMLString:!0,message:a.$t("loginByKeyStore.callback-2"),duration:3e3}),a.keyStoreContent="")},t.readAsText(e.raw,"gb2312")}},login(){if(""==this.keyStoreContent)return this.$notify.error({title:this.$t("loginByKeyStore.callback-3"),dangerouslyUseHTMLString:!0,message:this.$t("loginByKeyStore.callback-4"),duration:3e3}),!1;if(""==this.keyStorePass)return this.$notify.error({title:this.$t("loginByKeyStore.callback-5"),dangerouslyUseHTMLString:!0,message:this.$t("loginByKeyStore.callback-6"),duration:3e3}),!1;let e=this.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)",target:document.querySelector(".loginByKeyStoreContentBox")}),t=this;setTimeout(function(){t.loginByKeyStore(),e.close()},2e3)},loginByKeyStore(){let t;try{t=web3.eth.accounts.decrypt(this.keyStoreContent,this.keyStorePass)}catch(e){return"Key derivation failed - possibly wrong password"==e.message?(this.$notify.error({title:this.$t("loginByKeyStore.callback-7"),dangerouslyUseHTMLString:!0,message:this.$t("loginByKeyStore.callback-8"),duration:3e3}),!1):(this.$notify.error({title:this.$t("loginByKeyStore.callback-9"),dangerouslyUseHTMLString:!0,message:e.message,duration:3e3}),!1)}let a=new e(t.privateKey.substring(2),"hex").toString("hex"),n=web3.eth.accounts.privateKeyToAccount("0x"+a).address;n=web3.utils.toChecksumAddress(n),web3.utils.checkAddressChecksum(n)?(this.$store.state.vuexStore.walletInfo.keyStore=this.keyStoreContent,this.$store.state.vuexStore.walletInfo.address=n,this.$store.state.vuexStore.isLogin=!0,this.$notify({title:this.$t("loginByKeyStore.callback-10"),dangerouslyUseHTMLString:!0,message:this.$t("loginByKeyStore.callback-11"),duration:3e3,type:"success"}),this.$router.push("/"),this.$store.state.vuexStore.activeNavIndex="1-1"):this.$notify.error({title:this.$t("loginByKeyStore.callback-12"),dangerouslyUseHTMLString:!0,message:this.$t("loginByKeyStore.callback-13"),duration:3e3}),this.keyStoreContent="",this.keyStorePass=""}}}}).call(t,a("EuP9").Buffer)},RkMI:function(e,t){},TehK:function(e,t){},VMDT:function(e,t){},fBkZ:function(e,t){},fGaG:function(e,t){},h8HD:function(e,t){},hEZ2:function(e,t){},"l9/a":function(e,t){},lQqF:function(e,t){},oBBk:function(e,t){},oM9L:function(e,t){},sGfP:function(e,t){},tvR6:function(e,t){}},["NHnr"]);