webpackJsonp([1],{"+XZm":function(e,t){},"7xIN":function(e,t){},DBDg:function(e,t){},Hrqu:function(e,t){},JdKS:function(e,t){},NHnr:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("7+uW"),s={name:"LeftNav",data:()=>({isLogin:!1,isNightMode:!1,navSelected:"1-1"}),computed:{classObject:function(){return{"el-icon-ETH-yingwenyuyan":"cn"===this.$i18n.locale,"el-icon-ETH-zhongwenyuyan":"en"===this.$i18n.locale}}},watch:{isNightMode(e,t){console.log("当前夜间模式为"+e),this.$store.state.vuexStore.isNightMode=e,this.$parent.saveAsString("isNightMode",this.$store.state.vuexStore.isNightMode)},"$store.state.vuexStore.activeNavIndex":"storeToNav","$store.state.vuexStore.walletInfo.address":"getAddressInfo"},mounted(){this.$nextTick(function(){let e=this;e.$store.state.vuexStore.isLogin=e.$parent.fetchAsArray("isLogin"),console.log("当前登陆状态为："+e.$store.state.vuexStore.isLogin),e.isNightMode=e.$parent.fetchAsString("isNightMode"),e.$store.state.vuexStore.isLogin&&""!=e.$store.state.vuexStore.isLogin||e.$router.push("/start")})},methods:{switchLang(){"cn"===this.$i18n.locale?this.$i18n.locale="en":this.$i18n.locale="cn",this.$parent.saveAsString("lang",this.$i18n.locale)},switchNightMode(){!1===this.$store.state.vuexStore.isNightMode?this.$store.state.vuexStore.isNightMode=!0:this.$store.state.vuexStore.isNightMode=!1,this.$parent.saveAsString("isNightMode",this.$store.state.vuexStore.isNightMode)},switchNet(e){console.log("切换到"+e)},storeToNav(){this.navSelected=this.$store.state.vuexStore.activeNavIndex},selectItems(e){this.$store.state.vuexStore.activeNavIndex=e},toOtherForm(e){this.$store.state.vuexStore.isLogin&&""!=this.$store.state.vuexStore.isLogin?this.$router.push(e):this.$router.push("/start")},storeLoginFlag(){this.$store.state.vuexStore.isLogin=!this.$store.state.vuexStore.isLogin,this.$parent.saveAsString("isLogin",this.$store.state.vuexStore.isLogin)},keepDecimalPlaces(e,t){let a;return a=isNaN(e)?NaN:parseInt(e*Math.pow(10,t))/Math.pow(10,t)},getAddressInfo(){this.getBalance(),this.$store.state.vuexStore.contactList=this.$parent.fetchAsArray(this.$store.state.vuexStore.walletInfo.address+"@contactList")},getBalance(){this.getEthBalance(),this.getTncBalance()},getEthBalance(){let e=this;e.$store.state.vuexStore.walletInfo.address&&web3.utils.checkAddressChecksum(e.$store.state.vuexStore.walletInfo.address)&&web3.eth.getBalance(e.$store.state.vuexStore.walletInfo.address).then(function(t){console.log(t);let a=web3.utils.fromWei(web3.utils.hexToNumberString(t));console.log(a),e.$store.state.vuexStore.balanceData.Chain.ETH=e.keepDecimalPlaces(a,3)})},getTncBalance(){let e=this;new web3.eth.Contract(contractAbi,"0x65096f2B7A8dc1592479F1911cd2B98dae4d2218",{from:e.$store.state.vuexStore.walletInfo.address,gasPrice:"10000000000"}).methods.balanceOf(e.$store.state.vuexStore.walletInfo.address).call({from:"0x65096f2B7A8dc1592479F1911cd2B98dae4d2218"},function(t,a){if(t)console.log(t);else{let t=a/1e8;e.$store.state.vuexStore.balanceData.Chain.TNC=e.keepDecimalPlaces(t,3)}})}}},o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("nav",[a("h1",{on:{click:function(t){e.storeLoginFlag()}}},[e._v(e._s(e.$t("navMenu.title")))]),e._v(" "),a("el-row",{staticClass:"tac"},[a("el-col",{attrs:{span:24}},[a("el-menu",{staticClass:"el-menu-vertical-demo",attrs:{"default-active":e.navSelected,active:e.navSelected,"background-color":"#545c64","text-color":"#fff","active-text-color":"#ffd04b"},on:{select:e.selectItems}},[a("el-submenu",{attrs:{index:"1"}},[a("template",{slot:"title"},[a("i",{staticClass:"el-icon-ETH-32"}),e._v(" "),a("span",[e._v(e._s(e.$t("navMenu.wallet.title")))])]),e._v(" "),a("el-menu-item-group",[a("el-menu-item",{attrs:{index:"1-1"},on:{click:function(t){e.toOtherForm("/")}}},[a("i",{staticClass:"el-icon-ETH-geren1"}),e._v(" "),a("span",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(e.$t("navMenu.wallet.index")))])]),e._v(" "),a("el-menu-item",{attrs:{index:"1-2"},on:{click:function(t){e.toOtherForm("/receive")}}},[a("i",{staticClass:"el-icon-ETH-zhuanzhang"}),e._v(" "),a("span",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(e.$t("navMenu.wallet.receive")))])]),e._v(" "),a("el-menu-item",{attrs:{index:"1-3"},on:{click:function(t){e.toOtherForm("/channelList")}}},[a("i",{staticClass:"el-icon-ETH-list"}),e._v(" "),a("span",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(e.$t("navMenu.wallet.channelList")))])]),e._v(" "),a("el-menu-item",{attrs:{index:"1-4"},on:{click:function(t){e.toOtherForm("/record")}}},[a("i",{staticClass:"el-icon-ETH-dujiayuniconzhenggao-19"}),e._v(" "),a("span",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(e.$t("navMenu.wallet.record")))])])],1)],2),e._v(" "),a("el-menu-item",{attrs:{index:"2"},on:{click:function(t){e.toOtherForm("/contact")}}},[a("i",{staticClass:"el-icon-ETH-lianxiren"}),e._v(" "),a("span",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(e.$t("navMenu.contact")))])]),e._v(" "),a("el-submenu",{attrs:{index:"3"}},[a("template",{slot:"title"},[a("i",{staticClass:"el-icon-setting"}),e._v(" "),a("span",[e._v(e._s(e.$t("navMenu.setting.title")))])]),e._v(" "),a("el-menu-item-group",[a("el-menu-item",{attrs:{index:"3-1"},on:{click:function(t){e.switchLang()}}},[a("i",{class:e.classObject}),e._v(" "),a("span",[e._v(e._s(e.$t("navMenu.setting.switchLang")))])]),e._v(" "),a("el-submenu",{attrs:{index:"3-2",disabled:""}},[a("template",{slot:"title"},[a("i",{staticClass:"el-icon-ETH-wangluo"}),e._v(" "),a("span",[e._v(e._s(e.$t("navMenu.setting.switchNet")))])]),e._v(" "),a("el-menu-item",{attrs:{index:"3-2-1"},on:{click:function(t){e.switchNet("Mainnet")}}},[e._v("Mainnet")]),e._v(" "),a("el-menu-item",{attrs:{index:"3-2-2"},on:{click:function(t){e.switchNet("Ropsten")}}},[e._v("Ropsten")])],2),e._v(" "),a("el-menu-item",{staticStyle:{position:"relative"},attrs:{index:"3-3",disabled:""}},[a("i",{staticClass:"el-icon-ETH-pifu"}),e._v(" "),a("span",[e._v(e._s(e.$t("navMenu.setting.nightMode"))+"\n                            "),a("el-switch",{staticStyle:{position:"absolute",top:"50%",right:"45px","margin-top":"-9px"},attrs:{"active-color":"#F8D163",disabled:""},model:{value:e.isNightMode,callback:function(t){e.isNightMode=t},expression:"isNightMode"}})],1)]),e._v(" "),a("el-menu-item",{attrs:{index:"3-4",disabled:""}},[a("i",{staticClass:"el-icon-ETH-xiugaimima"}),e._v(" "),a("span",[e._v(e._s(e.$t("navMenu.setting.changePass")))])]),e._v(" "),a("el-menu-item",{attrs:{index:"3-5"},on:{click:function(t){e.toOtherForm("/backup")}}},[a("i",{staticClass:"el-icon-ETH-fuzhi"}),e._v(" "),a("span",[e._v(e._s(e.$t("navMenu.setting.backUp")))])]),e._v(" "),a("el-menu-item",{attrs:{index:"3-6"}},[a("i",{staticClass:"el-icon-ETH-tuichu"}),e._v(" "),a("span",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(e.$t("navMenu.setting.signOut")))])])],1)],2)],1)],1)],1)],1)},staticRenderFns:[]};var r=a("VU/8")(s,o,!1,function(e){a("oKGu")},"data-v-0b1b93b2",null).exports,i={name:"headBox",data:()=>({}),mounted(){this.$nextTick(function(){})},methods:{}},l={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"headBox"},[a("i",{staticClass:"listIcon el-icon-ETH-liebiao",on:{click:function(t){e.$store.state.vuexStore.isNavShow=!e.$store.state.vuexStore.isNavShow}}}),e._v(" "),a("el-badge",{staticClass:"item",staticStyle:{float:"right"},attrs:{value:3,max:99}},[a("i",{staticClass:"notificationIcon el-icon-ETH-xiaoxi",on:{click:function(t){e.$store.state.vuexStore.isMessageBoxShow=!e.$store.state.vuexStore.isMessageBoxShow}}})])],1)},staticRenderFns:[]};var c=a("VU/8")(i,l,!1,function(e){a("oM9L")},"data-v-d8eacd86",null).exports,d={name:"messageBox",data:()=>({msg:"coming soon"}),mounted(){this.$nextTick(function(){})},methods:{clearAll(){console.log("清除全部")}}},u={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("transition",{attrs:{name:"el-fade-in-linear"}},[e.$store.state.vuexStore.isMessageBoxShow?a("div",{staticStyle:{width:"100%",height:"100%",position:"absolute"},on:{click:function(t){e.$store.state.vuexStore.isMessageBoxShow=!1}}},[a("div",{staticClass:"messageBox"},[a("div",{staticClass:"content_text"},[a("a",{staticClass:"clearAllBtn",on:{click:function(t){t.stopPropagation(),e.clearAll()}}},[e._v("清除全部")]),e._v(" "),a("h1",[e._v("消息")]),e._v(" "),a("hr",{staticStyle:{color:"#606266"}}),e._v(" "),a("div",{staticClass:"ulBox"},[a("ul",[a("li",[e._v("欢迎点击消息中心")]),e._v(" "),a("li",[e._v("目前该功能还未投入使用")]),e._v(" "),a("li",[e._v("敬请期待")])])])])])]):e._e()])},staticRenderFns:[]};var h=a("VU/8")(d,u,!1,function(e){a("S417")},"data-v-54e67146",null).exports,m={name:"footerBox",data:()=>({FooterList:[{index:"1-1",icon:"el-icon-ETH-geren1",name:"Index",router:"/"},{index:"1-2",icon:"el-icon-ETH-zhuanzhang",name:"Receive",router:"/receive"},{index:"1-3",icon:"el-icon-ETH-list",name:"Channel",router:"/channelList"},{index:"1-4",icon:"el-icon-ETH-dujiayuniconzhenggao-19",name:"Record",router:"/record"}],navSelected:"1-1"}),mounted(){this.$nextTick(function(){})},watch:{"$store.state.vuexStore.activeNavIndex":"storeToFooter"},methods:{selectItems(e){this.$store.state.vuexStore.activeNavIndex=e},storeToFooter(){this.navSelected=this.$store.state.vuexStore.activeNavIndex}}},p={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return"/start"!=e.$route.path&&"/create"!=e.$route.path&&"/loginByPrivateKey"!=e.$route.path&&"/loginByKeyStore"!=e.$route.path?a("footer",{staticClass:"footer"},[a("el-menu",{staticClass:"el-menu-demo",attrs:{"default-active":e.navSelected,active:e.navSelected,mode:"horizontal"},on:{select:e.selectItems}},e._l(e.FooterList,function(t,n){return a("el-menu-item",{key:n,attrs:{index:t.index}},[a("router-link",{staticClass:"clearfloat",attrs:{to:t.router}},[a("span",[a("i",{class:[!0,t.icon]})]),e._v(" "),a("span",[e._v(e._s(t.name))])])],1)}))],1):e._e()},staticRenderFns:[]};var v={name:"App",components:{headNav:r,headBox:c,footerBox:a("VU/8")(m,p,!1,function(e){a("DBDg")},"data-v-4b4c880c",null).exports,messageBox:h},methods:{backToStart(){this.$router.push("/start")},fetchAsArray:function(e){let t=e.toString();return JSON.parse(window.localStorage.getItem(t)||"[]")},fetchAsString:function(e){let t=e.toString();return window.localStorage.getItem(t)||""},saveAsArray:function(e,t){let a=e.toString();window.localStorage.setItem(a,JSON.stringify(t))},saveAsString:function(e,t){let a=e.toString();window.localStorage.setItem(a,t)},decryptPrivateKey(e,t){let a;try{a=web3.eth.accounts.decrypt(e,t)}catch(e){return"Key derivation failed - possibly wrong password"==e.message?(_this.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"钱包解锁失败 - 可能是密码错误",duration:3e3}),!1):(_this.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:e.message,duration:3e3}),!1)}return a}}},f={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"clearfloat",attrs:{id:"app",mode:"in-out"}},[t("div",{staticClass:"rightBox",class:{fullPage:!this.$store.state.vuexStore.isNavShow}},[t("head-box"),this._v(" "),t("router-view"),this._v(" "),t("message-box"),this._v(" "),t("footer-box")],1),this._v(" "),t("head-nav")],1)},staticRenderFns:[]};var g=a("VU/8")(v,f,!1,function(e){a("ZY0u")},null,null).exports,y=a("/ocq"),C={name:"indexForm",data:()=>({isShowMoreAsset:!1,paymentCode:"",txOnChainInfo:{address:"",assetType:"",amount:"",keyStorePass:""},txOnChainRules:{address:[{validator:(e,t,a)=>{if(!t)return a(new Error("地址不能为空"));42!==t.length?a(new Error("请输入正确的地址")):a()},trigger:"blur"}],amount:[{validator:(e,t,a)=>{if(!t)return a(new Error("金额不能为空"));isNaN(t)?a(new Error("请输入数字值")):t<0?a(new Error("金额必须大于0")):a()},trigger:"blur"}],assetType:[{validator:(e,t,a)=>{if(!t)return a(new Error("资产类型不能为空"));a()},trigger:"change"}],keyStorePass:[{validator:(e,t,a)=>{if(!t)return a(new Error("钱包密码不能为空，否则将无法交易"));a()},trigger:"blur"}]},txOnChannelInfo:{sendUrl:"",receiverUrl:"",hr:"",assetType:"",value:0,fee:0,description:""},ShowTxOnChainBox:!1,contact:""}),mounted(){this.$nextTick(function(){this.$route.params.address&&(this.paymentCode=this.$route.params.address)})},watch:{},methods:{showMoreAsset(){this.isShowMoreAsset=!this.isShowMoreAsset},decryptPaymentCode(){let e=this;if(""!=e.paymentCode.length)return 42===e.paymentCode.length?e.paymentCode===e.$store.state.vuexStore.walletInfo.address?void e.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"收付款地址不能相同",duration:3e3}):(e.txOnChainInfo.address=e.paymentCode,void(e.ShowTxOnChainBox=!0)):void("TN"==e.paymentCode.substr(0,2)?console.log("进入通道交易"):e.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"付款码错误，请确认",duration:3e3}));e.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"付款码/地址不能为空",duration:3e3})},contactChange(){this.paymentCode=this.contact},txOnChain(){let e=this;e.$refs.txOnChainInfo.validate(t=>{if(!t)return console.log("error submit!!"),!1;"ETH"==e.txOnChainInfo.assetType?e.txEthOnChain():e.txTncOnChain()})},txEthOnChain(){let e=this,t=e.$parent.decryptPrivateKey(e.$store.state.vuexStore.walletInfo.keyStore,e.txOnChainInfo.keyStorePass);web3.eth.getTransactionCount(e.$store.state.vuexStore.walletInfo.address,web3.eth.defaultBlock.pending).then(function(a){console.log(a),web3.eth.getGasPrice().then(function(n){console.log(n);var s={nonce:web3.utils.toHex(a++),gasLimit:web3.utils.toHex(45e5),gasPrice:web3.utils.toHex(n),to:e.txOnChainInfo.address,from:e.$store.state.vuexStore.walletInfo.address,value:web3.utils.toHex(1e18*e.txOnChainInfo.amount),data:""};console.log(s);let o=signData(s,t.privateKey);console.log(o),web3.eth.sendSignedTransaction("0x"+o,function(t,a){t?console.log(t):(console.log(a),this.$notify({title:"成功",dangerouslyUseHTMLString:!0,message:"转账成功",duration:3e3,type:"success"}),e.ShowTxOnChainBox=!1,e.clearTxData())})})})},txTncOnChain(){let e=this,t=e.$parent.decryptPrivateKey(e.$store.state.vuexStore.walletInfo.keyStore,e.txOnChainInfo.keyStorePass);web3.eth.getTransactionCount(e.$store.state.vuexStore.walletInfo.address,web3.eth.defaultBlock.pending).then(function(a){console.log(a),web3.eth.getGasPrice().then(function(n){console.log(n);var s=web3.utils.sha3("transfer(address,uint256)").substr(2,8);console.log(s);var o={nonce:web3.utils.toHex(a++),gasPrice:web3.utils.toHex(n),gasLimit:web3.utils.toHex(45e5),to:"0x65096f2B7A8dc1592479F1911cd2B98dae4d2218",from:e.$store.state.vuexStore.walletInfo.address,value:"0x00",data:"0x"+s+web3.utils.padLeft(e.txOnChainInfo.address.slice(2),64)+web3.utils.padLeft(web3.utils.toHex(1e8*e.txOnChainInfo.amount).substr(2),64)};console.log(o);let r=signData(o,t.privateKey);console.log(r),web3.eth.sendSignedTransaction("0x"+r,function(t,a){t?console.log(t):(console.log(a),this.$notify({title:"成功",dangerouslyUseHTMLString:!0,message:"转账成功",duration:3e3,type:"success"}),e.ShowTxOnChainBox=!1,e.clearTxData())})})})},clearTxData(){this.txOnChainInfo={address:"",assetType:"",amount:"",keyStorePass:""},this.paymentCode=""}}},x={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"indexBox",class:{fullPage:!e.$store.state.vuexStore.isNavShow}},[a("div",{staticClass:"assetBox"},[a("h1",[e._v(e._s(e.$store.state.vuexStore.balanceData.Chain.TNC)+" TNC")]),e._v(" "),a("el-collapse-transition",[a("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowMoreAsset,expression:"isShowMoreAsset"}]},[a("table",{staticClass:"assetTable"},[a("thead",[a("tr",[a("th",[e._v("资产类型")]),e._v(" "),a("th",[e._v("链上金额")]),e._v(" "),a("th",[e._v("通道金额")])])]),e._v(" "),a("tbody",[a("tr",[a("td",[e._v("TNC")]),e._v(" "),a("td",[e._v(e._s(e.$store.state.vuexStore.balanceData.Chain.TNC))]),e._v(" "),a("td",[e._v(e._s(e.$store.state.vuexStore.balanceData.Channel.TNC))])]),e._v(" "),a("tr",[a("td",[e._v("ETH")]),e._v(" "),a("td",[e._v(e._s(e.$store.state.vuexStore.balanceData.Chain.ETH))]),e._v(" "),a("td",[e._v(e._s(e.$store.state.vuexStore.balanceData.Channel.ETH))])])])])])]),e._v(" "),a("el-button",{staticClass:"showMoreAssetBtn",class:{showMoreAssetBtn_active:e.isShowMoreAsset},attrs:{type:"primary",icon:"el-icon-arrow-down",circle:""},on:{click:function(t){e.showMoreAsset()}}})],1),e._v(" "),a("div",{staticClass:"contentBox"},[a("h2",[e._v("转账")]),e._v(" "),a("hr",{staticStyle:{height:"2px",border:"none","border-top":"2px dotted #EBEEF5"}}),e._v(" "),a("el-form",{ref:"form",staticClass:"indexForm"},[a("label",[e._v("支付码/地址")]),e._v(" "),a("el-select",{staticStyle:{float:"right","margin-bottom":"12px"},attrs:{size:"mini",filterable:"",clearable:"",placeholder:"从联系人里转账"},on:{change:e.contactChange},model:{value:e.contact,callback:function(t){e.contact=t},expression:"contact"}},e._l(e.$store.state.vuexStore.contactList,function(t){return a("el-option",{key:t.address,attrs:{label:t.name,value:t.address}},[a("span",{staticStyle:{float:"left"}},[e._v(e._s(t.name))]),e._v(" "),a("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px",overflow:"hidden","margin-left":"20px",width:"175px","text-overflow":"ellipsis","white-space":"nowrap"}},[e._v(e._s(t.address))])])})),e._v(" "),a("el-form-item",{staticStyle:{"margin-top":"10px"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.paymentCode,callback:function(t){e.paymentCode=t},expression:"paymentCode"}})],1),e._v(" "),a("el-form-item",{staticStyle:{"text-align":"center"}},[a("el-button",{staticClass:"transferBtn",attrs:{type:"primary"},on:{click:e.decryptPaymentCode}},[e._v("转账")])],1)],1)],1),e._v(" "),a("el-dialog",{staticClass:"txOnChainBox",attrs:{title:"链上转账",visible:e.ShowTxOnChainBox,width:"30%",center:"","modal-append-to-body":!1},on:{"update:visible":function(t){e.ShowTxOnChainBox=t}}},[a("el-form",{ref:"txOnChainInfo",staticClass:"demo-ruleForm",attrs:{model:e.txOnChainInfo,"status-icon":"",rules:e.txOnChainRules,"label-width":"70px"}},[a("el-form-item",{attrs:{label:"地址",prop:"address"}},[a("el-input",{attrs:{readonly:"readonly","auto-complete":"off"},model:{value:e.txOnChainInfo.address,callback:function(t){e.$set(e.txOnChainInfo,"address",t)},expression:"txOnChainInfo.address"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"资产类型",prop:"assetType"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择资产类型"},model:{value:e.txOnChainInfo.assetType,callback:function(t){e.$set(e.txOnChainInfo,"assetType",t)},expression:"txOnChainInfo.assetType"}},[a("el-option",{attrs:{label:"TNC",value:"TNC"}}),e._v(" "),a("el-option",{attrs:{label:"ETH",value:"ETH"}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"金额",prop:"amount"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.txOnChainInfo.amount,callback:function(t){e.$set(e.txOnChainInfo,"amount",e._n(t))},expression:"txOnChainInfo.amount"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"密码",prop:"keyStorePass"}},[a("el-input",{attrs:{type:"password","auto-complete":"off"},model:{value:e.txOnChainInfo.keyStorePass,callback:function(t){e.$set(e.txOnChainInfo,"keyStorePass",t)},expression:"txOnChainInfo.keyStorePass"}})],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.txOnChain()}}},[e._v("转账")]),e._v(" "),a("el-button",{on:{click:function(t){e.ShowTxOnChainBox=!1}}},[e._v("取 消")])],1)],1)],1)},staticRenderFns:[]};var S=a("VU/8")(C,x,!1,function(e){a("QN2h")},"data-v-023107bd",null).exports,T={name:"startForm",data:()=>({}),methods:{toOtherForm(e){this.$router.push(e)}}},b={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"startForm"},[a("div",{staticClass:"contentBox"},[a("h2",[e._v("欢迎")]),e._v(" "),a("hr",{staticStyle:{height:"2px",border:"none","border-top":"2px dotted #EBEEF5"}}),e._v(" "),a("div",{staticClass:"clooseLoginBox clooseLoginBox-blue",on:{click:function(t){e.toOtherForm("./create")}}},[a("h3",[e._v("创建新钱包")]),e._v(" "),a("p",[e._v("从场景上说，MessageBox 的作用是美化系统自带的，因此适合展示较为简单的内容。如果需要弹出较为复杂的内容，请使用 Dialog。")])]),e._v(" "),a("div",{staticClass:"clooseLoginBox clooseLoginBox-green",on:{click:function(t){e.toOtherForm("./loginByPrivateKey")}}},[a("h3",[e._v("从私钥导入")]),e._v(" "),a("p",[e._v("从场景上说，MessageBox 的作用是美化系统自带的，因此适合展示较为简单的内容。如果需要弹出较为复杂的内容，请使用 Dialog。")])]),e._v(" "),a("div",{staticClass:"clooseLoginBox clooseLoginBox-gray",on:{click:function(t){e.toOtherForm("./loginByKeyStore")}}},[a("h3",[e._v("从备份文件恢复")]),e._v(" "),a("p",[e._v("从场景上说，MessageBox 的作用是美化系统自带的，因此适合展示较为简单的内容。如果需要弹出较为复杂的内容，请使用 Dialog。")])])])])},staticRenderFns:[]};var _=a("VU/8")(T,b,!1,function(e){a("wICs")},"data-v-436016c8",null).exports,w={name:"createForm",data(){return{createForm:{pass:"",checkPass:""},createRules:{pass:[{validator:(e,t,a)=>{""===t?a(new Error("请输入密码")):(""!==this.createForm.checkPass&&this.$refs.createForm.validateField("checkPass"),a())},trigger:"blur"}],checkPass:[{validator:(e,t,a)=>{""===t?a(new Error("请再次输入密码")):t!==this.createForm.pass?a(new Error("两次输入密码不一致!")):a()},trigger:"blur"}]}}},mounted(){this.$nextTick(function(){})},methods:{toLoginForm(){this.$refs.createForm.validate(e=>{if(!e)return console.log("error submit!!"),!1;{let e=web3.eth.accounts.create().privateKey.slice(2);console.log(e);let t=web3.eth.accounts.encrypt("0x"+e,this.createForm.pass);console.log(t);let a=web3.utils.toChecksumAddress(t.address);console.log(a),web3.utils.checkAddressChecksum(a)&&(this.$store.state.vuexStore.walletInfo.keyStore=t,this.$store.state.vuexStore.walletInfo.address=a,this.$store.state.vuexStore.isLogin=!0,this.$notify({title:"成功",dangerouslyUseHTMLString:!0,message:"创建成功",duration:3e3,type:"success"})),this.$router.push("/backup")}this.createForm.pass="",this.createForm.checkPass=""})}}},F={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"createForm",class:{fullPage:!e.$store.state.vuexStore.isNavShow}},[a("div",{staticClass:"contentBox"},[a("h2",[e._v("创建钱包")]),e._v(" "),a("hr",{staticStyle:{height:"2px",border:"none","border-top":"2px dotted #EBEEF5"}}),e._v(" "),a("el-form",{ref:"createForm",staticClass:"demo-ruleForm",attrs:{model:e.createForm,"status-icon":"",rules:e.createRules,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"密码",prop:"pass"}},[a("el-input",{attrs:{type:"password","auto-complete":"off"},model:{value:e.createForm.pass,callback:function(t){e.$set(e.createForm,"pass",t)},expression:"createForm.pass"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"确认密码",prop:"checkPass"}},[a("el-input",{attrs:{type:"password","auto-complete":"off"},model:{value:e.createForm.checkPass,callback:function(t){e.$set(e.createForm,"checkPass",t)},expression:"createForm.checkPass"}})],1),e._v(" "),a("el-form-item",{staticStyle:{"text-align":"center"}},[a("el-button",{staticStyle:{"margin-left":"-40px",width:"120px"},attrs:{type:"primary"},on:{click:function(t){e.toLoginForm()}}},[e._v("提交")])],1)],1),e._v(" "),a("a",{staticClass:"backToStartBtn",on:{click:function(t){e.$parent.backToStart()}}},[e._v("返回开始界面")])],1)])},staticRenderFns:[]};var B=a("VU/8")(w,F,!1,function(e){a("nGJZ")},"data-v-77daee46",null).exports,N={name:"loginByPrivateKeyForm",data(){return{loginByPrivateKeyForm:{privateKey:"",pass:"",checkPass:""},loginByPrivateKeyRules:{privateKey:[{validator:(e,t,a)=>{if(!t)return a(new Error("私钥不能为空"));64!==t.length?a(new Error("请输入正确的私钥")):a()},trigger:"blur"}],pass:[{validator:(e,t,a)=>{""===t?a(new Error("请输入密码")):(""!==this.loginByPrivateKeyForm.checkPass&&this.$refs.loginByPrivateKeyForm.validateField("checkPass"),a())},trigger:"blur"}],checkPass:[{validator:(e,t,a)=>{""===t?a(new Error("请再次输入密码")):t!==this.loginByPrivateKeyForm.pass?a(new Error("两次输入密码不一致!")):a()},trigger:"blur"}]}}},mounted(){this.$nextTick(function(){})},methods:{Login(){this.$refs.loginByPrivateKeyForm.validate(e=>{if(!e)return console.log("error submit!!"),!1;{let e=web3.eth.accounts.encrypt("0x"+this.loginByPrivateKeyForm.privateKey,this.loginByPrivateKeyForm.pass);console.log(e);let t=web3.utils.toChecksumAddress(e.address);console.log(t),web3.utils.checkAddressChecksum(t)?(this.$store.state.vuexStore.walletInfo.keyStore=e,this.$store.state.vuexStore.walletInfo.address=t,this.$store.state.vuexStore.isLogin=!0,this.$notify({title:"成功",dangerouslyUseHTMLString:!0,message:"导入成功",duration:3e3,type:"success"}),this.$router.push("/backup"),this.$store.state.vuexStore.activeNavIndex="3-5"):this.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"导入失败，请确认私钥正确",duration:3e3}),this.loginByPrivateKeyForm.privateKey="",this.loginByPrivateKeyForm.pass="",this.loginByPrivateKeyForm.checkPass=""}})}}},$={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"loginByPrivateKeyForm",class:{fullPage:!e.$store.state.vuexStore.isNavShow}},[a("div",{staticClass:"contentBox"},[a("h2",[e._v("导入私钥")]),e._v(" "),a("hr",{staticStyle:{height:"2px",border:"none","border-top":"2px dotted #EBEEF5"}}),e._v(" "),a("el-form",{ref:"loginByPrivateKeyForm",staticClass:"demo-ruleForm",attrs:{model:e.loginByPrivateKeyForm,"status-icon":"",rules:e.loginByPrivateKeyRules,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"私钥",prop:"privateKey"}},[a("el-input",{model:{value:e.loginByPrivateKeyForm.privateKey,callback:function(t){e.$set(e.loginByPrivateKeyForm,"privateKey",t)},expression:"loginByPrivateKeyForm.privateKey"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"密码",prop:"pass"}},[a("el-input",{attrs:{type:"password","auto-complete":"off"},model:{value:e.loginByPrivateKeyForm.pass,callback:function(t){e.$set(e.loginByPrivateKeyForm,"pass",t)},expression:"loginByPrivateKeyForm.pass"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"确认密码",prop:"checkPass"}},[a("el-input",{attrs:{type:"password","auto-complete":"off"},model:{value:e.loginByPrivateKeyForm.checkPass,callback:function(t){e.$set(e.loginByPrivateKeyForm,"checkPass",t)},expression:"loginByPrivateKeyForm.checkPass"}})],1),e._v(" "),a("el-form-item",{staticStyle:{"text-align":"center"}},[a("el-button",{staticStyle:{"margin-left":"-40px",width:"120px"},attrs:{type:"primary"},on:{click:function(t){e.Login()}}},[e._v("提交")])],1)],1),e._v(" "),a("a",{staticClass:"backToStartBtn",on:{click:function(t){e.$parent.backToStart()}}},[e._v("返回开始界面")])],1)])},staticRenderFns:[]};var R=a("VU/8")(N,$,!1,function(e){a("Z+i4")},"data-v-c8f88e60",null).exports,k=a("PH7Z"),I={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"loginByKeyStoreForm",class:{fullPage:!e.$store.state.vuexStore.isNavShow}},[a("div",{staticClass:"contentBox loginByKeyStoreContentBox"},[a("h2",[e._v("从备份文件恢复")]),e._v(" "),a("hr",{staticStyle:{height:"2px",border:"none","border-top":"2px dotted #EBEEF5"}}),e._v(" "),a("el-form",{ref:"loginByKeyStoreForm",staticClass:"demo-ruleForm",attrs:{"status-icon":"","label-position":"top","label-width":"80px"}},[a("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{"on-change":e.handleChange,"file-list":e.fileList,accept:".json","auto-upload":!1,limit:1,action:"/"}},[a("el-button",{attrs:{slot:"trigger"},slot:"trigger"},[e._v("选取文件")])],1),e._v(" "),a("el-form-item",{attrs:{label:"密码",prop:"keyStorePass"}},[a("el-input",{attrs:{type:"password","auto-complete":"off"},model:{value:e.keyStorePass,callback:function(t){e.keyStorePass=t},expression:"keyStorePass"}})],1),e._v(" "),a("el-form-item",{staticStyle:{"text-align":"center"}},[a("el-button",{staticStyle:{width:"120px"},attrs:{type:"primary"},on:{click:function(t){e.login()}}},[e._v("导入")])],1)],1),e._v(" "),a("a",{staticClass:"backToStartBtn",on:{click:function(t){e.$parent.backToStart()}}},[e._v("返回开始界面")])],1)])},staticRenderFns:[]};var M=function(e){a("SJzi")},D=a("VU/8")(k.a,I,!1,M,"data-v-6c45582e",null).exports,E={name:"backupForm",data:()=>({}),methods:{backup(){if(console.log(this.$store.state.vuexStore.walletInfo.keyStore),this.$store.state.vuexStore.walletInfo.keyStore){var e=JSON.stringify(this.$store.state.vuexStore.walletInfo.keyStore),t=new Blob([e],{type:"text/plain;charset=utf-8"});saveAs(t,this.$store.state.vuexStore.walletInfo.keyStore.id+".json")}else this.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"备份失败，请确认正确导入钱包",duration:3e3})}}},O={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"backupForm",class:{fullPage:!e.$store.state.vuexStore.isNavShow}},[a("div",{staticClass:"contentBox"},[a("h2",[e._v("备份")]),e._v(" "),a("hr",{staticStyle:{height:"2px",border:"none","border-top":"2px dotted #EBEEF5"}}),e._v(" "),a("el-button",{staticStyle:{margin:"10px 0"},attrs:{type:"primary",icon:"el-icon-edit",plain:""},on:{click:function(t){e.backup()}}},[e._v("备份钱包")]),e._v(" "),e._m(0)],1)])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"tipBox tipBox-red"},[t("h3",[this._v("'贴心提示'")]),this._v(" "),t("p",[this._v("点击“备份当前钱包”按钮后，浏览器会生成一个钱包备份文件，当您清空浏览器数据库、或者更换浏览器、重装系统后，可以使用钱包备份文件恢复当前钱包。请将该文件保存到安全的地方，并牢记钱包密码，钱包文件丢失或钱包密码遗忘可能会导致您的资产丢失。")])])}]};var P=a("VU/8")(E,O,!1,function(e){a("JdKS")},"data-v-57c6bb79",null).exports,H={name:"contactBox",data(){return{contactList:[],multipleSelection:[],centerDialogVisible:!1,addContactForm:{name:"",address:""},addContactRules:{name:[{validator:(e,t,a)=>{if(""===t)return a(new Error("姓名不能为空"));a()},trigger:"blur"}],address:[{validator:(e,t,a)=>{let n=!1;this.$store.state.vuexStore.contactList.forEach(function(e,a){e.address===t&&(n=!0)}),""===t?a(new Error("地址不能为空")):42!==t.length?a(new Error("地址检测错误")):n?a(new Error("地址已经存在")):a()},trigger:"blur"}]}}},mounted(){this.$nextTick(function(){this.$store.state.vuexStore.isLogin?this.contactList=this.$store.state.vuexStore.contactList:this.$router.push("/start")})},methods:{toggleSelection(e){e?e.forEach(e=>{this.$refs.multipleTable.toggleRowSelection(e)}):this.$refs.multipleTable.clearSelection()},handleSelectionChange(e){this.multipleSelection=e},addContact(){this.$refs.addContactForm.validate(e=>{if(!e)return console.log("error submit!!"),!1;{let e={name:this.addContactForm.name,address:this.addContactForm.address};this.$store.state.vuexStore.contactList.push(e),this.saveAsArray(this.$store.state.vuexStore.walletInfo.address+"@contactList",this.$store.state.vuexStore.contactList),this.centerDialogVisible=!1,this.$message({showClose:!0,message:"添加联系人成功",type:"success"})}})},DeltableData(){let e=this;e.multipleSelection.forEach(function(t,a){e.$store.state.vuexStore.contactList.forEach(function(a,n){a.address===t.address&&e.$store.state.vuexStore.contactList.splice(n,1)})})},transfer(){let e=this.multipleSelection[0].address;this.$store.state.vuexStore.activeNavIndex="1-1",this.$router.push({name:"index",params:{address:e}})},saveAsArray:function(e,t){let a=e.toString();window.localStorage.setItem(a,JSON.stringify(t))}}},L={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"contactBox",class:{fullPage:!e.$store.state.vuexStore.isNavShow}},[a("div",{staticClass:"contentBox"},[a("h2",[e._v("我的联系人")]),e._v(" "),a("hr",{staticStyle:{height:"2px",border:"none","border-top":"2px dotted #EBEEF5"}}),e._v(" "),a("el-button",{staticStyle:{margin:"10px 0"},attrs:{type:"primary",icon:"el-icon-plus",plain:""},on:{click:function(t){e.centerDialogVisible=!0}}},[e._v("添加联系人")]),e._v(" "),a("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.contactList,"tooltip-effect":"dark"},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"60"}}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:"姓名",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:"address",label:"地址"}})],1),e._v(" "),a("div",{staticStyle:{"margin-top":"20px"}},[a("el-button",{attrs:{disabled:1!=e.multipleSelection.length,type:"success",plain:""},on:{click:function(t){e.transfer()}}},[e._v("转账")]),e._v(" "),a("el-button",{attrs:{type:"danger",plain:""},on:{click:function(t){e.DeltableData()}}},[e._v("删除")]),e._v(" "),a("el-button",{attrs:{plain:""},on:{click:function(t){e.toggleSelection()}}},[e._v("取消选择")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"添加联系人",visible:e.centerDialogVisible,width:"40%",center:""},on:{"update:visible":function(t){e.centerDialogVisible=t}}},[a("el-form",{ref:"addContactForm",staticClass:"demo-ruleForm",attrs:{model:e.addContactForm,"status-icon":"",rules:e.addContactRules,"label-width":"50px"}},[a("el-form-item",{attrs:{label:"名称",prop:"name"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.addContactForm.name,callback:function(t){e.$set(e.addContactForm,"name",t)},expression:"addContactForm.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"地址",prop:"address"}},[a("el-input",{model:{value:e.addContactForm.address,callback:function(t){e.$set(e.addContactForm,"address",t)},expression:"addContactForm.address"}})],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.addContact()}}},[e._v("添加")]),e._v(" "),a("el-button",{on:{click:function(t){e.centerDialogVisible=!1}}},[e._v("取 消")])],1)],1)],1)},staticRenderFns:[]};var A=a("VU/8")(H,L,!1,function(e){a("iygy")},"data-v-6109bb7a",null).exports,K=a("f3u+"),U=a.n(K);n.default.use(U.a);var X={name:"receiveForm",data:()=>({paymentCode:"APWDCZ6SY2VgPV37EKbrkYD6XwjVaa8u8B",paymentCodeForm:{amount:"",assetType:"",selfUrl:"0x23cca051BfedB5e17d3AAD2038Ba0a5155d1B1b7@10.10.10.5:8089",R:"",Hr:"",Code:""},paymentCodeRules:{amount:[{validator:(e,t,a)=>{if(!t)return a(new Error("金额不能为空"));t<0?a(new Error("请输入正确的数字值")):a()},trigger:"blur"}],assetType:[{validator:(e,t,a)=>{""===t?a(new Error("请选择资产类型")):a()},trigger:"change"}]},isPaymentCodeBoxShow:!1}),watch:{},mounted(){this.$nextTick(function(){})},methods:{copyfun(){let e=this;clipboard&&clipboard.destroy(),clipboard=new ClipboardJS(".btncopy"),clipboard.on("success",function(t){e.$notify.info({title:"消息",dangerouslyUseHTMLString:!0,message:"复制成功",duration:3e3})}),clipboard.on("error",function(t){e.$notify.info({title:"警告",dangerouslyUseHTMLString:!0,message:"复制失败，请自行复制",duration:3e3,type:"warning"})})},createPaymentCode(){this.$refs.paymentCodeForm.validate(e=>{if(!e)return console.log("error submit!!"),!1;{console.log("submit!"),this.paymentCodeForm.R=createR(),this.paymentCodeForm.Hr=createHr(this.paymentCodeForm.R);let e=this.paymentCodeForm.selfUrl+"&"+this.paymentCodeForm.Hr+"&"+this.paymentCodeForm.assetType+"&"+this.paymentCodeForm.Amount+"&"+this.paymentCodeForm.Amount+this.paymentCodeForm.assetType;console.log(e),this.paymentCodeForm.Code="TN"+base58encode(e),console.log(this.paymentCodeForm.Code),this.isPaymentCodeBoxShow=!0}})},resetForm(){this.isPaymentCodeBoxShow=!1,this.paymentCodeForm={amount:"",assetType:"",selfUrl:"",R:"",Hr:"",Code:""}}}},J={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"receiveForm",class:{fullPage:!e.$store.state.vuexStore.isNavShow}},[a("div",{staticClass:"contentBox"},[a("h2",[e._v("收款")]),e._v(" "),a("hr",{staticStyle:{height:"2px",border:"none","border-top":"2px dotted #EBEEF5"}}),e._v(" "),a("el-tabs",{staticStyle:{width:"100%","max-width":"440px"},attrs:{type:"border-card"}},[a("el-tab-pane",{attrs:{label:"链上"}},[a("div",{staticClass:"QRCodeBox QRCodeBox-white"},[a("h3",[e._v("收款地址")]),e._v(" "),a("qriously",{attrs:{value:this.$store.state.vuexStore.walletInfo.address,level:"H",size:210}}),e._v(" "),a("p",{domProps:{textContent:e._s(this.$store.state.vuexStore.walletInfo.address)}})],1),e._v(" "),a("el-input",{attrs:{id:"receiveAddress",placeholder:"Address",readonly:"readonly"},model:{value:this.$store.state.vuexStore.walletInfo.address,callback:function(t){e.$set(this.$store.state.vuexStore.walletInfo,"address",t)},expression:"this.$store.state.vuexStore.walletInfo.address"}},[a("el-button",{staticClass:"btncopy",attrs:{slot:"append","data-clipboard-target":"#receiveAddress",icon:"el-icon-share"},on:{click:function(t){e.copyfun()}},slot:"append"},[e._v("Copy")])],1)],1),e._v(" "),a("el-tab-pane",{attrs:{label:"通道"}},[e.isPaymentCodeBoxShow?e._e():a("el-form",{ref:"paymentCodeForm",staticClass:"demo-ruleForm",staticStyle:{"text-align":"center"},attrs:{model:e.paymentCodeForm,"status-icon":"",rules:e.paymentCodeRules,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"金额",prop:"amount"}},[a("el-input",{attrs:{type:"number","auto-complete":"off"},model:{value:e.paymentCodeForm.amount,callback:function(t){e.$set(e.paymentCodeForm,"amount",e._n(t))},expression:"paymentCodeForm.amount"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"资产类型",prop:"assetType"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择资产类型"},model:{value:e.paymentCodeForm.assetType,callback:function(t){e.$set(e.paymentCodeForm,"assetType",t)},expression:"paymentCodeForm.assetType"}},[a("el-option",{attrs:{label:"TNC",value:"TNC"}}),e._v(" "),a("el-option",{attrs:{label:"ETH",value:"ETH"}})],1)],1),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.createPaymentCode()}}},[e._v("创建")])],1),e._v(" "),e.isPaymentCodeBoxShow?a("div",[a("el-button",{on:{click:function(t){e.resetForm("ruleForm")}}},[e._v("重置")]),e._v(" "),a("div",{staticClass:"QRCodeBox QRCodeBox-white"},[a("h3",[e._v("收款码")]),e._v(" "),a("qriously",{attrs:{value:e.paymentCodeForm.Code,level:"H",size:210}}),e._v(" "),a("p",{staticStyle:{width:"378px","text-overflow":"ellipsis","white-space":"nowrap",overflow:"hidden"}},[e._v(e._s(e.paymentCodeForm.Code))])],1),e._v(" "),a("el-input",{attrs:{id:"receivePaymentCode",placeholder:"Receive Payment Code"},model:{value:e.paymentCodeForm.Code,callback:function(t){e.$set(e.paymentCodeForm,"Code",t)},expression:"paymentCodeForm.Code"}},[a("el-button",{staticClass:"btncopy",attrs:{slot:"append","data-clipboard-target":"#receivePaymentCode",icon:"el-icon-search"},on:{click:function(t){e.copyfun()}},slot:"append"},[e._v("Copy")])],1)],1):e._e()],1)],1)],1)])},staticRenderFns:[]};var V=a("VU/8")(X,J,!1,function(e){a("dnib")},"data-v-134d6fc3",null).exports,W={name:"addChannelForm",data(){return{addChannelForm:{uri:"",assetType:"",selfdeposit:"",otherDeposit:0,alice:"",keyStorePass:""},addChannelRules:{uri:[{validator:(e,t,a)=>{let n=this;if(!t)return a(new Error("对端URI不能为空"));t.indexOf("@")<-1?a(new Error("URI格式不正确")):42!==t.split("@")[0].length?a(new Error("URI格式不正确")):(n.$store.state.vuexStore.channelList.forEach(function(e,t){e.otherUri===n.addChannelForm.uri&&a(new Error("你已经和这个TNAP有一个通道了"))}),a())},trigger:"blur"}],assetType:[{validator:(e,t,a)=>{""===t?a(new Error("请选择资产类型")):a()},trigger:"change"}],selfdeposit:[{validator:(e,t,a)=>{""===t?a(new Error("押金数量不能为空")):t<=0?a(new Error("押金数量必须大于0")):t>this.$store.state.vuexStore.balanceData.Chain[this.addChannelForm.assetType]?a(new Error("押金数量不能大于钱包余额")):a()},trigger:"blur"}],alice:[{validator:(e,t,a)=>{""===t?a(new Error("通道名称不能为空")):a()},trigger:"blur"}],keyStorePass:[{validator:(e,t,a)=>{if(!t)return a(new Error("钱包密码不能为空，否则将无法交易"));a()},trigger:"blur"}]}}},methods:{formatTooltip(e){let t;return t=""===this.addChannelForm.deposit?1:this.addChannelForm.deposit,parseInt(e*t)/100},addChannel(){let e=this;e.$refs.addChannelForm.validate(t=>{if(!t)return console.log("error submit!!"),!1;{let t=this.uri2Ip(e.addChannelForm.uri,8766);const o="ws://"+t+"/";var a=e.$store.state.vuexStore.channelList.length;let r=(new Date).getTime(),i=md5encode(r+e.addChannelForm.uri);var n={channelName:i,websock:new WebSocket(o)};e.$store.state.vuexStore.channelList.push(n),e.$store.state.vuexStore.channelList[a].websock.onmessage=e.websocketOnmessage,e.$store.state.vuexStore.channelList[a].websock.onclose=e.websocketClose;var s={MessageType:"RegisterChannel",Sender:e.$store.state.vuexStore.walletInfo.address+t,Receiver:e.addChannelForm.uri,ChannelName:i,Magic:e.$store.state.vuexStore.Magic,MessageBody:{AssetType:e.addChannelForm.assetType,Deposit:parseInt(1e9*deposit)/1e9}};e.$store.state.vuexStore.channelList[a].websock.send(JSON.stringify(s)),e.$store.state.vuexStore.channelList[a].ChannelName=i,e.$store.state.vuexStore.channelList[a].Alice=e.addChannelForm.alice,e.$store.state.vuexStore.channelList[a].State=2,e.$store.state.vuexStore.channelList[a].isConnect=!0,e.$store.state.vuexStore.channelList[a].SelfBalance=e.addChannelForm.selfdeposit,e.$store.state.vuexStore.channelList[a].OtherBalance=e.addChannelForm.otherDeposit,e.$store.state.vuexStore.channelList[a].BalanceInfo={},e.$store.state.vuexStore.channelList[a].BalanceInfo[SendUrl]={},e.$store.state.vuexStore.channelList[a].BalanceInfo[e.addChannelForm.uri]={},e.$store.state.vuexStore.channelList[a].BalanceInfo[SendUrl][assets]=e.addChannelForm.selfdeposit,e.$store.state.vuexStore.channelList[a].BalanceInfo[e.addChannelForm.uri][assets]=e.addChannelForm.otherDeposit,e.$store.state.vuexStore.channelList[a].isTestNet=!0,e.$store.state.vuexStore.channelList[a].SelfUri=SendUri,e.$store.state.vuexStore.channelList[a].OtherUri=e.addChannelForm.uri,e.$store.state.vuexStore.channelList[a].date=r,e.$store.state.vuexStore.channelList[a].Ip=uri2Ip(e.addChannelForm.uri,null),e.StoreChannel()}})},websocketOnmessage(e){let t=this,a=JSON.parse(e.data),n=a.MessageType;switch(console.log(a),n){case"Founder":t.OnMesFounder(a);break;case"FounderSign":t.OnMesFounderSign(a);break;case"RegisterChannel":t.OnMesRegisterChannel(a);break;case"AddChannel":t.OnMesAddChannel(a);break;case"FounderFail":t.OnMesFounderFail(a);break;case"Rsmc":t.OnMesRsmc(a);break;case"RsmcSign":t.OnMesRsmcSign(a);break;case"RsmcFail":t.OnMesRsmcFail(a);break;case"AckRouterInfo":t.OnMesAckRouterInfo(a);break;case"Htlc":t.OnMesHtlc(a);break;case"HtlcSign":t.OnMesHtlcSign(a);break;case"HtlcFail":t.OnMesHtlcFail(a);break;case"RResponse":t.OnMesRResponse(a);break;case"SettleSign":t.OnMesSettleSign(a);break;case"UpdateChannel":t.OnMesUpdateChannel(a);break;case"DeleteChannel":t.OnMesDeleteChannel(a);break;case"Settle":t.OnMesSettle(a);break;case"RegisterChannelFail":t.OnMesRegisterChannelFail(a);break;case"ChannelInfo":t.OnMesChannelInfo(a);break;case"SyncBlock":console.log(1)}},OnMesFounder:function(e){var t=this;let a=getChannelSerial(ChannelName,e.ChannelName),n=e.MessageBody,s=t.$parent.decryptPrivateKey(t.$store.state.vuexStore.walletInfo.keyStore,t.addChannelForm.keyStorePass);t.$store.state.vuexStore.FoundertxDataSign=signData(n.Founder.txData,s);let o=signData(n.Commitment.txData,s),r=signData(n.RevocableDelivery.txData,s),i={MessageType:"FounderSign",Sender:e.Receiver,Receiver:e.Sender,ChannelName:e.ChannelName,TxNonce:e.TxNonce,MessageBody:{Founder:{txDataSign:t.$store.state.vuexStore.FoundertxDataSign,originalData:n.Founder},Commitment:{txDataSign:o,originalData:n.Commitment},RevocableDelivery:{txDataSign:r,originalData:n.RevocableDelivery},AssetType:e.MessageBody.AssetType,Deposit:e.MessageBody.Deposit,RoleIndex:e.MessageBody.RoleIndex}};t.websock[a].data.send(JSON.stringify(i));t.uri2Ip(e.Sender,20556);axios({method:"post",url:t.RpcUrl,headers:{"Content-Type":"application/json;charset=UTF-8"},data:JSON.stringify({jsonrpc:"2.0",method:"FunderTransaction",params:[e.Sender.split("@")[0],e.Receiver.split("@")[0],n.Founder.addressFunding,n.Founder.scriptFunding,e.MessageBody.Deposit,e.MessageBody.Deposit,n.Founder.txId,e.MessageBody.AssetType],id:1})}).then(function(s){console.log(s.data);var o={MessageType:"Founder",Sender:e.Receiver,Receiver:e.Sender,TxNonce:e.TxNonce,ChannelName:e.ChannelName,MessageBody:{Founder:n.Founder,Commitment:s.data.result.C_TX,RevocableDelivery:s.data.result.R_TX,AssetType:e.MessageBody.AssetType,Deposit:e.MessageBody.Deposit,RoleIndex:e.MessageBody.RoleIndex+1}};t.$store.state.vuexStore.channelList.websock[a].data.send(JSON.stringify(o))}),n.ChannelName=e.ChannelName,t.TxList.push(n),t.StoreFounder()},OnMesFounderSign:function(e){var t=this;let a;t.websock.forEach(function(t,n){if(t.ChannelName===e.ChannelName)return a=n,!1});let n=e.MessageBody,s=n.Founder.originalData.witness.split("{signOther}")[1],o=n.Founder.originalData.txData+n.Founder.originalData.witness.split("{signOther}")[0]+n.Founder.txDataSign+s.split("{signSelf}")[0]+this.FoundertxDataSign+s.split("{signSelf}")[1];t.UriToIp(e.Sender,20556);"retry"!==e.Comments&&axios({method:"post",url:this.SendrawUrl,headers:{"Content-Type":"application/json;charset=UTF-8"},data:JSON.stringify({jsonrpc:"2.0",method:"sendrawtransaction",params:[o],id:1})}).then(function(n){if(1==n.data.result)swal({title:"Success!",text:"Channel has been created, please wait for it to open.",type:"success",showCancelButton:!1}),t.ChannelItems.forEach(function(a,n){a.ChannelName===e.ChannelName&&t.$set(a,"Flag",3)});else{let n={MessageType:"FounderFail",Sender:e.Receiver,Receiver:e.Sender,ChannelName:e.ChannelName,TxNonce:0,MessageBody:e.MessageBody,Error:"SendFounderRawTransactionFail",Comments:"retry"};t.$store.state.vuexStore.channelList.websock[a].data.send(JSON.stringify(n))}})},OnMesRegisterChannel:function(e){var t=this,a=t.FounderFailI;t.UriToIp(e.Sender,20556);axios({method:"post",url:t.RpcUrl,headers:{"Content-Type":"application/json;charset=UTF-8"},data:JSON.stringify({jsonrpc:"2.0",method:"FunderCreate",params:[e.Sender.split("@")[0],e.Receiver.split("@")[0],e.MessageBody.Deposit,e.MessageBody.AssetType],id:1})}).then(function(n){let s={MessageType:"Founder",Sender:e.Receiver,Receiver:e.Sender,TxNonce:0,ChannelName:e.ChannelName,MessageBody:{Founder:n.data.result.Founder,Commitment:n.data.result.C_TX,RevocableDelivery:n.data.result.R_TX,AssetType:e.MessageBody.AssetType,Deposit:e.MessageBody.Deposit,RoleIndex:0},Comments:"retry"},o="";t.websock.forEach(function(t,n){n===a&&(o=t.ChannelName,t.ChannelName=e.ChannelName)}),t.ChannelItems.forEach(function(t,a){t.ChannelName===o&&(t.ChannelName=e.ChannelName)}),t.websock[a].data.send(JSON.stringify(s)),t.ChannelItems.forEach(function(a,n){a.ChannelName===e.MessageBody.ChannelName&&(t.Founder=e.Sender,t.Receiver=e.Receiver,t.$set(a,"Flag",3))})})},OnMesAddChannel:function(e){let t=this;t.ChannelItems.forEach(function(a,n){if(a.ChannelName===e.MessageBody.ChannelName){t.$set(a,"Flag",4);let n={ChannelName:e.MessageBody.ChannelName,TxNonce:0};t.TxNonceList.push(n),t.StoreTxNonce(),swal({title:"Success!",text:"Channel has been opened.",type:"success",showCancelButton:!1});let s={Address:a.Name,Amount:a.Balance,AssetType:a.AssetType,Fee:0,Flag:!0,isTestNet:t.isTestNet,Date:(new Date).getTime()};t.RecordList.push(s),t.StoreRecordList(t.RecordList)}})},OnMesRegisterChannelFail:function(e){let t=this;t.ChannelItems.forEach(function(a,n){a.ChannelName===e.ChannelName&&t.ChannelItems.splice(n,1)}),swal({title:"Fail",text:e.Error,type:"error",showCancelButton:!1})},OnMesFounderFail:function(e){let t=this;t.ChannelItems.forEach(function(a,n){a.ChannelName===e.ChannelName&&t.ChannelItems.splice(n,1)}),swal({title:"Fail",text:e.Error,type:"error",showCancelButton:!1})},OnMesRsmc:function(e){var t=this;let a;t.websock.forEach(function(t,n){if(t.ChannelName===e.ChannelName)return a=n,!1});let n,s,o=e.MessageBody;3===o.RoleIndex&&e.Receiver.split("@")[0]===t.WalletInfo.PublicKey?o.BreachRemedy&&t.TxList.forEach(function(t,a){if(t.ChannelName===e.ChannelName)return t.BreachRemedy=o.BreachRemedy,!1}):2===o.RoleIndex&&e.Receiver.split("@")[0]===t.WalletInfo.PublicKey&&o.BreachRemedy&&t.TxList.forEach(function(t,a){if(t.ChannelName===e.ChannelName)return t.BreachRemedy=o.BreachRemedy,!1}),o.Commitment&&(n=signatureData(o.Commitment.txData,this.WalletInfo.PrivateKey)),o.RevocableDelivery&&(s=signatureData(o.RevocableDelivery.txData,this.WalletInfo.PrivateKey));let r={MessageType:"RsmcSign",Sender:e.Receiver,Receiver:e.Sender,ChannelName:e.ChannelName,TxNonce:e.TxNonce,MessageBody:{Commitment:{txDataSign:n,originalData:o.Commitment},RevocableDelivery:{txDataSign:s,originalData:o.RevocableDelivery},AssetType:e.MessageBody.AssetType,Value:e.MessageBody.Value,RoleIndex:e.MessageBody.RoleIndex,Comments:e.MessageBody.Comments}};if((n||s)&&t.websock[a].data.send(JSON.stringify(r)),0===o.RoleIndex){let n,s;t.ChannelItems.forEach(function(t,a){t.ChannelName===e.ChannelName&&(n=t.Balance,s=t.Balance2)});let o=[];t.TxList.forEach(function(t,a){t.ChannelName===e.ChannelName&&o.push(t.Founder)});let r=o.length-1,i=o[r].txId,l=o[r].addressFunding,c=o[r].scriptFunding;t.UriToIp(e.Receiver,20556);axios({method:"post",url:t.RpcUrl,headers:{"Content-Type":"application/json;charset=UTF-8"},data:JSON.stringify({jsonrpc:"2.0",method:"FunderTransaction",params:[e.Sender.split("@")[0],t.WalletInfo.PublicKey,l,c,s,n,i,e.MessageBody.AssetType],id:1})}).then(function(n){console.log(n);let s={MessageType:"Rsmc",Sender:e.Receiver,Receiver:e.Sender,TxNonce:e.TxNonce,ChannelName:e.ChannelName,MessageBody:{Commitment:n.data.result.C_TX,RevocableDelivery:n.data.result.R_TX,AssetType:e.MessageBody.AssetType,Value:e.MessageBody.Value,RoleIndex:e.MessageBody.RoleIndex+1,Comments:e.MessageBody.Comments}};t.websock[a].data.send(JSON.stringify(s)),console.log(JSON.stringify(s)),t.BreachRemedy=n.data.result.BR_TX})}if(1===o.RoleIndex||2===o.RoleIndex){let n;t.TxList.forEach(function(t,a){t.ChannelName===e.ChannelName&&(n=t.Founder)});let s=signatureData(t.BreachRemedy.txData,t.WalletInfo.PrivateKey),o={MessageType:"Rsmc",Sender:e.Receiver,Receiver:e.Sender,ChannelName:e.ChannelName,TxNonce:e.TxNonce,MessageBody:{BreachRemedy:{txDataSign:s,originalData:t.BreachRemedy},AssetType:e.MessageBody.AssetType,Value:e.MessageBody.Value,RoleIndex:e.MessageBody.RoleIndex+1,Comments:e.MessageBody.Comments}};t.websock[a].data.send(JSON.stringify(o))}if(2===o.RoleIndex){let a;t.ChannelItems.forEach(function(t,n){t.ChannelName===e.ChannelName&&(a=t.Name)});let n={Address:a,Amount:e.MessageBody.Value,AssetType:e.MessageBody.AssetType,Fee:0,Flag:!0,isTestNet:t.isTestNet,Date:(new Date).getTime()};t.RecordList.push(n)}},OnMesRsmcSign:function(e){this.TxNonceList.forEach(function(t,a){t.ChannelName===e.ChannelName&&t.TxNonce++})},OnMesRsmcFail:function(e){swal({title:"Info.",text:e.Error,type:"info",showCancelButton:!1})},OnMesAckRouterInfo:function(e){if(null===e.RouterInfo)return swal({title:"Info",text:"There is no channel available for transfer.",type:"error",showCancelButton:!1}),this.PaymentLink="",!1;{let a=this,n=e.RouterInfo.FullPath;8766==a.TxOnChannelInfo.ReceiverUrl.split(":")[1]&&(n.unshift([a.TxOnChannelInfo.SendUrl,0]),n.push([a.TxOnChannelInfo.ReceiverUrl,0]));let s,o,r,i=n.length-1,l=n[i][0],c=(a.UriToIp(l,20556),a.UriToIp(e.RouterInfo.Next,8766));a.AssetTypeToAssetId(a.TxOnChannelInfo.AssetType);a.ChannelItems.forEach(function(t,a){t.Url===e.RouterInfo.Next&&(s=t.Balance,o=t.Balance2,r=t.ChannelName)});let d,u=[];a.TxList.forEach(function(e,t){e.ChannelName===r&&u.push(e.Founder)}),a.websock.forEach(function(e,t){if(e.ChannelName===r)return d=t,!1});let h=0;for(var t=0;t<i;t++)h+=e.RouterInfo.FullPath[t][1];h=1e4*parseFloat(h).toFixed(8),this.TxOnChannelInfo.Fee=h/1e4;let m=u.length-1,p=u[m].addressFunding,v=u[m].scriptFunding;swal({title:"Attention!",text:"You will pay "+h/1e4+a.TxOnChannelInfo.AssetType+" as route fee.",type:"info",showCancelButton:!0,closeOnConfirm:!0},function(){axios({method:"post",url:a.RpcUrl,headers:{"Content-Type":"application/json;charset=UTF-8"},data:JSON.stringify({jsonrpc:"2.0",method:"HTLCTransaction",params:[a.WalletInfo.PublicKey,a.TxOnChannelInfo.ReceiverUrl.split("@")[0],(a.TxOnChannelInfo.Value+h)/1e4,s,o,a.TxOnChannelInfo.Hr,p,v,a.TxOnChannelInfo.AssetType],id:1})}).then(function(t){let s=0;a.TxNonceList.forEach(function(e,t){e.ChannelName===r&&(s=e.TxNonce)});let o={MessageType:"Htlc",Sender:a.WalletInfo.PublicKey+"@"+c,Receiver:e.RouterInfo.Next,TxNonce:s+1,ChannelName:r,Router:n,Next:e.RouterInfo.Next,MessageBody:{HCTX:t.data.result.HCTX,RDTX:t.data.result.RDTX,HEDTX:t.data.result.HEDTX,HTTX:t.data.result.HTTX,HTDTX:t.data.result.HTDTX,HTRDTX:t.data.result.HTRDTX,RoleIndex:0,Comments:"",Count:(a.TxOnChannelInfo.Value+h)/1e4,AssetType:a.TxOnChannelInfo.AssetType,HashR:a.TxOnChannelInfo.Hr}};a.websock[d].data.send(JSON.stringify(o)),a.PaymentLink="",setTimeout(function(){!1===a.HtlcFlag&&swal({title:"transaction failed.",type:"error",showCancelButton:!1})},3e3)})})}},OnMesHtlc:function(e){let t=this;t.HtlcFlag=!0;let a,n,s,o,r,i,l,c=e.MessageBody,d=c.RoleIndex;if(t.websock.forEach(function(t,n){if(t.ChannelName===e.ChannelName)return a=n,!1}),c.HCTX&&(n=signatureData(c.HCTX.txData,this.WalletInfo.PrivateKey),console.log("HCTX_sig:"+n)),c.HTTX&&(s=signatureData(c.HTTX.txData,this.WalletInfo.PrivateKey),console.log("HTTX_sig:"+s)),c.HTDTX&&(o=signatureData(c.HTDTX.txData,this.WalletInfo.PrivateKey),console.log("HTDTX_sig:"+o)),c.HTRDTX&&(r=signatureData(c.HTRDTX.txData,this.WalletInfo.PrivateKey),console.log("HTRDTX_sig:"+r)),c.RDTX&&(i=signatureData(c.RDTX.txData,this.WalletInfo.PrivateKey),console.log("RDTX_sig:"+i)),0===d?l={MessageType:"HtlcSign",Sender:e.Receiver,Receiver:e.Sender,TxNonce:e.TxNonce,ChannelName:e.ChannelName,Router:e.Router,Next:e.Next,MessageBody:{HCTX:{txDataSign:n,originalData:c.HCTX},RDTX:{txDataSign:i,originalData:c.RDTX},HTTX:{txDataSign:s,originalData:c.HTTX},HTRDTX:{txDataSign:r,originalData:c.HTRDTX},HEDTX:c.HEDTX,RoleIndex:c.RoleIndex,Comments:"",Count:c.Count,AssetType:c.AssetType,HashR:c.HashR}}:1===d&&(l={MessageType:"HtlcSign",Sender:e.Receiver,Receiver:e.Sender,TxNonce:e.TxNonce,ChannelName:e.ChannelName,Router:e.Router,Next:e.Next,MessageBody:{HCTX:{txDataSign:n,originalData:c.HCTX},RDTX:{txDataSign:i,originalData:c.RDTX},HTDTX:{txDataSign:o,originalData:c.HTDTX},HETX:c.HETX,HERDTX:c.HERDTX,RoleIndex:c.RoleIndex,Comments:"",Count:c.Count,AssetType:c.AssetType,HashR:c.HashR}}),t.websock[a].data.send(JSON.stringify(l)),0===d){let n,s,o;t.ChannelItems.forEach(function(t,a){t.Url===e.Sender&&(n=t.Balance,s=t.Balance2,o=t.ChannelName)});let r=[];t.TxList.forEach(function(e,t){e.ChannelName===o&&r.push(e.Founder)}),console.log(a),console.log(r);let i=r.length-1;console.log(r[i]);let l=r[i].addressFunding;console.log(l);let d=r[i].scriptFunding;axios({method:"post",url:t.RpcUrl,headers:{"Content-Type":"application/json;charset=UTF-8"},data:JSON.stringify({jsonrpc:"2.0",method:"HTLCTransaction",params:[t.WalletInfo.PublicKey,e.Sender.split("@")[0],c.Count,n,s,c.HashR,l,d,c.AssetType],id:1})}).then(function(n){console.log(n);let s=signatureData(n.data.result.HETX.txData,t.WalletInfo.PrivateKey),r=signatureData(n.data.result.HERDTX.txData,t.WalletInfo.PrivateKey),i={MessageType:"Htlc",Sender:e.Receiver,Receiver:e.Sender,TxNonce:e.TxNonce,ChannelName:o,Router:e.Router,Next:e.Next,MessageBody:{HCTX:n.data.result.HCTX,RDTX:n.data.result.RDTX,HTDTX:n.data.result.HTDTX,HETX:{txDataSign:s,originalData:n.data.result.HETX},HERDTX:{txDataSign:r,originalData:n.data.result.HERDTX},RoleIndex:c.RoleIndex+1,Comments:"",Count:c.Count,AssetType:c.AssetType,HashR:c.HashR}};t.websock[a].data.send(JSON.stringify(i))})}},OnMesHtlcSign:function(e){let t,a=this,n=e.MessageBody;if(a.websock.forEach(function(a,n){if(a.ChannelName===e.ChannelName)return t=n,!1}),a.TxNonceList.forEach(function(t,a){t.ChannelName===e.ChannelName&&t.TxNonce++}),1===n.RoleIndex){let s="";console.log("HashR:"+e.MessageBody.HashR),a.RList.forEach(function(e,t){e.Hr===n.HashR&&(console.log(e.Hr),s=e.R)});let o={MessageType:"RResponse",Sender:e.Receiver,Receiver:e.Sender,TxNonce:e.TxNonce,ChannelName:e.ChannelName,Router:e.RouterInfo,Next:e.Next,MessageBody:{RoleIndex:0,Comments:"",Count:e.MessageBody.Count,AssetType:e.MessageBody.AssetType,R:s,HR:e.MessageBody.HashR}};a.websock[t].data.send(JSON.stringify(o))}},OnMesHtlcFail:function(e){swal({title:"Info",text:e.Error,type:"info",showCancelButton:!1})},OnMesFounderFail:function(e){let t=this;t.ChannelItems.forEach(function(a,n){a.ChannelName===e.ChannelName&&t.ChannelItems.splice(n,1)}),swal({title:"Fail",text:e.Error,type:"error",showCancelButton:!1})},OnMesRResponse:function(e){var t=this;if(hex_sha1(e.MessageBody.R)===e.MessageBody.HR){let a,n;t.ChannelItems.forEach(function(t,s){t.ChannelName===e.ChannelName&&(a=t.Balance,n=t.Balance2)});let s,o=[];t.TxList.forEach(function(t,a){t.ChannelName===e.ChannelName&&o.push(t.Founder)}),t.websock.forEach(function(t,a){if(t.ChannelName===e.ChannelName)return s=a,!1});let r=o.length-1,i=o[r].txId,l=o[r].addressFunding,c=o[r].scriptFunding;t.UriToIp(t.TxOnChannelInfo.ReceiverUrl,20556);axios({method:"post",url:t.RpcUrl,headers:{"Content-Type":"application/json;charset=UTF-8"},data:JSON.stringify({jsonrpc:"2.0",method:"FunderTransaction",params:[e.Sender.split("@")[0],t.WalletInfo.PublicKey,l,c,n,a,i,e.MessageBody.AssetType],id:1})}).then(function(a){console.log(a);let n,o={MessageType:"Rsmc",Sender:e.Receiver,Receiver:e.Sender,TxNonce:e.TxNonce+1,ChannelName:e.ChannelName,MessageBody:{Commitment:a.data.result.C_TX,RevocableDelivery:a.data.result.R_TX,AssetType:t.TxOnChannelInfo.AssetType,Value:e.MessageBody.Count,RoleIndex:0,Comments:t.TxOnChannelInfo.Hr}};t.websock[s].data.send(JSON.stringify(o)),console.log(JSON.stringify(o)),t.BreachRemedy=a.data.result.BR_TX,t.ChannelItems.forEach(function(t,a){t.ChannelName===e.ChannelName&&(n=t.Name)});let r={Address:n,Amount:t.TxOnChannelInfo.Value/1e4,AssetType:t.TxOnChannelInfo.AssetType,Fee:t.TxOnChannelInfo.Fee,Flag:!1,isTestNet:t.isTestNet,Date:(new Date).getTime()};t.RecordList.push(r),t.StoreRecordList(t.RecordList)})}},OnMesSettleSign:function(e){var t=this;let a=t.SettleInfo.witness.split("{signSelf}")[1],n=t.SettleInfo.txData+t.SettleInfo.witness.split("{signSelf}")[0]+t.SettleInfo.signSelf+a.split("{signOther}")[0]+e.MessageBody.Settlement.txDataSign+a.split("{signOther}")[1];axios({method:"post",url:this.SendrawUrl,headers:{"Content-Type":"application/json;charset=UTF-8"},data:JSON.stringify({jsonrpc:"2.0",method:"sendrawtransaction",params:[n],id:1})}).then(function(a){!0===a.data.result?(t.ChannelItems.forEach(function(a,n){a.ChannelName===e.ChannelName&&t.$set(a,"Flag",1)}),swal({title:"Success!",text:"Channel is closed, please wait for settlement",type:"success",showCancelButton:!1})):swal({title:"Error",text:"Failed to close channel, please try again later",type:"error",showCancelButton:!1})})},OnMesUpdateChannel:function(e){var t=this;let a="",n="";e.MessageBody.Founder.split("@")[0]===t.WalletInfo.PublicKey?(a=e.MessageBody.Founder,n=e.MessageBody.Receiver):(a=e.MessageBody.Receiver,n=e.MessageBody.Founder);var s=e.MessageBody.Balance[a].TNC;s=parseFloat(s);var o=e.MessageBody.Balance[n].TNC;o=parseFloat(o),t.ChannelItems.forEach(function(a,n){a.ChannelName===e.MessageBody.ChannelName&&(a.Balance=s,a.Balance2=o,a.BalanceInfo=e.MessageBody.Balance,swal({title:"Info",text:"Channel balance updated.",type:"info",showCancelButton:!1}),Bus.$emit("ClosePaymentCodeBox"),t.GetAssetsBalance())})},OnMesDeleteChannel:function(e){let t=this;t.ChannelItems.forEach(function(a,n){if(a.ChannelName===e.MessageBody.ChannelName){let e={Address:a.Name,Amount:a.Balance,AssetType:a.AssetType,Fee:0,Flag:!1,isTestNet:t.isTestNet,Date:(new Date).getTime()};t.ChannelItems.splice(n,1),t.RecordList.push(e),t.StoreRecordList(t.RecordList)}}),t.websock.forEach(function(a,n){a.ChannelName!==e.MessageBody.ChannelName||t.websock.splice(n,1)})},OnMesSettle:function(e){let t,a=signatureData(MessageBody.Settlement.txData,this.WalletInfo.PrivateKey);if(this.websock.forEach(function(a,n){if(a.ChannelName===e.ChannelName){if(4===a.Flag)return t=n,!1;swal({title:"This channel is not open.",type:"info",showCancelButton:!1})}}),!t)return swal({title:"This channel is not open.",type:"info",showCancelButton:!1}),!1;let n={MessageType:"SettleSign",Sender:e.Receiver,Receiver:e.Sender,TxNonce:e.TxNonce,ChannelName:e.ChannelName,MessageBody:{Settlement:{originalData:e.MessageBody.Settlement,txDataSign:a},Balance:e.MessageBody.Balance}};this.websock[t].data.send(JSON.stringify(n))},OnMesChannelInfo:function(e){let t=this;for(var a=0;a<e.Peers.length;a++)t.ChannelItems.forEach(function(t,n){t.Url.split("@")[0]===e.Peers[a]&&(t.Flag=4,t.oldFlag=5)})},WebsocketClose(e){console.log("已断开websocket");let t,a=e.currentTarget.url.split("/")[2].split(":")[0];console.log(a);var n=this;n.ChannelItems.forEach(function(e,s){if(console.log(e.Ip),e.Ip===a){t=e.ChannelName,console.log("断开时oldFlag:"+e.oldFlag);let a=e.Flag;n.$set(e,"oldFlag",a),console.log("断开时oldFlag:"+e.oldFlag),n.$set(e,"Flag",5)}})},uri2Ip(e,t){let a=e.split("@")[1];return a=null==t?a.split(":")[0]:a.split(":")[0]+":"+t},getChannelSerial(e,t){let a;return this.$store.state.vuexStore.channelList.forEach(function(n,s){n[e]!==t||(a=s)}),a},removeAddChannelData(){this.$refs.addChannelForm.resetFields()}}},j={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"addChannelBox"},[a("div",{staticClass:"contentBox"},[a("div",[e.addChannelForm.assetType?a("p",{staticStyle:{float:"right",margin:"5px 0"}},[e._v("资产余额："+e._s(e.$store.state.vuexStore.balanceData.Chain[e.addChannelForm.assetType])+e._s(e.addChannelForm.assetType))]):e._e(),e._v(" "),a("h2",[e._v("添加通道")])]),e._v(" "),a("hr",{staticStyle:{height:"2px",border:"none","border-top":"2px dotted #EBEEF5"}}),e._v(" "),a("el-form",{ref:"addChannelForm",staticClass:"addChannelForm",attrs:{model:e.addChannelForm,"status-icon":"",rules:e.addChannelRules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"对端URI",prop:"uri"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.addChannelForm.uri,callback:function(t){e.$set(e.addChannelForm,"uri",t)},expression:"addChannelForm.uri"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"资产类型",prop:"assetType"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择资产类型"},model:{value:e.addChannelForm.assetType,callback:function(t){e.$set(e.addChannelForm,"assetType",t)},expression:"addChannelForm.assetType"}},[a("el-option",{attrs:{label:"TNC",value:"TNC"}}),e._v(" "),a("el-option",{attrs:{label:"ETH",value:"ETH"}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"押金",prop:"selfdeposit"}},[a("el-input",{model:{value:e.addChannelForm.selfdeposit,callback:function(t){e.$set(e.addChannelForm,"selfdeposit",e._n(t))},expression:"addChannelForm.selfdeposit"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"对端押金",prop:"otherDeposit"}},[a("el-slider",{attrs:{"show-input-controls":!1,"format-tooltip":e.formatTooltip,"show-input":""},model:{value:e.addChannelForm.otherDeposit,callback:function(t){e.$set(e.addChannelForm,"otherDeposit",t)},expression:"addChannelForm.otherDeposit"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"通道名称",prop:"alice"}},[a("el-input",{model:{value:e.addChannelForm.alice,callback:function(t){e.$set(e.addChannelForm,"alice",t)},expression:"addChannelForm.alice"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"密码",prop:"keyStorePass"}},[a("el-input",{model:{value:e.addChannelForm.keyStorePass,callback:function(t){e.$set(e.addChannelForm,"keyStorePass",t)},expression:"addChannelForm.keyStorePass"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.addChannel()}}},[e._v("添加通道")]),e._v(" "),a("el-button",{on:{click:function(t){e.removeAddChannelData()}}},[e._v("重置")])],1)],1)],1)])},staticRenderFns:[]};var z=a("VU/8")(W,j,!1,function(e){a("+XZm")},"data-v-ea5c015e",null).exports,Z={name:"channelListForm",data:()=>({channelList:[{date:"1495157126",name:"王小虎",balance:"100",state:"Open",isPay:!0},{date:"1495157126",name:"王小虎",balance:"38",state:"Open",isPay:!0},{date:"1495157126",name:"王小虎",balance:"27",state:"Open",isPay:!0},{date:"1495157126",name:"王小虎",balance:"87",state:"Open",isPay:!0}],isChannelInfoBoxShow:!1,activeInfo:{date:"",name:"",balance:"",state:"",isPay:!0},isConfirmCloseChannel:!1}),filters:{formatStatus:function(e){var t;switch(e){case 1:t="Closing";break;case 2:t="Opening";break;case 3:t="Open";break;default:t="Error"}return t},formatDateTime:function(e){var t=new Date;t.setTime(1e3*e);var a=t.getFullYear(),n=t.getMonth()+1;n=n<10?"0"+n:n;var s=t.getDate();return a+"-"+n+"-"+(s=s<10?"0"+s:s)}},methods:{showChannelInfo(e){this.isChannelInfoBoxShow=!0,this.activeInfo=e,console.log(e)},showConfirmCloseChannelData(){this.isConfirmCloseChannel=!0},closeChannel(){console.log("关闭通道"),this.isChannelInfoBoxShow=!1,this.isConfirmCloseChannel=!1}}},q={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"channelListForm",class:{fullPage:!e.$store.state.vuexStore.isNavShow}},[a("div",{staticClass:"contentBox"},[a("div",[a("router-link",{staticStyle:{float:"right"},attrs:{to:"/addChannel"}},[a("el-button",{attrs:{size:"mini",icon:"el-icon-plus"}},[e._v("添加通道")])],1),e._v(" "),a("h2",[e._v("通道列表")])],1),e._v(" "),a("hr",{staticStyle:{height:"2px",border:"none","border-top":"2px dotted #EBEEF5"}}),e._v(" "),a("ul",e._l(e.channelList,function(t,n){return a("li",{key:n,on:{click:function(a){e.showChannelInfo(t)}}},[a("h3",[e._v(e._s(t.name))]),a("br"),e._v(" "),a("p",[e._v(e._s(e._f("formatDateTime")(t.date)))]),e._v(" "),a("p",[e._v("State：Open")]),e._v(" "),a("span",[e._v(e._s(t.balance))])])}))]),e._v(" "),a("el-dialog",{staticClass:"channelInfoBox",attrs:{title:"通道信息",visible:e.isChannelInfoBoxShow,width:"30%",center:"","modal-append-to-body":!1},on:{"update:visible":function(t){e.isChannelInfoBoxShow=t}}},[a("span",[e._v("通道名称："+e._s(e.activeInfo.name))]),e._v(" "),a("span",[e._v("开通时间："+e._s(e._f("formatDateTime")(e.activeInfo.date)))]),e._v(" "),a("span",[e._v("余额："+e._s(e.activeInfo.balance))]),e._v(" "),a("span",[e._v("通道状态："+e._s(e.activeInfo.state))]),e._v(" "),a("span",[e._v("对端地址："+e._s(e.activeInfo.name))]),e._v(" "),e.isConfirmCloseChannel?e._e():a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"danger"},on:{click:function(t){e.showConfirmCloseChannelData()}}},[e._v(" 关闭通道 ")])],1),e._v(" "),e.isConfirmCloseChannel?a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e.isConfirmCloseChannel?a("span",{staticStyle:{color:"#F56C6C"}},[e._v("确定关闭通道吗")]):e._e(),e._v(" "),a("el-button",{attrs:{type:"danger"},on:{click:function(t){e.closeChannel()}}},[e._v(" 确定 ")]),e._v(" "),a("el-button",{on:{click:function(t){e.isChannelInfoBoxShow=!1,e.isConfirmCloseChannel=!1}}},[e._v(" 取消 ")])],1):e._e()])],1)},staticRenderFns:[]};var G=a("VU/8")(Z,q,!1,function(e){a("n+ew")},"data-v-2825da26",null).exports,Y={name:"recordForm",data:()=>({tableData:[{date:"2016-05-02",name:"王小虎",Amount:"87",assetType:"TNC",isPay:!0},{date:"2016-05-04",name:"王小虎",Amount:"87",assetType:"TNC",isPay:!0},{date:"2016-05-01",name:"王小虎",Amount:"127",assetType:"TNC",isPay:!1},{date:"2016-05-03",name:"王小虎",Amount:"87",assetType:"TNC",isPay:!0}],currentRow:null}),filters:{formatIsPay:function(e){return e?"-":"+"}},methods:{setCurrent(e){this.$refs.singleTable.setCurrentRow(e)},handleCurrentChange(e){this.currentRow=e}}},Q={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"recordForm",class:{fullPage:!e.$store.state.vuexStore.isNavShow}},[a("div",{staticClass:"contentBox"},[a("h2",[e._v("交易记录")]),e._v(" "),a("hr",{staticStyle:{height:"2px",border:"none","border-top":"2px dotted #EBEEF5"}}),e._v(" "),a("ul",e._l(e.tableData,function(t,n){return a("li",{key:n},[a("h3",[e._v(e._s(t.name))]),a("br"),e._v(" "),a("p",[e._v(e._s(t.date))]),e._v(" "),a("p",[e._v("资产类型："+e._s(t.assetType))]),e._v(" "),a("span",[e._v(e._s(e._f("formatIsPay")(t.isPay))+e._s(t.Amount))])])}))])])},staticRenderFns:[]};var ee=a("VU/8")(Y,Q,!1,function(e){a("fXTW")},"data-v-079d99e4",null).exports,te={name:"indexForm",data:()=>({privateKey:"",publicKey:"",address:"",signData1:""}),methods:{createPrivateKey(){this.privateKey=createPrivateKey().toString("hex")},privateKey2PublicKey(){this.publicKey=privateKey2PublicKey(this.privateKey).toString("hex")},publicKey2Address(){this.address=publicKey2Address(this.publicKey).toString("hex")}}},ae={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"indexForm",class:{fullPage:!e.$store.state.vuexStore.isNavShow}},[a("div",{staticClass:"contentBox"},[a("h5",{on:{click:function(t){e.createPrivateKey()}}},[e._v("创建私钥")]),e._v(" "),a("h5",[e._v("私钥为："+e._s(e.privateKey))]),e._v(" "),a("h5",{on:{click:function(t){e.privateKey2PublicKey()}}},[e._v("私钥转公钥")]),e._v(" "),a("h5",[e._v("公钥为："+e._s(e.publicKey))]),e._v(" "),a("h5",{on:{click:function(t){e.publicKey2Address()}}},[e._v("公钥转地址")]),e._v(" "),a("h5",[e._v("地址为："+e._s(e.address))])])])},staticRenderFns:[]};var ne=a("VU/8")(te,ae,!1,function(e){a("Hrqu")},"data-v-2687a4ce",null).exports;n.default.use(y.a);var se=new y.a({routes:[{path:"/",name:"index",component:S},{path:"/backup",name:"BackupForm",component:P},{path:"/contact",name:"contactForm",component:A},{path:"/receive",name:"receiveForm",component:V},{path:"/start",name:"startForm",component:_},{path:"/create",name:"createForm",component:B},{path:"/loginByPrivateKey",name:"loginByPrivateKeyForm",component:R},{path:"/loginByKeyStore",name:"loginByKeyStoreForm",component:D},{path:"/addChannel",name:"addChannelForm",component:z},{path:"/index6",name:"index6",component:ne},{path:"/channelList",name:"channelListForm",component:G},{path:"/record",name:"recordForm",component:ee}],mode:"hash"}),oe=a("zL8q"),re=a.n(oe),ie=(a("tvR6"),a("NYxO")),le=a("urW8"),ce=a.n(le),de=a("TXmL");a("wUZ8");var ue={navMenu:{title:"Menu",wallet:{title:"Wallet",index:"Index",receive:"Receive",addChannel:"Add Channel",channelList:"Channel",record:"Record"},contact:"Contact",setting:{title:"Setting",switchLang:"更改语言",switchNet:"Switch Net",nightMode:"Night Mode",changePass:"Change Pass",backUp:"Backup",signOut:"Sign Out"}}};a("Vi3T");var he={en:ue,cn:{navMenu:{title:"菜单",wallet:{title:"钱包",index:"首页",receive:"收款",addChannel:"添加通道",channelList:"通道",record:"交易记录"},contact:"联系人",setting:{title:"设置",switchLang:"Switch Language",switchNet:"选择网络",nightMode:"夜间模式",changePass:"修改密码",backUp:"备份",signOut:"退出"}}}};n.default.use(de.a);const me=new de.a({locale:localStorage.lang||"cn",messages:he});ce.a.i18n((e,t)=>me.vm._t(e,t));var pe=me,ve=(a("7xIN"),{state:{isLogin:!1,isNightMode:!1,activeNavIndex:"1-1",isNavShow:!0,isMessageBoxShow:!1,Magic:"",walletInfo:{keyStore:"",publicKey:"",address:""},balanceData:{Chain:{TNC:0,ETH:0},Channel:{TNC:0,ETH:0}},channelList:[],contactList:{},FoundertxDataSign:""},getters:{switchLogin:e=>!e.isLogin,signOut:e=>(e.walletInfo={privateKey:"",publicKey:"",address:""},e.walletInfo)},mutations:{switch_dialog(e){e.show=!e.show}},actions:{switch_dialog(e){e.commit("switch_dialog")}}});n.default.use(ie.a);var fe=new ie.a.Store({modules:{vuexStore:ve}});n.default.use(re.a),n.default.use(ie.a),n.default.config.productionTip=!1,new n.default({el:"#app",router:se,store:fe,i18n:pe,components:{App:g},template:"<App/>"})},PH7Z:function(e,t,a){"use strict";(function(e){t.a={name:"loginByKeyStoreForm",data:()=>({fileList:[],keyStoreContent:"",keyStorePass:""}),mounted(){this.$nextTick(function(){})},methods:{handleChange(e,t){var a=this;if(e.raw){let t=new FileReader;t.onload=function(e){a.keyStoreContent=JSON.parse(e.target.result),40!==a.keyStoreContent.address.length&&(a.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"KeyStore文件读取错误",duration:3e3}),a.keyStoreContent="")},t.readAsText(e.raw,"gb2312")}},login(){if(""==this.keyStoreContent)return this.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"KeyStore文件不能为空",duration:3e3}),!1;if(""==this.keyStoreContent)return this.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"密码不能为空",duration:3e3}),!1;let e=this.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)",target:document.querySelector(".loginByKeyStoreContentBox")}),t=this;setTimeout(function(){t.loginByKeyStore(),e.close()},2e3)},loginByKeyStore(){let t;try{t=web3.eth.accounts.decrypt(this.keyStoreContent,this.keyStorePass)}catch(e){return"Key derivation failed - possibly wrong password"==e.message?(this.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"钱包解锁失败 - 可能是密码错误",duration:3e3}),!1):(this.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:e.message,duration:3e3}),!1)}let a=new e(t.privateKey.substring(2),"hex").toString("hex"),n=web3.eth.accounts.privateKeyToAccount("0x"+a).address;n=web3.utils.toChecksumAddress(n),web3.utils.checkAddressChecksum(n)?(this.$store.state.vuexStore.walletInfo.keyStore=this.keyStoreContent,this.$store.state.vuexStore.walletInfo.address=n,this.$store.state.vuexStore.isLogin=!0,this.$notify({title:"成功",dangerouslyUseHTMLString:!0,message:"导入成功",duration:3e3,type:"success"}),this.$router.push("/"),this.$store.state.vuexStore.activeNavIndex="1-1"):this.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"导入失败，请确认KeyStore和密码正确",duration:3e3}),this.keyStoreContent="",this.keyStorePass=""}}}}).call(t,a("EuP9").Buffer)},QN2h:function(e,t){},S417:function(e,t){},SJzi:function(e,t){},"Z+i4":function(e,t){},ZY0u:function(e,t){},dnib:function(e,t){},fXTW:function(e,t){},iygy:function(e,t){},"n+ew":function(e,t){},nGJZ:function(e,t){},oKGu:function(e,t){},oM9L:function(e,t){},tvR6:function(e,t){},wICs:function(e,t){}},["NHnr"]);