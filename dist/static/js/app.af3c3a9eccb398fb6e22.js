webpackJsonp([1],{"+LLG":function(e,t){},"2QOi":function(e,t){},"4IkI":function(e,t){},"5Clm":function(e,t){},"6Ql0":function(e,t){},"7xIN":function(e,t){},AiXa:function(e,t){},DBDg:function(e,t){},GJJI:function(e,t){},"N+8p":function(e,t,n){e.exports=n.p+"static/img/Trinity.9d7f65f.png"},NHnr:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n("7+uW"),s=n("TXMN"),o={name:"LeftNav",data:()=>({isLogin:!1,isNightMode:!1,navSelected:"1-1"}),computed:{classObject:function(){return{"el-icon-ETH-yingwenyuyan":"cn"===this.$i18n.locale,"el-icon-ETH-zhongwenyuyan":"en"===this.$i18n.locale}}},watch:{isNightMode(e,t){console.log("当前夜间模式为"+e),this.$store.state.vuexStore.isNightMode=e,this.$parent.saveAsString("isNightMode",this.$store.state.vuexStore.isNightMode)},"$store.state.vuexStore.activeNavIndex":"storeToNav","$store.state.vuexStore.walletInfo.address":"getAddressInfo"},mounted(){this.$nextTick(function(){let e=this;e.$store.state.vuexStore.isLogin=e.$parent.fetchAsArray("isLogin"),console.log("当前登陆状态为"+e.$store.state.vuexStore.isLogin),e.isNightMode=e.$parent.fetchAsString("isNightMode"),e.$store.state.vuexStore.isLogin&&""!=e.$store.state.vuexStore.isLogin||e.$router.push("/start")})},methods:{switchLang(){"cn"===this.$i18n.locale?this.$i18n.locale="en":this.$i18n.locale="cn",this.$parent.saveAsString("lang",this.$i18n.locale)},switchNightMode(){!1===this.$store.state.vuexStore.isNightMode?this.$store.state.vuexStore.isNightMode=!0:this.$store.state.vuexStore.isNightMode=!1,this.$parent.saveAsString("isNightMode",this.$store.state.vuexStore.isNightMode)},switchNet(e){console.log("切换到"+e)},storeToNav(){this.navSelected=this.$store.state.vuexStore.activeNavIndex},selectItems(e){this.$store.state.vuexStore.activeNavIndex=e},toOtherForm(e){this.$store.state.vuexStore.isLogin&&""!=this.$store.state.vuexStore.isLogin?this.$router.push(e):this.$router.push("/start")},testFun(){let e={MessageType:"Rsmc",Sender:"0xDd1C2C608047Bd98962Abf15f9f074620f9d44bf@106.15.91.150:8089",Receiver:"0xDd1C2C608047Bd98962Abf15f9f074620f9d44bf@106.15.91.150:8089",TxNonce:1,ChannelName:1.2623152469958293e48,NetMagic:this.$store.state.vuexStore.NetMagic,MessageBody:{AssetType:"TNC",PaymentCount:2,SenderBalance:10,ReceiverBalance:10,Commitment:"0xDd1C2C608047Bd98962Abf15f9f074620f9d44bf0xDd1C2C608047Bd98962Abf15f9f074620f9d44bf"},Comments:{}};return this.$notify.info({title:"消息",duration:0,message:e.Sender.split("@")[0]+"正在向你转账,需要你解锁钱包,点击进行解锁",onClick:this.$parent.showReceiptInfoBox}),!1},keepDecimalPlaces(e,t){let n;return n=isNaN(e)?NaN:parseInt(e*Math.pow(10,t))/Math.pow(10,t)},getAddressInfo(){this.getBalance();let e={messageType:"init",walletAddress:this.$store.state.vuexStore.walletInfo.address};this.$store.state.vuexStore.NodeUriWebSocket.send(JSON.stringify(e)),this.$store.state.vuexStore.contactList=this.$parent.fetchAsArray(this.$store.state.vuexStore.walletInfo.address+"@contactList"),this.$store.state.vuexStore.channelList=this.$parent.fetchAsArray(this.$store.state.vuexStore.walletInfo.address+"@channelList"),this.cycleReconnectWebsocket()},getBalance(){this.getEthBalance(),this.getTncBalance()},getEthBalance(){let e=this;e.$store.state.vuexStore.walletInfo.address&&web3.utils.checkAddressChecksum(e.$store.state.vuexStore.walletInfo.address)&&web3.eth.getBalance(e.$store.state.vuexStore.walletInfo.address).then(function(t){console.log(t);let n=web3.utils.fromWei(web3.utils.hexToNumberString(t));console.log(n),e.$store.state.vuexStore.balanceData.Chain.ETH=e.keepDecimalPlaces(n,3)})},getTncBalance(){let e=this;new web3.eth.Contract(e.$store.state.vuexStore.tncContractAbi,e.$store.state.vuexStore.tncContractAddress,{from:e.$store.state.vuexStore.walletInfo.address,gasPrice:"10000000000"}).methods.balanceOf(e.$store.state.vuexStore.walletInfo.address).call({from:"0x65096f2B7A8dc1592479F1911cd2B98dae4d2218"},function(t,n){if(t)console.log(t);else{let t=n/1e8;e.$store.state.vuexStore.balanceData.Chain.TNC=e.keepDecimalPlaces(t,3)}})},cycleReconnectWebsocket(){var e=this;e.$store.state.vuexStore.channelList.forEach(function(t,n){e.$parent.reconnectWebsocket(t.Ip+":8766",t.ChannelName)})}}},r={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("nav",[n("h1",{on:{click:function(t){e.testFun()}}},[e._v(e._s(e.$t("navMenu.title")))]),e._v(" "),n("el-row",{staticClass:"tac"},[n("el-col",{attrs:{span:24}},[n("el-menu",{staticClass:"el-menu-vertical-demo",attrs:{"default-active":e.navSelected,active:e.navSelected,"background-color":"#545c64","text-color":"#fff","active-text-color":"#ffd04b"},on:{select:e.selectItems}},[n("el-submenu",{attrs:{index:"1"}},[n("template",{slot:"title"},[n("i",{staticClass:"el-icon-ETH-32"}),e._v(" "),n("span",[e._v(e._s(e.$t("navMenu.wallet.title")))])]),e._v(" "),n("el-menu-item-group",[n("el-menu-item",{attrs:{index:"1-1"},on:{click:function(t){e.toOtherForm("/")}}},[n("i",{staticClass:"el-icon-ETH-geren1"}),e._v(" "),n("span",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(e.$t("navMenu.wallet.index")))])]),e._v(" "),n("el-menu-item",{attrs:{index:"1-2"},on:{click:function(t){e.toOtherForm("/receive")}}},[n("i",{staticClass:"el-icon-ETH-zhuanzhang"}),e._v(" "),n("span",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(e.$t("navMenu.wallet.receive")))])]),e._v(" "),n("el-menu-item",{attrs:{index:"1-3"},on:{click:function(t){e.toOtherForm("/channelList")}}},[n("i",{staticClass:"el-icon-ETH-list"}),e._v(" "),n("span",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(e.$t("navMenu.wallet.channelList")))])]),e._v(" "),n("el-menu-item",{attrs:{index:"1-4"},on:{click:function(t){e.toOtherForm("/record")}}},[n("i",{staticClass:"el-icon-ETH-dujiayuniconzhenggao-19"}),e._v(" "),n("span",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(e.$t("navMenu.wallet.record")))])])],1)],2),e._v(" "),n("el-menu-item",{attrs:{index:"2"},on:{click:function(t){e.toOtherForm("/contact")}}},[n("i",{staticClass:"el-icon-ETH-lianxiren"}),e._v(" "),n("span",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(e.$t("navMenu.contact")))])]),e._v(" "),n("el-submenu",{attrs:{index:"3"}},[n("template",{slot:"title"},[n("i",{staticClass:"el-icon-setting"}),e._v(" "),n("span",[e._v(e._s(e.$t("navMenu.setting.title")))])]),e._v(" "),n("el-menu-item-group",[n("el-menu-item",{attrs:{index:"3-1"},on:{click:function(t){e.switchLang()}}},[n("i",{class:e.classObject}),e._v(" "),n("span",[e._v(e._s(e.$t("navMenu.setting.switchLang")))])]),e._v(" "),n("el-submenu",{attrs:{index:"3-2",disabled:""}},[n("template",{slot:"title"},[n("i",{staticClass:"el-icon-ETH-wangluo"}),e._v(" "),n("span",[e._v(e._s(e.$t("navMenu.setting.switchNet")))])]),e._v(" "),n("el-menu-item",{attrs:{index:"3-2-1"},on:{click:function(t){e.switchNet("Mainnet")}}},[e._v("Mainnet")]),e._v(" "),n("el-menu-item",{attrs:{index:"3-2-2"},on:{click:function(t){e.switchNet("Ropsten")}}},[e._v("Ropsten")])],2),e._v(" "),n("el-menu-item",{staticStyle:{position:"relative"},attrs:{index:"3-3",disabled:""}},[n("i",{staticClass:"el-icon-ETH-pifu"}),e._v(" "),n("span",[e._v(e._s(e.$t("navMenu.setting.nightMode"))+"\n                            "),n("el-switch",{staticStyle:{position:"absolute",top:"50%",right:"45px","margin-top":"-9px"},attrs:{"active-color":"#F8D163",disabled:""},model:{value:e.isNightMode,callback:function(t){e.isNightMode=t},expression:"isNightMode"}})],1)]),e._v(" "),n("el-menu-item",{attrs:{index:"3-4",disabled:""}},[n("i",{staticClass:"el-icon-ETH-xiugaimima"}),e._v(" "),n("span",[e._v(e._s(e.$t("navMenu.setting.changePass")))])]),e._v(" "),n("el-menu-item",{attrs:{index:"3-5"},on:{click:function(t){e.toOtherForm("/backup")}}},[n("i",{staticClass:"el-icon-ETH-fuzhi"}),e._v(" "),n("span",[e._v(e._s(e.$t("navMenu.setting.backup")))])]),e._v(" "),n("el-menu-item",{attrs:{index:"3-6"}},[n("i",{staticClass:"el-icon-ETH-tuichu"}),e._v(" "),n("span",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(e.$t("navMenu.setting.signOut")))])])],1)],2),e._v(" "),n("el-menu-item",{attrs:{index:"4"},on:{click:function(t){e.toOtherForm("/about")}}},[n("i",{staticClass:"el-icon-ETH-xinxi"}),e._v(" "),n("span",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(e.$t("navMenu.about")))])])],1)],1)],1)],1)},staticRenderFns:[]};var i=n("VU/8")(o,r,!1,function(e){n("AiXa")},"data-v-7c4b5799",null).exports,l={name:"headBox",data:()=>({}),mounted(){this.$nextTick(function(){})},methods:{}},c={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"headBox"},[n("i",{staticClass:"listIcon el-icon-ETH-liebiao",on:{click:function(t){e.$store.state.vuexStore.isNavShow=!e.$store.state.vuexStore.isNavShow}}}),e._v(" "),n("el-badge",{staticClass:"item",staticStyle:{float:"right"},attrs:{value:3,max:99}},[n("i",{staticClass:"notificationIcon el-icon-ETH-xiaoxi",on:{click:function(t){e.$store.state.vuexStore.isMessageBoxShow=!e.$store.state.vuexStore.isMessageBoxShow}}})])],1)},staticRenderFns:[]};var d=n("VU/8")(l,c,!1,function(e){n("oM9L")},"data-v-d8eacd86",null).exports,u={name:"messageBox",data:()=>({msg:"coming soon"}),mounted(){this.$nextTick(function(){})},methods:{clearAll(){return console.log("清除全部"),this.$store.state.vuexStore.channelList=[],this.$parent.StoreChannel(),!1}}},p={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("transition",{attrs:{name:"el-fade-in-linear"}},[e.$store.state.vuexStore.isMessageBoxShow?n("div",{staticStyle:{width:"100%",height:"100%",position:"absolute"},on:{click:function(t){e.$store.state.vuexStore.isMessageBoxShow=!1}}},[n("div",{staticClass:"messageBox"},[n("div",{staticClass:"content_text"},[n("a",{staticClass:"clearAllBtn",on:{click:function(t){t.stopPropagation(),e.clearAll()}}},[e._v("清除全部")]),e._v(" "),n("h1",[e._v("消息")]),e._v(" "),n("hr",{staticStyle:{color:"#606266"}}),e._v(" "),n("div",{staticClass:"ulBox"},[n("ul",[n("li",[e._v("欢迎点击消息中心")]),e._v(" "),n("li",[e._v("目前该功能还未投入使用")]),e._v(" "),n("li",[e._v("敬请期待")])])])])])]):e._e()])},staticRenderFns:[]};var h=n("VU/8")(u,p,!1,function(e){n("6Ql0")},"data-v-6faebda2",null).exports,m={name:"footerBox",data:()=>({FooterList:[{index:"1-1",icon:"el-icon-ETH-geren1",name:"Index",router:"/"},{index:"1-2",icon:"el-icon-ETH-zhuanzhang",name:"Receive",router:"/receive"},{index:"1-3",icon:"el-icon-ETH-list",name:"Channel",router:"/channelList"},{index:"1-4",icon:"el-icon-ETH-dujiayuniconzhenggao-19",name:"Record",router:"/record"}],navSelected:"1-1"}),mounted(){this.$nextTick(function(){})},watch:{"$store.state.vuexStore.activeNavIndex":"storeToFooter"},methods:{selectItems(e){this.$store.state.vuexStore.activeNavIndex=e},storeToFooter(){this.navSelected=this.$store.state.vuexStore.activeNavIndex}}},y={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return"/start"!=e.$route.path&&"/create"!=e.$route.path&&"/loginByPrivateKey"!=e.$route.path&&"/loginByKeyStore"!=e.$route.path?n("footer",{staticClass:"footer"},[n("el-menu",{staticClass:"el-menu-demo",attrs:{"default-active":e.navSelected,active:e.navSelected,mode:"horizontal"},on:{select:e.selectItems}},e._l(e.FooterList,function(t,a){return n("el-menu-item",{key:a,attrs:{index:t.index}},[n("router-link",{staticClass:"clearfloat",attrs:{to:t.router}},[n("span",[n("i",{class:[!0,t.icon]})]),e._v(" "),n("span",[e._v(e._s(t.name))])])],1)}))],1):e._e()},staticRenderFns:[]};var v=n("VU/8")(m,y,!1,function(e){n("DBDg")},"data-v-4b4c880c",null).exports,f={name:"App",data(){return{isReceiptRsmcInfoBox:!1,isReceiptHtlcInfoBox:!1,activeInfo:{redata:[],keyStorePass:""},confirmReceiptRules:{keyStorePass:[{validator:(e,t,n)=>{if(!t)return n(new Error("钱包密码不能为空，否则将无法交易"));{let e=this.decryptPrivateKey(this.$store.state.vuexStore.walletInfo.keyStore,this.activeInfo.keyStorePass);setTimeout(()=>{if(!e)return n(new Error("钱包解锁失败 - 可能是密码错误"));n()},2e3)}},trigger:"blur"}]}}},components:{headNav:i,headBox:d,footerBox:v,messageBox:h},mounted(){this.$nextTick(function(){this.connectWebSocketForNodeUri()})},methods:{connectWebSocketForNodeUri(){this.$notify.closeAll();this.$store.state.vuexStore.NodeUriWebSocket=new WebSocket("ws://47.104.81.20:9000/"),this.$store.state.vuexStore.NodeUriWebSocket.onmessage=this.nodeUriWebsocketOnMessage,this.$store.state.vuexStore.NodeUriWebSocket.onclose=this.nodeUriWebsocketClose,this.$notify.info({title:"消息",duration:2e3,message:"正在连接至Trinity网络"})},backToStart(){this.$router.push("/start")},fetchAsArray:function(e){let t=e.toString();return JSON.parse(window.localStorage.getItem(t)||"[]")},fetchAsString:function(e){let t=e.toString();return window.localStorage.getItem(t)||""},saveAsArray:function(e,t){let n=e.toString();window.localStorage.setItem(n,JSON.stringify(t))},saveAsString:function(e,t){let n=e.toString();window.localStorage.setItem(n,t)},showLoading:function(){loading=this.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)",target:document.querySelector(".appBox")})},closeLoading:function(){loading.close()},decryptPrivateKey(e,t){let n,a=this;try{n=web3.eth.accounts.decrypt(e,t)}catch(e){return"Key derivation failed - possibly wrong password"==e.message?(a.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"钱包解锁失败 - 可能是密码错误",duration:3e3}),!1):(a.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:e.message,duration:3e3}),!1)}return n},uri2Ip(e,t){let n=e.split("@")[1];return n=null==t?n.split(":")[0]:n.split(":")[0]+":"+t},assetContractAddress2AssetType(e){let t="";if(console.log(this.$store.state.vuexStore.isTestNet),this.$store.state.vuexStore.isTestNet)switch(console.log(1),e){case"0x65096f2B7A8dc1592479F1911cd2B98dae4d2218":t="TNC";break;case"ETH":t="ETH";break;default:t=Error}else switch(e){case"0x65096f2B7A8dc1592479F1911cd2B98dae4d2218":t="TNC";break;case"ETH":t="0x602c79718b16e442de58778e148d0b1084e3b2dffd5de6b7b16cee7969282de7";break;default:t=Error}return console.log(t),t},AssetType2AssetContractAddress(e){let t="";if(this.$store.state.vuexStore.isTestNet)switch(e){case"TNC":t=this.$store.state.vuexStore.tncContractAddress;break;case"ETH":t="0x602c79718b16e442de58778e148d0b1084e3b2dffd5de6b7b16cee7969282de7";break;default:t=Error}else switch(e){case"TNC":t="08e8c4400f1af2c20c28e0018f29535eb85d15b6";break;case"ETH":t="0x602c79718b16e442de58778e148d0b1084e3b2dffd5de6b7b16cee7969282de7";break;default:t=Error}return t},getChannelSerial(e,t,n){let a;return this.$store.state.vuexStore.channelList.forEach(function(s,o){if(s[e]===t){if(null==n)return void(a=o);if("open"==n){if(3==s.State&&1==s.isConnect)return void(a=o);a=-2}}else a=-1}),a},cycleGetTransactionReceipt(e){let t=this;setTimeout(function(){web3.eth.getTransactionReceipt(e).then(function(n){return null==n?t.cycleGetTransactionReceipt(e):(console.log(n),1==n.status?(t.$notify({title:"成功",dangerouslyUseHTMLString:!0,message:"交易已确认",duration:3e3,type:"success"}),n):0==n.status?(t.$notify({title:"失败",dangerouslyUseHTMLString:!0,message:"交易确认失败",duration:3e3,type:"error"}),n):void 0)})},4e3)},nodeUriWebsocketOnMessage(e){let t=this;if("connected to server"===e.data)t.$notify.closeAll(),t.$notify({title:"成功",dangerouslyUseHTMLString:!0,message:"已连接到Trinity网络",duration:3e3,type:"success"});else{let n=JSON.parse(e.data),a=n.messageType;switch(console.log(n),a){case"monitorDeposit":t.OnMesMonitorDeposit(n);break;case"monitorQuickCloseChannel":t.OnMesMonitorQuickCloseChannel(n)}}},OnMesMonitorDeposit(e){console.log(e);let t=this,n=t.getChannelSerial("ChannelName",e.channelId);if(console.log(n),null!==n){if(console.log(e.amount),console.log(t.$store.state.vuexStore.channelList[n].SelfBalance+t.$store.state.vuexStore.channelList[n].OtherBalance),e.amount==t.$store.state.vuexStore.channelList[n].SelfBalance+t.$store.state.vuexStore.channelList[n].OtherBalance){t.$notify({title:"成功",dangerouslyUseHTMLString:!0,message:"通道已开通",duration:3e3,type:"success"});let e=t.$store.state.vuexStore.channelList[n];console.log(e),e.State=3,console.log(e),s.a.set(t.$store.state.vuexStore.channelList,n,e),console.log(t.$store.state.vuexStore.channelList[n]),t.StoreChannel()}}else t.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"未找到该通道,请重试一次",duration:3e3})},OnMesMonitorQuickCloseChannel(e){let t=this,n=t.getChannelSerial("ChannelName",e.channelId);console.log(n),null!==n?(console.log(e.amountA),console.log(e.amountB),console.log(t.$store.state.vuexStore.channelList[n].SelfBalance),console.log(t.$store.state.vuexStore.channelList[n].OtherBalance),e.amountA==t.$store.state.vuexStore.channelList[n].SelfBalance&&e.amountB==t.$store.state.vuexStore.channelList[n].OtherBalance&&(t.$notify({title:"成功",dangerouslyUseHTMLString:!0,message:"通道已关闭",duration:3e3,type:"success"}),t.$store.state.vuexStore.channelList.splice(n,1),t.StoreChannel())):t.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"未找到该通道,请重试一次",duration:3e3})},nodeUriWebsocketClose(e){console.log("已断开websocket"),console.log(e),this.$notify({title:"警告",dangerouslyUseHTMLString:!0,message:"与Trinity网络断开连接,点击进行重连",duration:0,type:"error",onClick:this.connectWebSocketForNodeUri})},websocketOnmessage(e){let t=this,n=JSON.parse(e.data),a=n.MessageType;switch(console.log(n),a){case"Founder":t.OnMesFounder(n);break;case"FounderSign":t.OnMesFounderSign(n);break;case"Rsmc":t.OnMesRsmc(n);break;case"RsmcSign":t.OnMesRsmcSign(n);break;case"AckRouterInfo":t.OnMesAckRouterInfo(n);break;case"Htlc":t.OnMesHtlc(n);break;case"HtlcSign":t.OnMesHtlcSign(n);break;case"RResponse":t.OnMesRResponse(n);break;case"SettleSign":t.OnMesSettleSign(n);break;case"UpdateChannel":t.OnMesUpdateChannel(n);break;case"DeleteChannel":t.OnMesDeleteChannel(n);break;case"Settle":t.OnMesSettle(n);break;case"ChannelInfo":t.OnMesChannelInfo(n);break;case"SyncBlock":console.log(1)}},OnMesFounder:function(e){var t=this;let n=t.getChannelSerial("ChannelName",e.ChannelName),a=e.MessageBody,s=t.$parent.decryptPrivateKey(t.$store.state.vuexStore.walletInfo.keyStore,t.addChannelForm.keyStorePass);t.$store.state.vuexStore.FoundertxDataSign=signData(a.Founder.txData,s);let o=signData(a.Commitment.txData,s),r=signData(a.RevocableDelivery.txData,s),i={MessageType:"FounderSign",Sender:e.Receiver,Receiver:e.Sender,ChannelName:e.ChannelName,TxNonce:e.TxNonce,MessageBody:{Founder:{txDataSign:t.$store.state.vuexStore.FoundertxDataSign,originalData:a.Founder},Commitment:{txDataSign:o,originalData:a.Commitment},RevocableDelivery:{txDataSign:r,originalData:a.RevocableDelivery},AssetType:e.MessageBody.AssetType,Deposit:e.MessageBody.Deposit,RoleIndex:e.MessageBody.RoleIndex}};t.websock[n].data.send(JSON.stringify(i));t.uri2Ip(e.Sender,20556);axios({method:"post",url:t.RpcUrl,headers:{"Content-Type":"application/json;charset=UTF-8"},data:JSON.stringify({jsonrpc:"2.0",method:"FunderTransaction",params:[e.Sender.split("@")[0],e.Receiver.split("@")[0],a.Founder.addressFunding,a.Founder.scriptFunding,e.MessageBody.Deposit,e.MessageBody.Deposit,a.Founder.txId,e.MessageBody.AssetType],id:1})}).then(function(s){console.log(s.data);var o={MessageType:"Founder",Sender:e.Receiver,Receiver:e.Sender,TxNonce:e.TxNonce,ChannelName:e.ChannelName,MessageBody:{Founder:a.Founder,Commitment:s.data.result.C_TX,RevocableDelivery:s.data.result.R_TX,AssetType:e.MessageBody.AssetType,Deposit:e.MessageBody.Deposit,RoleIndex:e.MessageBody.RoleIndex+1}};t.$store.state.vuexStore.channelList.websock[n].data.send(JSON.stringify(o))}),a.ChannelName=e.ChannelName,t.TxList.push(a),t.StoreFounder()},OnMesFounderSign:function(e){var t=this;"RESPONSE_OK"==e.Status?web3.eth.getGasPrice().then(function(n){console.log(n);new web3.eth.Contract(t.$store.state.vuexStore.trinityContractAbi,t.$store.state.vuexStore.trinityContractAddress,{from:t.$store.state.vuexStore.walletInfo.address,gasPrice:10*n});let a=t.decryptPrivateKey(t.$store.state.vuexStore.walletInfo.keyStore,t.$store.state.vuexStore.addChannelInfo.keyStorePass);web3.eth.getTransactionCount(t.$store.state.vuexStore.walletInfo.address,web3.eth.defaultBlock.pending).then(function(s){let o=web3.eth.abi.encodeFunctionSignature("deposit(bytes32,uint256,address,uint256,address,uint256,bytes,bytes)");console.log(o),console.log(t.$store.state.vuexStore.addChannelInfo.channelName),console.log("0"),console.log(t.$store.state.vuexStore.walletInfo.address),console.log(1e8*t.$store.state.vuexStore.addChannelInfo.selfDeposit),console.log(t.$store.state.vuexStore.addChannelInfo.uri.split("@")[0]),console.log(1e8*t.$store.state.vuexStore.addChannelInfo.otherDeposit),console.log(t.$store.state.vuexStore.addChannelInfo.selfSignedData),console.log(e.MessageBody.Commitment);let r=web3.eth.abi.encodeParameters(["bytes32","uint256","address","uint256","address","uint256","bytes","bytes"],[t.$store.state.vuexStore.addChannelInfo.channelName,"0",t.$store.state.vuexStore.walletInfo.address,1e8*t.$store.state.vuexStore.addChannelInfo.selfDeposit,t.$store.state.vuexStore.addChannelInfo.uri.split("@")[0],1e8*t.$store.state.vuexStore.addChannelInfo.otherDeposit,t.$store.state.vuexStore.addChannelInfo.selfSignedData,e.MessageBody.Commitment]);console.log(r);var i={nonce:web3.utils.toHex(s++),gasPrice:web3.utils.toHex(10*n),gasLimit:web3.utils.toHex(45e5),to:t.$store.state.vuexStore.trinityContractAddress,from:t.$store.state.vuexStore.walletInfo.address,value:"0x00",data:o+r.substr(2)};console.log(i);let l=signData(i,a.privateKey);console.log(l),web3.eth.sendSignedTransaction("0x"+l).on("transactionHash",function(e){console.log(e),t.$notify({title:"成功",dangerouslyUseHTMLString:!0,message:"上链成功，请交易确认",duration:3e3,type:"success"})}).on("receipt",function(e){console.log(e),t.$notify({title:"成功",dangerouslyUseHTMLString:!0,message:"交易已确认",duration:3e3,type:"success"})}).on("confirmation",function(e,t){if("0x0"==t.status)return!1}).on("error",function(e){t.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"交易确认失败",duration:0});let n=t.getChannelSerial("ChannelName",t.$store.state.vuexStore.addChannelInfo.channelName);return t.$store.state.vuexStore.channelList.splice(n,1),t.StoreChannel(),!1})});let s={messageType:"monitorDeposit",walletAddress:t.$store.state.vuexStore.walletInfo.address,chainType:e.MessageBody.AssetType,playload:e.ChannelName,comments:""};t.$store.state.vuexStore.NodeUriWebSocket.send(JSON.stringify(s))}):console.log("Status异常")},OnMesRsmc:function(e){let t=this.$parent.getChannelSerial("ChannelName",e.ChannelName,"open");return-1==t?(this.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"未与该Uri建立通道",duration:0}),!1):-2==t?(this.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"该通道未Open或者未连接上websocket",duration:0}),!1):(this.activeInfo.redata=e,void this.$notify.info({title:"消息",duration:0,message:this.$store.state.vuexStore.channelList[t].Alice+"通道有收款消息,需要你解锁钱包.<br/>点击进行解锁",onClick:this.showReceiptRsmcInfoBox}))},showReceiptRsmcInfoBox(){this.isReceiptRsmcInfoBox=!0},RsmcSign(){let e=this;e.$refs.activeInfo.validate(t=>{if(!t)return console.log("error submit!!"),!1;{let t=e.getChannelSerial("ChannelName",e.activeInfo.redata.ChannelName,"open"),n=web3.utils.soliditySha3({t:"bytes32",v:e.$store.state.vuexStore.channelList[t].ChannelName},{t:"uint256",v:e.$store.state.vuexStore.channelList[t].TxNonce},{t:"address",v:e.$store.state.vuexStore.channelList[0].OtherUri.split("@")[0]},{t:"uint256",v:e.$store.state.vuexStore.channelList[0].OtherBalance-1e8*e.activeInfo.redata.PaymentCount},{t:"address",v:e.$store.state.vuexStore.walletInfo.address},{t:"uint256",v:e.$store.state.vuexStore.channelList[0].SelfBalance+1e8*e.activeInfo.redata.PaymentCount});console.log(n);let a,s=e.decryptPrivateKey(e.$store.state.vuexStore.walletInfo.keyStore,e.activeInfo.keyStorePass),o=ecSign(n,s.privateKey);if(console.log(o),e.activeInfo.redata.SenderBalance==e.$store.state.vuexStore.channelList[t].SelfBalance&&e.activeInfo.redata.ReceiverBalance==e.$store.state.vuexStore.channelList[t].OtherBalance){e.activeInfo.redata.Receiver,e.activeInfo.redata.Sender,e.$store.state.vuexStore.channelList[t].TxNonce,e.activeInfo.redata.ChannelName,e.$store.state.vuexStore.NetMagic,e.$store.state.vuexStore.channelList[t].assetType,e.activeInfo.redata.PaymentCount,e.$store.state.vuexStore.channelList[t].SelfBalance,e.$store.state.vuexStore.channelList[t].OtherBalance}}})},OnMesRsmcSign:function(e){let t=this;if("RESPONSE_OK"==e.Status){let n=t.getChannelSerial("ChannelName",e.ChannelName);if(console.log(n),null===n)return void t.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"未找到该通道更新状态",duration:3e3});{let a=t.$store.state.vuexStore.channelList[n];a.SelfBalance-=1e8*e.MessageBody.PaymentCount,a.OtherBalance+=1e8*e.MessageBody.PaymentCount,a.TxNonce+=1,s.a.set(t.$store.state.vuexStore.channelList,n,a),console.log(t.$store.state.vuexStore.channelList[n]),t.StoreChannel(),t.$notify({title:"成功",dangerouslyUseHTMLString:!0,message:"转账确认",duration:3e3,type:"success"})}}else t.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:e.Status,duration:3e3})},OnMesAckRouterInfo:function(e){if(null===e.RouterInfo)return swal({title:"Info",text:"There is no channel available for transfer.",type:"error",showCancelButton:!1}),this.PaymentLink="",!1;{let n=this,a=e.RouterInfo.FullPath;8766==n.TxOnChannelInfo.ReceiverUrl.split(":")[1]&&(a.unshift([n.TxOnChannelInfo.SendUrl,0]),a.push([n.TxOnChannelInfo.ReceiverUrl,0]));let s,o,r,i=a.length-1,l=a[i][0],c=(n.UriToIp(l,20556),n.UriToIp(e.RouterInfo.Next,8766));n.AssetTypeToAssetId(n.TxOnChannelInfo.AssetType);n.ChannelItems.forEach(function(t,n){t.Url===e.RouterInfo.Next&&(s=t.Balance,o=t.Balance2,r=t.ChannelName)});let d,u=[];n.TxList.forEach(function(e,t){e.ChannelName===r&&u.push(e.Founder)}),n.websock.forEach(function(e,t){if(e.ChannelName===r)return d=t,!1});let p=0;for(var t=0;t<i;t++)p+=e.RouterInfo.FullPath[t][1];p=1e4*parseFloat(p).toFixed(8),this.TxOnChannelInfo.Fee=p/1e4;let h=u.length-1,m=u[h].addressFunding,y=u[h].scriptFunding;swal({title:"Attention!",text:"You will pay "+p/1e4+n.TxOnChannelInfo.AssetType+" as route fee.",type:"info",showCancelButton:!0,closeOnConfirm:!0},function(){axios({method:"post",url:n.RpcUrl,headers:{"Content-Type":"application/json;charset=UTF-8"},data:JSON.stringify({jsonrpc:"2.0",method:"HTLCTransaction",params:[n.WalletInfo.PublicKey,n.TxOnChannelInfo.ReceiverUrl.split("@")[0],(n.TxOnChannelInfo.Value+p)/1e4,s,o,n.TxOnChannelInfo.Hr,m,y,n.TxOnChannelInfo.AssetType],id:1})}).then(function(t){let s=0;n.TxNonceList.forEach(function(e,t){e.ChannelName===r&&(s=e.TxNonce)});let o={MessageType:"Htlc",Sender:n.WalletInfo.PublicKey+"@"+c,Receiver:e.RouterInfo.Next,TxNonce:s+1,ChannelName:r,Router:a,Next:e.RouterInfo.Next,MessageBody:{HCTX:t.data.result.HCTX,RDTX:t.data.result.RDTX,HEDTX:t.data.result.HEDTX,HTTX:t.data.result.HTTX,HTDTX:t.data.result.HTDTX,HTRDTX:t.data.result.HTRDTX,RoleIndex:0,Comments:"",Count:(n.TxOnChannelInfo.Value+p)/1e4,AssetType:n.TxOnChannelInfo.AssetType,HashR:n.TxOnChannelInfo.Hr}};n.websock[d].data.send(JSON.stringify(o)),n.PaymentLink="",setTimeout(function(){!1===n.HtlcFlag&&swal({title:"transaction failed.",type:"error",showCancelButton:!1})},3e3)})})}},OnMesHtlc:function(e){let t=this.$parent.getChannelSerial("ChannelName",e.ChannelName,"open");return-1==t?(this.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"未与该Uri建立通道",duration:0}),!1):-2==t?(this.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"该通道未Open或者未连接上websocket",duration:0}),!1):(this.activeInfo.redata=e,void this.$notify.info({title:"消息",duration:0,message:this.$store.state.vuexStore.channelList[t].Alice+"通道有收款消息,需要你解锁钱包.<br/>点击进行解锁",onClick:this.showReceiptInfoBox}))},showReceiptHtlcInfoBox(){this.isReceiptInfoBox=!0},HtlcSign(){let e=this;e.$refs.activeInfo.validate(t=>{if(!t)return console.log("error submit!!"),!1;{let t=e.getChannelSerial("ChannelName",e.activeInfo.redata.ChannelName,"open"),n=web3.utils.soliditySha3({t:"bytes32",v:e.$store.state.vuexStore.channelList[t].ChannelName},{t:"uint256",v:e.$store.state.vuexStore.channelList[t].TxNonce},{t:"address",v:e.$store.state.vuexStore.channelList[0].OtherUri.split("@")[0]},{t:"uint256",v:e.$store.state.vuexStore.channelList[0].OtherBalance-1e8*e.activeInfo.redata.PaymentCount},{t:"address",v:e.$store.state.vuexStore.walletInfo.address},{t:"uint256",v:e.$store.state.vuexStore.channelList[0].SelfBalance+1e8*e.activeInfo.redata.PaymentCount});console.log(n);let a,s=e.decryptPrivateKey(e.$store.state.vuexStore.walletInfo.keyStore,e.activeInfo.keyStorePass),o=ecSign(n,s.privateKey);if(console.log(o),e.activeInfo.redata.SenderBalance==e.$store.state.vuexStore.channelList[t].SelfBalance&&e.activeInfo.redata.ReceiverBalance==e.$store.state.vuexStore.channelList[t].OtherBalance){e.activeInfo.redata.Receiver,e.activeInfo.redata.Sender,e.$store.state.vuexStore.channelList[t].TxNonce,e.activeInfo.redata.ChannelName,e.$store.state.vuexStore.NetMagic,e.$store.state.vuexStore.channelList[t].assetType,e.activeInfo.redata.PaymentCount,e.$store.state.vuexStore.channelList[t].SelfBalance,e.$store.state.vuexStore.channelList[t].OtherBalance}}})},OnMesHtlcSign:function(e){let t,n=this,a=e.MessageBody;if(n.websock.forEach(function(n,a){if(n.ChannelName===e.ChannelName)return t=a,!1}),n.TxNonceList.forEach(function(t,n){t.ChannelName===e.ChannelName&&t.TxNonce++}),1===a.RoleIndex){let s="";console.log("HashR:"+e.MessageBody.HashR),n.RList.forEach(function(e,t){e.Hr===a.HashR&&(console.log(e.Hr),s=e.R)});let o={MessageType:"RResponse",Sender:e.Receiver,Receiver:e.Sender,TxNonce:e.TxNonce,ChannelName:e.ChannelName,Router:e.RouterInfo,Next:e.Next,MessageBody:{RoleIndex:0,Comments:"",Count:e.MessageBody.Count,AssetType:e.MessageBody.AssetType,R:s,HR:e.MessageBody.HashR}};n.websock[t].data.send(JSON.stringify(o))}},OnMesRResponse:function(e){var t=this;if(hex_sha1(e.MessageBody.R)===e.MessageBody.HR){let n,a;t.ChannelItems.forEach(function(t,s){t.ChannelName===e.ChannelName&&(n=t.Balance,a=t.Balance2)});let s,o=[];t.TxList.forEach(function(t,n){t.ChannelName===e.ChannelName&&o.push(t.Founder)}),t.websock.forEach(function(t,n){if(t.ChannelName===e.ChannelName)return s=n,!1});let r=o.length-1,i=o[r].txId,l=o[r].addressFunding,c=o[r].scriptFunding;t.UriToIp(t.TxOnChannelInfo.ReceiverUrl,20556);axios({method:"post",url:t.RpcUrl,headers:{"Content-Type":"application/json;charset=UTF-8"},data:JSON.stringify({jsonrpc:"2.0",method:"FunderTransaction",params:[e.Sender.split("@")[0],t.WalletInfo.PublicKey,l,c,a,n,i,e.MessageBody.AssetType],id:1})}).then(function(n){console.log(n);let a,o={MessageType:"Rsmc",Sender:e.Receiver,Receiver:e.Sender,TxNonce:e.TxNonce+1,ChannelName:e.ChannelName,MessageBody:{Commitment:n.data.result.C_TX,RevocableDelivery:n.data.result.R_TX,AssetType:t.TxOnChannelInfo.AssetType,Value:e.MessageBody.Count,RoleIndex:0,Comments:t.TxOnChannelInfo.Hr}};t.websock[s].data.send(JSON.stringify(o)),console.log(JSON.stringify(o)),t.BreachRemedy=n.data.result.BR_TX,t.ChannelItems.forEach(function(t,n){t.ChannelName===e.ChannelName&&(a=t.Name)});let r={Address:a,Amount:t.TxOnChannelInfo.Value/1e4,AssetType:t.TxOnChannelInfo.AssetType,Fee:t.TxOnChannelInfo.Fee,Flag:!1,isTestNet:t.isTestNet,Date:(new Date).getTime()};t.RecordList.push(r),t.StoreRecordList(t.RecordList)})}},OnMesSettleSign:function(e){var t=this;"RESPONSE_OK"==e.Status?web3.eth.getGasPrice().then(function(n){console.log(n);new web3.eth.Contract(t.$store.state.vuexStore.trinityContractAbi,t.$store.state.vuexStore.trinityContractAddress,{from:t.$store.state.vuexStore.walletInfo.address,gasPrice:10*n});web3.eth.getTransactionCount(t.$store.state.vuexStore.walletInfo.address,web3.eth.defaultBlock.pending).then(function(a){console.log(a);let s=web3.eth.abi.encodeFunctionSignature("quickCloseChannel(bytes32,uint256,address,uint256,address,uint256,bytes,bytes)");console.log(s);let o=web3.eth.abi.encodeParameters(["bytes32","uint256","address","uint256","address","uint256","bytes","bytes"],[t.$store.state.vuexStore.closeChannelInfo.ChannelName,4294967295,t.$store.state.vuexStore.walletInfo.address,t.$store.state.vuexStore.closeChannelInfo.SelfBalance,t.$store.state.vuexStore.closeChannelInfo.OtherUri.split("@")[0],t.$store.state.vuexStore.closeChannelInfo.OtherBalance,t.$store.state.vuexStore.closeChannelInfo.selfSignedData,e.MessageBody.Commitment]);console.log(o);var r={nonce:web3.utils.toHex(a++),gasPrice:web3.utils.toHex(10*n),gasLimit:web3.utils.toHex(45e5),to:t.$store.state.vuexStore.trinityContractAddress,from:t.$store.state.vuexStore.walletInfo.address,value:"0x00",data:s+o.substr(2)};console.log(r);let i=t.decryptPrivateKey(t.$store.state.vuexStore.walletInfo.keyStore,t.$store.state.vuexStore.closeChannelInfo.keyStorePass),l=signData(r,i.privateKey);console.log(l),web3.eth.sendSignedTransaction("0x"+l,function(e,n){e?_console.log(e):(console.log(n),t.$notify({title:"成功",dangerouslyUseHTMLString:!0,message:"上链成功，请交易确认",duration:3e3,type:"success"}),t.cycleGetTransactionReceipt(n))});let c={messageType:"monitorQuickCloseChannel",walletAddress:t.$store.state.vuexStore.walletInfo.address,chainType:e.MessageBody.AssetType,playload:e.ChannelName,comments:""};t.$store.state.vuexStore.NodeUriWebSocket.send(JSON.stringify(c))})}):console.log("Status异常")},OnMesUpdateChannel:function(e){var t=this;let n="",a="";e.MessageBody.Founder.split("@")[0]===t.WalletInfo.PublicKey?(n=e.MessageBody.Founder,a=e.MessageBody.Receiver):(n=e.MessageBody.Receiver,a=e.MessageBody.Founder);var s=e.MessageBody.Balance[n].TNC;s=parseFloat(s);var o=e.MessageBody.Balance[a].TNC;o=parseFloat(o),t.ChannelItems.forEach(function(n,a){n.ChannelName===e.MessageBody.ChannelName&&(n.Balance=s,n.Balance2=o,n.BalanceInfo=e.MessageBody.Balance,swal({title:"Info",text:"Channel balance updated.",type:"info",showCancelButton:!1}),Bus.$emit("ClosePaymentCodeBox"),t.GetAssetsBalance())})},OnMesDeleteChannel:function(e){let t=this;t.ChannelItems.forEach(function(n,a){if(n.ChannelName===e.MessageBody.ChannelName){let e={Address:n.Name,Amount:n.Balance,AssetType:n.AssetType,Fee:0,Flag:!1,isTestNet:t.isTestNet,Date:(new Date).getTime()};t.ChannelItems.splice(a,1),t.RecordList.push(e),t.StoreRecordList(t.RecordList)}}),t.websock.forEach(function(n,a){n.ChannelName!==e.MessageBody.ChannelName||t.websock.splice(a,1)})},OnMesSettle:function(e){let t,n=signatureData(MessageBody.Settlement.txData,this.WalletInfo.PrivateKey);if(this.websock.forEach(function(n,a){if(n.ChannelName===e.ChannelName){if(4===n.Flag)return t=a,!1;swal({title:"This channel is not open.",type:"info",showCancelButton:!1})}}),!t)return swal({title:"This channel is not open.",type:"info",showCancelButton:!1}),!1;let a={MessageType:"SettleSign",Sender:e.Receiver,Receiver:e.Sender,TxNonce:e.TxNonce,ChannelName:e.ChannelName,MessageBody:{Settlement:{originalData:e.MessageBody.Settlement,txDataSign:n},Balance:e.MessageBody.Balance}};this.websock[t].data.send(JSON.stringify(a))},OnMesChannelInfo:function(e){let t=this;for(var n=0;n<e.Peers.length;n++)t.ChannelItems.forEach(function(t,a){t.Url.split("@")[0]===e.Peers[n]&&(t.Flag=4,t.oldFlag=5)})},websocketClose(e){console.log("已断开websocket");let t=this,n=e.currentTarget.url.split("/")[2].split(":")[0];console.log(n);let a=t.getChannelSerial("Ip",n);console.log(a),null!==a?(t.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"与"+n+"断开连接",duration:3e3}),t.$store.state.vuexStore.channelList[a].isConnect=!1):t.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"未找到该通道,请重试一次",duration:3e3})},reconnectWebsocket(e,t){let n=this;const a="ws://"+e+"/";var s=n.getChannelSerial("ChannelName",t);console.log(s),null!==s?(console.log(1),n.$store.state.vuexStore.channelList[s].websock=new WebSocket(a),n.$store.state.vuexStore.channelList[s].websock.onmessage=n.websocketOnmessage,n.$store.state.vuexStore.channelList[s].websock.onclose=n.websocketClose,n.$store.state.vuexStore.channelList[s].isConnect=!0,console.log(n.$store.state.vuexStore.channelList)):n.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"未找到该通道,请重试一次",duration:3e3})},StoreChannel(){console.log(this.$store.state.vuexStore.channelList),this.saveAsArray(this.$store.state.vuexStore.walletInfo.address+"@channelList",this.$store.state.vuexStore.channelList)}}},g={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"clearfloat appBox",attrs:{id:"app",mode:"in-out"}},[n("div",{staticStyle:{position:"relative",margin:"0 auto",width:"100%","max-width":"1400px",height:"100%"}},[n("div",{staticClass:"rightBox",class:{fullPage:!e.$store.state.vuexStore.isNavShow}},[n("head-box"),e._v(" "),n("router-view"),e._v(" "),n("message-box"),e._v(" "),n("footer-box")],1),e._v(" "),n("head-nav"),e._v(" "),n("el-dialog",{staticClass:"receiptInfoBox",attrs:{title:"收款",visible:e.isReceiptRsmcInfoBox,width:"30%",center:"","modal-append-to-body":!1},on:{"update:visible":function(t){e.isReceiptRsmcInfoBox=t}}},[n("span",[e._v(e._s(e.activeInfo.redata.Sender)+"向你转账")]),e._v(" "),n("span",{staticStyle:{color:"#F56C6C"}},[e._v(e._s(e.activeInfo.redata.PaymentCount)+" "+e._s(e.activeInfo.redata.AssetType))]),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-form",{ref:"activeInfo",staticClass:"demo-ruleForm",attrs:{model:e.activeInfo,"status-icon":"",rules:e.confirmReceiptRules,"label-width":"80px"}},[n("el-form-item",{attrs:{label:"密码",prop:"keyStorePass"}},[n("el-input",{attrs:{placeholder:"在此输入密码",type:"password","auto-complete":"off"},model:{value:e.activeInfo.keyStorePass,callback:function(t){e.$set(e.activeInfo,"keyStorePass",t)},expression:"activeInfo.keyStorePass"}})],1),e._v(" "),n("el-form-item",{staticStyle:{"text-align":"center","margin-left":"-80px"}},[n("el-button",{attrs:{type:"danger"},on:{click:function(t){e.RsmcSign()}}},[e._v(" 确定 ")]),e._v(" "),n("el-button",{on:{click:function(t){e.isReceiptRsmcInfoBox=!1}}},[e._v(" 取消 ")])],1)],1)],1)]),e._v(" "),n("el-dialog",{staticClass:"receiptInfoBox",attrs:{title:"收款",visible:e.isReceiptHtlcInfoBox,width:"30%",center:"","modal-append-to-body":!1},on:{"update:visible":function(t){e.isReceiptHtlcInfoBox=t}}},[n("span",[e._v(e._s(e.activeInfo.redata.Sender)+"向你转账")]),e._v(" "),n("span",{staticStyle:{color:"#F56C6C"}},[e._v(e._s(e.activeInfo.redata.PaymentCount)+" "+e._s(e.activeInfo.redata.AssetType))]),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-form",{ref:"activeInfo",staticClass:"demo-ruleForm",attrs:{model:e.activeInfo,"status-icon":"",rules:e.confirmReceiptRules,"label-width":"80px"}},[n("el-form-item",{attrs:{label:"密码",prop:"keyStorePass"}},[n("el-input",{attrs:{placeholder:"在此输入密码",type:"password","auto-complete":"off"},model:{value:e.activeInfo.keyStorePass,callback:function(t){e.$set(e.activeInfo,"keyStorePass",t)},expression:"activeInfo.keyStorePass"}})],1),e._v(" "),n("el-form-item",{staticStyle:{"text-align":"center","margin-left":"-80px"}},[n("el-button",{attrs:{type:"danger"},on:{click:function(t){e.HtlcSign()}}},[e._v(" 确定 ")]),e._v(" "),n("el-button",{on:{click:function(t){e.isReceiptHtlcInfoBox=!1}}},[e._v(" 取消 ")])],1)],1)],1)])],1)])},staticRenderFns:[]};var x=n("VU/8")(f,g,!1,function(e){n("2QOi")},null,null).exports,S=n("/ocq"),C={name:"indexForm",data(){var e=(e,t,n)=>{if(!t)return n(new Error("钱包密码不能为空，否则将无法交易"));{let e=this.$parent.decryptPrivateKey(this.$store.state.vuexStore.walletInfo.keyStore,t);setTimeout(()=>{if(!e)return n(new Error("钱包解锁失败 - 可能是密码错误"));n()},2e3)}};return{isShowMoreAsset:!1,paymentCode:"",txOnChainInfo:{address:"",assetType:"",amount:"",keyStorePass:""},txOnChainRules:{address:[{validator:(e,t,n)=>{if(!t)return n(new Error("地址不能为空"));42!==t.length?n(new Error("请输入正确的地址")):n()},trigger:"blur"}],amount:[{validator:(e,t,n)=>{if(!t)return n(new Error("金额不能为空"));isNaN(t)?n(new Error("请输入数字值")):t<0?n(new Error("金额必须大于0")):n()},trigger:"blur"}],assetType:[{validator:(e,t,n)=>{if(!t)return n(new Error("资产类型不能为空"));n()},trigger:"change"}],keyStorePass:[{validator:e,trigger:"blur"}]},txOnChannelInfo:{sendUri:"",receiverUri:"",hr:"",assetType:"",value:0,fee:0,description:"",keyStorePass:""},txOnChannelRules:{keyStorePass:[{validator:e,trigger:"blur"}]},ShowTxOnChainBox:!1,ShowTxOnChannelBox:!1,contact:""}},mounted(){this.$nextTick(function(){this.$route.params.address&&(this.paymentCode=this.$route.params.address)})},watch:{},methods:{showMoreAsset(){this.isShowMoreAsset=!this.isShowMoreAsset},decryptPaymentCode(){let e=this;if(""!=e.paymentCode.length)return 42===e.paymentCode.length?e.paymentCode===e.$store.state.vuexStore.walletInfo.address?void e.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"收付款地址不能相同",duration:3e3}):(e.txOnChainInfo.address=e.paymentCode,void(e.ShowTxOnChainBox=!0)):void("TN"==e.paymentCode.substr(0,2)?(console.log("进入通道交易"),e.txOnChannel()):this.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"付款码错误，请确认",duration:3e3}));e.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"付款码/地址不能为空",duration:3e3})},contactChange(){this.paymentCode=this.contact},txOnChain(){let e=this;e.$refs.txOnChainInfo.validate(t=>{if(!t)return console.log("error submit!!"),!1;"ETH"==e.txOnChainInfo.assetType?e.txEthOnChain():e.txTncOnChain()})},txEthOnChain(){let e=this,t=e.$parent.decryptPrivateKey(e.$store.state.vuexStore.walletInfo.keyStore,e.txOnChainInfo.keyStorePass);web3.eth.getTransactionCount(e.$store.state.vuexStore.walletInfo.address,web3.eth.defaultBlock.pending).then(function(n){console.log(n),web3.eth.getGasPrice().then(function(a){console.log(a);var s={nonce:web3.utils.toHex(n++),gasLimit:web3.utils.toHex(45e5),gasPrice:web3.utils.toHex(a),to:e.txOnChainInfo.address,from:e.$store.state.vuexStore.walletInfo.address,value:web3.utils.toHex(1e18*e.txOnChainInfo.amount),data:""};console.log(s);let o=signData(s,t.privateKey);console.log(o),web3.eth.sendSignedTransaction("0x"+o,function(t,n){t?_console.log(t):(console.log(n),e.$notify({title:"成功",dangerouslyUseHTMLString:!0,message:"上链成功，请交易确认",duration:3e3,type:"success"}),e.ShowTxOnChainBox=!1,e.clearTxData(),e.$parent.cycleGetTransactionReceipt(n))})})})},txTncOnChain(){let e=this,t=e.$parent.decryptPrivateKey(e.$store.state.vuexStore.walletInfo.keyStore,e.txOnChainInfo.keyStorePass);web3.eth.getTransactionCount(e.$store.state.vuexStore.walletInfo.address,web3.eth.defaultBlock.pending).then(function(n){console.log(n),web3.eth.getGasPrice().then(function(a){console.log(a);var s=web3.utils.sha3("transfer(address,uint256)").substr(2,8);console.log(s);var o={nonce:web3.utils.toHex(n++),gasPrice:web3.utils.toHex(a),gasLimit:web3.utils.toHex(45e5),to:e.$store.state.vuexStore.tncContractAddress,from:e.$store.state.vuexStore.walletInfo.address,value:"0x00",data:"0x"+s+web3.utils.padLeft(e.txOnChainInfo.address.slice(2),64)+web3.utils.padLeft(web3.utils.toHex(1e8*e.txOnChainInfo.amount).substr(2),64)};console.log(o);let r=signData(o,t.privateKey);console.log(r),web3.eth.sendSignedTransaction("0x"+r,function(t,n){t?_console.log(t):(console.log(n),e.$notify({title:"成功",dangerouslyUseHTMLString:!0,message:"上链成功，请交易确认",duration:3e3,type:"success"}),e.ShowTxOnChainBox=!1,e.clearTxData(),e.$parent.cycleGetTransactionReceipt(n))})})})},txOnChannel(){let e,t=this;try{e=base58decode(t.paymentCode.substring(2)).toString()}catch(e){return t.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"付款码解析错误1",duration:3e3}),!1}if(console.log(e),!(e.indexOf("&")>-1))return t.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"付款码解析错误，请确认",duration:3e3}),!1;{let n=e.split("&");if(t.txOnChannelInfo.receiverUri=n[0],t.txOnChannelInfo.hr=n[1],t.txOnChannelInfo.assetType=t.$parent.assetContractAddress2AssetType(n[2]),t.txOnChannelInfo.value=1e8*n[3],t.txOnChannelInfo.description=n[4],console.log(t.txOnChannelInfo),!web3.utils.isAddress(t.txOnChannelInfo.receiverUri.split("@")[0]))return void t.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"付款码解析错误2",duration:3e3});if(""==t.txOnChannelInfo.hr)return void t.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"付款码解析错误3",duration:3e3});if(""==t.txOnChannelInfo.assetType)return void t.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"付款码解析错误4",duration:3e3});if(0==t.txOnChannelInfo.value)return void t.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"付款码解析错误5",duration:3e3});if(t.$store.state.vuexStore.walletInfo.address===t.txOnChannelInfo.receiverUri.split("@")[0])return void t.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"收付款地址不能相同",duration:3e3});"ETH"==t.txOnChannelInfo.assetType?t.txEthOnChannel():"TNC"==t.txOnChannelInfo.assetType&&t.txTncOnChannel()}},txEthOnChannel(){},txTncOnChannel:()=>(console.log("进入通道交易TNC"),!1),clearTxData(){this.txOnChainInfo={address:"",assetType:"",amount:"",keyStorePass:""},this.paymentCode=""}}},b={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"indexBox",class:{fullPage:!e.$store.state.vuexStore.isNavShow}},[n("div",{staticClass:"assetBox"},[n("h1",[e._v(e._s(e.$store.state.vuexStore.balanceData.Chain.TNC)+" TNC")]),e._v(" "),n("el-collapse-transition",[n("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowMoreAsset,expression:"isShowMoreAsset"}]},[n("table",{staticClass:"assetTable"},[n("thead",[n("tr",[n("th",[e._v("资产类型")]),e._v(" "),n("th",[e._v("链上金额")]),e._v(" "),n("th",[e._v("通道金额")])])]),e._v(" "),n("tbody",[n("tr",[n("td",[e._v("TNC")]),e._v(" "),n("td",[e._v(e._s(e.$store.state.vuexStore.balanceData.Chain.TNC))]),e._v(" "),n("td",[e._v(e._s(e.$store.state.vuexStore.balanceData.Channel.TNC))])]),e._v(" "),n("tr",[n("td",[e._v("ETH")]),e._v(" "),n("td",[e._v(e._s(e.$store.state.vuexStore.balanceData.Chain.ETH))]),e._v(" "),n("td",[e._v(e._s(e.$store.state.vuexStore.balanceData.Channel.ETH))])])])])])]),e._v(" "),n("el-button",{staticClass:"showMoreAssetBtn",class:{showMoreAssetBtn_active:e.isShowMoreAsset},attrs:{type:"primary",icon:"el-icon-arrow-down",circle:""},on:{click:function(t){e.showMoreAsset()}}})],1),e._v(" "),n("div",{staticClass:"contentBox"},[n("h2",[e._v("转账")]),e._v(" "),n("hr",{staticStyle:{height:"2px",border:"none","border-top":"2px dotted #EBEEF5"}}),e._v(" "),n("el-form",{ref:"form",staticClass:"indexForm"},[n("label",[e._v("支付码/地址")]),e._v(" "),n("el-select",{staticStyle:{float:"right","margin-bottom":"12px"},attrs:{size:"mini",filterable:"",clearable:"",placeholder:"从联系人里转账"},on:{change:e.contactChange},model:{value:e.contact,callback:function(t){e.contact=t},expression:"contact"}},e._l(e.$store.state.vuexStore.contactList,function(t){return n("el-option",{key:t.address,attrs:{label:t.name,value:t.address}},[n("span",{staticStyle:{float:"left"}},[e._v(e._s(t.name))]),e._v(" "),n("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px",overflow:"hidden","margin-left":"20px",width:"175px","text-overflow":"ellipsis","white-space":"nowrap"}},[e._v(e._s(t.address))])])})),e._v(" "),n("el-form-item",{staticStyle:{"margin-top":"10px"}},[n("el-input",{attrs:{type:"textarea"},model:{value:e.paymentCode,callback:function(t){e.paymentCode=t},expression:"paymentCode"}})],1),e._v(" "),n("el-form-item",{staticStyle:{"text-align":"center"}},[n("el-button",{staticClass:"transferBtn",attrs:{type:"primary"},on:{click:e.decryptPaymentCode}},[e._v("转账")])],1)],1)],1),e._v(" "),n("el-dialog",{staticClass:"txOnChainBox",attrs:{title:"链上转账",visible:e.ShowTxOnChainBox,width:"30%",center:"","modal-append-to-body":!1},on:{"update:visible":function(t){e.ShowTxOnChainBox=t}}},[n("el-form",{ref:"txOnChainInfo",staticClass:"demo-ruleForm",attrs:{model:e.txOnChainInfo,"status-icon":"",rules:e.txOnChainRules,"label-width":"70px"}},[n("el-form-item",{attrs:{label:"地址",prop:"address"}},[n("el-input",{attrs:{readonly:"readonly","auto-complete":"off"},model:{value:e.txOnChainInfo.address,callback:function(t){e.$set(e.txOnChainInfo,"address",t)},expression:"txOnChainInfo.address"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"资产类型",prop:"assetType"}},[n("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择资产类型"},model:{value:e.txOnChainInfo.assetType,callback:function(t){e.$set(e.txOnChainInfo,"assetType",t)},expression:"txOnChainInfo.assetType"}},[n("el-option",{attrs:{label:"TNC",value:"TNC"}}),e._v(" "),n("el-option",{attrs:{label:"ETH",value:"ETH"}})],1)],1),e._v(" "),n("el-form-item",{attrs:{label:"金额",prop:"amount"}},[n("el-input",{attrs:{"auto-complete":"off"},model:{value:e.txOnChainInfo.amount,callback:function(t){e.$set(e.txOnChainInfo,"amount",e._n(t))},expression:"txOnChainInfo.amount"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"密码",prop:"keyStorePass"}},[n("el-input",{attrs:{type:"password","auto-complete":"off"},model:{value:e.txOnChainInfo.keyStorePass,callback:function(t){e.$set(e.txOnChainInfo,"keyStorePass",t)},expression:"txOnChainInfo.keyStorePass"}})],1)],1),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"primary"},on:{click:function(t){e.txOnChain()}}},[e._v("转账")]),e._v(" "),n("el-button",{on:{click:function(t){e.ShowTxOnChainBox=!1}}},[e._v("取 消")])],1)],1),e._v(" "),n("el-dialog",{staticClass:"txOnChannelBox",attrs:{title:"通道转账",visible:e.ShowTxOnChannelBox,width:"30%",center:"","modal-append-to-body":!1},on:{"update:visible":function(t){e.ShowTxOnChannelBox=t}}},[n("el-form",{ref:"txOnChannelInfo",staticClass:"demo-ruleForm",attrs:{model:e.txOnChannelInfo,"status-icon":"",rules:e.txOnChannelRules,"label-width":"70px"}},[n("el-form-item",{attrs:{label:"密码",prop:"keyStorePass"}},[n("el-input",{attrs:{type:"password","auto-complete":"off"},model:{value:e.txOnChannelInfo.keyStorePass,callback:function(t){e.$set(e.txOnChannelInfo,"keyStorePass",t)},expression:"txOnChannelInfo.keyStorePass"}})],1)],1),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"primary"},on:{click:function(t){e.txOnChannel()}}},[e._v("转账")]),e._v(" "),n("el-button",{on:{click:function(t){e.ShowTxOnChannelBox=!1}}},[e._v("取 消")])],1)],1)],1)},staticRenderFns:[]};var w=n("VU/8")(C,b,!1,function(e){n("pOFe")},"data-v-4142b506",null).exports,_={name:"startForm",data:()=>({}),methods:{toOtherForm(e){this.$router.push(e)}}},$={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"startForm"},[n("div",{staticClass:"contentBox"},[n("h2",[e._v("欢迎")]),e._v(" "),n("hr",{staticStyle:{height:"2px",border:"none","border-top":"2px dotted #EBEEF5"}}),e._v(" "),n("div",{staticClass:"clooseLoginBox clooseLoginBox-blue",on:{click:function(t){e.toOtherForm("./create")}}},[n("h3",[e._v("创建新钱包")]),e._v(" "),n("p",[e._v("从场景上说，MessageBox 的作用是美化系统自带的，因此适合展示较为简单的内容。如果需要弹出较为复杂的内容，请使用 Dialog。")])]),e._v(" "),n("div",{staticClass:"clooseLoginBox clooseLoginBox-green",on:{click:function(t){e.toOtherForm("./loginByPrivateKey")}}},[n("h3",[e._v("从私钥导入")]),e._v(" "),n("p",[e._v("从场景上说，MessageBox 的作用是美化系统自带的，因此适合展示较为简单的内容。如果需要弹出较为复杂的内容，请使用 Dialog。")])]),e._v(" "),n("div",{staticClass:"clooseLoginBox clooseLoginBox-gray",on:{click:function(t){e.toOtherForm("./loginByKeyStore")}}},[n("h3",[e._v("从备份文件恢复")]),e._v(" "),n("p",[e._v("从场景上说，MessageBox 的作用是美化系统自带的，因此适合展示较为简单的内容。如果需要弹出较为复杂的内容，请使用 Dialog。")])])])])},staticRenderFns:[]};var T=n("VU/8")(_,$,!1,function(e){n("GJJI")},"data-v-61204f9c",null).exports,I={name:"createForm",data(){return{createForm:{pass:"",checkPass:""},createRules:{pass:[{validator:(e,t,n)=>{""===t?n(new Error("请输入密码")):(""!==this.createForm.checkPass&&this.$refs.createForm.validateField("checkPass"),n())},trigger:"blur"}],checkPass:[{validator:(e,t,n)=>{""===t?n(new Error("请再次输入密码")):t!==this.createForm.pass?n(new Error("两次输入密码不一致!")):n()},trigger:"blur"}]}}},mounted(){this.$nextTick(function(){})},methods:{toLoginForm(){this.$refs.createForm.validate(e=>{if(!e)return console.log("error submit!!"),!1;{let e=web3.eth.accounts.create().privateKey.slice(2);console.log(e);let t=web3.eth.accounts.encrypt("0x"+e,this.createForm.pass);console.log(t);let n=web3.utils.toChecksumAddress(t.address);console.log(n),web3.utils.checkAddressChecksum(n)&&(this.$store.state.vuexStore.walletInfo.keyStore=t,this.$store.state.vuexStore.walletInfo.address=n,this.$store.state.vuexStore.isLogin=!0,this.$notify({title:"成功",dangerouslyUseHTMLString:!0,message:"创建成功",duration:3e3,type:"success"})),this.$router.push("/backup")}this.createForm.pass="",this.createForm.checkPass=""})}}},k={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"createForm",class:{fullPage:!e.$store.state.vuexStore.isNavShow}},[n("div",{staticClass:"contentBox"},[n("h2",[e._v("创建钱包")]),e._v(" "),n("hr",{staticStyle:{height:"2px",border:"none","border-top":"2px dotted #EBEEF5"}}),e._v(" "),n("el-form",{ref:"createForm",staticClass:"demo-ruleForm",attrs:{model:e.createForm,"status-icon":"",rules:e.createRules,"label-width":"80px"}},[n("el-form-item",{attrs:{label:"密码",prop:"pass"}},[n("el-input",{attrs:{type:"password","auto-complete":"off"},model:{value:e.createForm.pass,callback:function(t){e.$set(e.createForm,"pass",t)},expression:"createForm.pass"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"确认密码",prop:"checkPass"}},[n("el-input",{attrs:{type:"password","auto-complete":"off"},model:{value:e.createForm.checkPass,callback:function(t){e.$set(e.createForm,"checkPass",t)},expression:"createForm.checkPass"}})],1),e._v(" "),n("el-form-item",{staticStyle:{"text-align":"center"}},[n("el-button",{staticStyle:{"margin-left":"-40px",width:"120px"},attrs:{type:"primary"},on:{click:function(t){e.toLoginForm()}}},[e._v("提交")])],1)],1),e._v(" "),n("a",{staticClass:"backToStartBtn",on:{click:function(t){e.$parent.backToStart()}}},[e._v("返回开始界面")])],1)])},staticRenderFns:[]};var B=n("VU/8")(I,k,!1,function(e){n("uEPo")},"data-v-0631285a",null).exports,F={name:"loginByPrivateKeyForm",data(){return{loginByPrivateKeyForm:{privateKey:"",pass:"",checkPass:""},loginByPrivateKeyRules:{privateKey:[{validator:(e,t,n)=>{if(!t)return n(new Error("私钥不能为空"));64!==t.length?n(new Error("请输入正确的私钥")):n()},trigger:"blur"}],pass:[{validator:(e,t,n)=>{""===t?n(new Error("请输入密码")):(""!==this.loginByPrivateKeyForm.checkPass&&this.$refs.loginByPrivateKeyForm.validateField("checkPass"),n())},trigger:"blur"}],checkPass:[{validator:(e,t,n)=>{""===t?n(new Error("请再次输入密码")):t!==this.loginByPrivateKeyForm.pass?n(new Error("两次输入密码不一致!")):n()},trigger:"blur"}]}}},mounted(){this.$nextTick(function(){})},methods:{Login(){this.$refs.loginByPrivateKeyForm.validate(e=>{if(!e)return console.log("error submit!!"),!1;{let e=web3.eth.accounts.encrypt("0x"+this.loginByPrivateKeyForm.privateKey,this.loginByPrivateKeyForm.pass);console.log(e);let t=web3.utils.toChecksumAddress(e.address);console.log(t),web3.utils.checkAddressChecksum(t)?(this.$store.state.vuexStore.walletInfo.keyStore=e,this.$store.state.vuexStore.walletInfo.address=t,this.$store.state.vuexStore.isLogin=!0,this.$notify({title:"成功",dangerouslyUseHTMLString:!0,message:"导入成功",duration:3e3,type:"success"}),this.$router.push("/backup"),this.$store.state.vuexStore.activeNavIndex="3-5"):this.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"导入失败，请确认私钥正确",duration:3e3}),this.loginByPrivateKeyForm.privateKey="",this.loginByPrivateKeyForm.pass="",this.loginByPrivateKeyForm.checkPass=""}})}}},N={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"loginByPrivateKeyForm",class:{fullPage:!e.$store.state.vuexStore.isNavShow}},[n("div",{staticClass:"contentBox"},[n("h2",[e._v("导入私钥")]),e._v(" "),n("hr",{staticStyle:{height:"2px",border:"none","border-top":"2px dotted #EBEEF5"}}),e._v(" "),n("el-form",{ref:"loginByPrivateKeyForm",staticClass:"demo-ruleForm",attrs:{model:e.loginByPrivateKeyForm,"status-icon":"",rules:e.loginByPrivateKeyRules,"label-width":"80px"}},[n("el-form-item",{attrs:{label:"私钥",prop:"privateKey"}},[n("el-input",{model:{value:e.loginByPrivateKeyForm.privateKey,callback:function(t){e.$set(e.loginByPrivateKeyForm,"privateKey",t)},expression:"loginByPrivateKeyForm.privateKey"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"密码",prop:"pass"}},[n("el-input",{attrs:{type:"password","auto-complete":"off"},model:{value:e.loginByPrivateKeyForm.pass,callback:function(t){e.$set(e.loginByPrivateKeyForm,"pass",t)},expression:"loginByPrivateKeyForm.pass"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"确认密码",prop:"checkPass"}},[n("el-input",{attrs:{type:"password","auto-complete":"off"},model:{value:e.loginByPrivateKeyForm.checkPass,callback:function(t){e.$set(e.loginByPrivateKeyForm,"checkPass",t)},expression:"loginByPrivateKeyForm.checkPass"}})],1),e._v(" "),n("el-form-item",{staticStyle:{"text-align":"center"}},[n("el-button",{staticStyle:{"margin-left":"-40px",width:"120px"},attrs:{type:"primary"},on:{click:function(t){e.Login()}}},[e._v("提交")])],1)],1),e._v(" "),n("a",{staticClass:"backToStartBtn",on:{click:function(t){e.$parent.backToStart()}}},[e._v("返回开始界面")])],1)])},staticRenderFns:[]};var M=n("VU/8")(F,N,!1,function(e){n("r/t0")},"data-v-0feb6c2a",null).exports,L=n("PH7Z"),O={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"loginByKeyStoreForm",class:{fullPage:!e.$store.state.vuexStore.isNavShow}},[n("div",{staticClass:"contentBox loginByKeyStoreContentBox"},[n("h2",[e._v("从备份文件恢复")]),e._v(" "),n("hr",{staticStyle:{height:"2px",border:"none","border-top":"2px dotted #EBEEF5"}}),e._v(" "),n("el-form",{ref:"loginByKeyStoreForm",staticClass:"demo-ruleForm",attrs:{"status-icon":"","label-position":"top","label-width":"80px"}},[n("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{"on-change":e.handleChange,"file-list":e.fileList,accept:".json","auto-upload":!1,limit:1,action:"/"}},[n("el-button",{attrs:{slot:"trigger"},slot:"trigger"},[e._v("选取文件")])],1),e._v(" "),n("el-form-item",{attrs:{label:"密码",prop:"keyStorePass"}},[n("el-input",{attrs:{type:"password","auto-complete":"off"},model:{value:e.keyStorePass,callback:function(t){e.keyStorePass=t},expression:"keyStorePass"}})],1),e._v(" "),n("el-form-item",{staticStyle:{"text-align":"center"}},[n("el-button",{staticStyle:{width:"120px"},attrs:{type:"primary"},on:{click:function(t){e.login()}}},[e._v("导入")])],1)],1),e._v(" "),n("a",{staticClass:"backToStartBtn",on:{click:function(t){e.$parent.backToStart()}}},[e._v("返回开始界面")])],1)])},staticRenderFns:[]};var P=function(e){n("uBob")},R=n("VU/8")(L.a,O,!1,P,"data-v-e6eac7cc",null).exports,A={name:"backupForm",data:()=>({}),methods:{backup(){if(console.log(this.$store.state.vuexStore.walletInfo.keyStore),this.$store.state.vuexStore.walletInfo.keyStore){var e=JSON.stringify(this.$store.state.vuexStore.walletInfo.keyStore),t=new Blob([e],{type:"text/plain;charset=utf-8"});saveAs(t,this.$store.state.vuexStore.walletInfo.keyStore.id+".json")}else this.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"备份失败，请确认正确导入钱包",duration:3e3})}}},E={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"backupForm",class:{fullPage:!e.$store.state.vuexStore.isNavShow}},[n("div",{staticClass:"contentBox"},[n("h2",[e._v(e._s(e.$t("backup.title")))]),e._v(" "),n("hr",{staticStyle:{height:"2px",border:"none","border-top":"2px dotted #EBEEF5"}}),e._v(" "),n("el-button",{staticStyle:{margin:"10px 0"},attrs:{type:"primary",icon:"el-icon-edit",plain:""},on:{click:function(t){e.backup()}}},[e._v(e._s(e.$t("backup.backupBtn")))]),e._v(" "),n("div",{staticClass:"tipBox tipBox-red"},[n("h3",[e._v(e._s(e.$t("backup.tips")))]),e._v(" "),n("p",[e._v("点击“备份当前钱包”按钮后，浏览器会生成一个钱包备份文件，当您清空浏览器数据库、或者更换浏览器、重装系统后，可以使用钱包备份文件恢复当前钱包。请将该文件保存到安全的地方，并牢记钱包密码，钱包文件丢失或钱包密码遗忘可能会导致您的资产丢失。")])])],1)])},staticRenderFns:[]};var H=n("VU/8")(A,E,!1,function(e){n("z7CD")},"data-v-63f6b4fc",null).exports,D={name:"contactBox",data(){return{contactList:[],multipleSelection:[],centerDialogVisible:!1,addContactForm:{name:"",address:""},addContactRules:{name:[{validator:(e,t,n)=>{if(""===t)return n(new Error("姓名不能为空"));n()},trigger:"blur"}],address:[{validator:(e,t,n)=>{let a=!1;this.$store.state.vuexStore.contactList.forEach(function(e,n){e.address===t&&(a=!0)}),""===t?n(new Error("地址不能为空")):42!==t.length?n(new Error("地址检测错误")):a?n(new Error("地址已经存在")):n()},trigger:"blur"}]}}},mounted(){this.$nextTick(function(){this.$store.state.vuexStore.isLogin?this.contactList=this.$store.state.vuexStore.contactList:this.$router.push("/start")})},methods:{toggleSelection(e){e?e.forEach(e=>{this.$refs.multipleTable.toggleRowSelection(e)}):this.$refs.multipleTable.clearSelection()},handleSelectionChange(e){this.multipleSelection=e},addContact(){this.$refs.addContactForm.validate(e=>{if(!e)return console.log("error submit!!"),!1;{let e={name:this.addContactForm.name,address:this.addContactForm.address};this.$store.state.vuexStore.contactList.push(e),this.saveAsArray(this.$store.state.vuexStore.walletInfo.address+"@contactList",this.$store.state.vuexStore.contactList),this.centerDialogVisible=!1,this.$message({showClose:!0,message:"添加联系人成功",type:"success"})}})},DeltableData(){let e=this;e.multipleSelection.forEach(function(t,n){e.$store.state.vuexStore.contactList.forEach(function(n,a){n.address===t.address&&e.$store.state.vuexStore.contactList.splice(a,1)}),e.saveAsArray(e.$store.state.vuexStore.walletInfo.address+"@contactList",e.$store.state.vuexStore.contactList)})},transfer(){let e=this.multipleSelection[0].address;this.$store.state.vuexStore.activeNavIndex="1-1",this.$router.push({name:"index",params:{address:e}})},saveAsArray:function(e,t){let n=e.toString();window.localStorage.setItem(n,JSON.stringify(t))}}},U={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"contactBox",class:{fullPage:!e.$store.state.vuexStore.isNavShow}},[n("div",{staticClass:"contentBox"},[n("h2",[e._v("我的联系人")]),e._v(" "),n("hr",{staticStyle:{height:"2px",border:"none","border-top":"2px dotted #EBEEF5"}}),e._v(" "),n("el-button",{staticStyle:{margin:"10px 0"},attrs:{type:"primary",icon:"el-icon-plus",plain:""},on:{click:function(t){e.centerDialogVisible=!0}}},[e._v("添加联系人")]),e._v(" "),n("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.contactList,"tooltip-effect":"dark"},on:{"selection-change":e.handleSelectionChange}},[n("el-table-column",{attrs:{type:"selection",width:"60"}}),e._v(" "),n("el-table-column",{attrs:{prop:"name",label:"姓名",width:"120"}}),e._v(" "),n("el-table-column",{attrs:{prop:"address",label:"地址"}})],1),e._v(" "),n("div",{staticStyle:{"margin-top":"20px"}},[n("el-button",{attrs:{disabled:1!=e.multipleSelection.length,type:"success",plain:""},on:{click:function(t){e.transfer()}}},[e._v("转账")]),e._v(" "),n("el-button",{attrs:{type:"danger",plain:""},on:{click:function(t){e.DeltableData()}}},[e._v("删除")]),e._v(" "),n("el-button",{attrs:{plain:""},on:{click:function(t){e.toggleSelection()}}},[e._v("取消选择")])],1)],1),e._v(" "),n("el-dialog",{attrs:{title:"添加联系人",visible:e.centerDialogVisible,width:"40%",center:"","modal-append-to-body":!1},on:{"update:visible":function(t){e.centerDialogVisible=t}}},[n("el-form",{ref:"addContactForm",staticClass:"demo-ruleForm",attrs:{model:e.addContactForm,"status-icon":"",rules:e.addContactRules,"label-width":"50px"}},[n("el-form-item",{attrs:{label:"名称",prop:"name"}},[n("el-input",{attrs:{"auto-complete":"off"},model:{value:e.addContactForm.name,callback:function(t){e.$set(e.addContactForm,"name",t)},expression:"addContactForm.name"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"地址",prop:"address"}},[n("el-input",{model:{value:e.addContactForm.address,callback:function(t){e.$set(e.addContactForm,"address",t)},expression:"addContactForm.address"}})],1)],1),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"primary"},on:{click:function(t){e.addContact()}}},[e._v("添加")]),e._v(" "),n("el-button",{on:{click:function(t){e.centerDialogVisible=!1}}},[e._v("取 消")])],1)],1)],1)},staticRenderFns:[]};var K=n("VU/8")(D,U,!1,function(e){n("TehK")},"data-v-14c64d76",null).exports,V=n("f3u+"),W=n.n(V);a.default.use(W.a);var J={name:"receiveForm",data:()=>({paymentCodeForm:{amount:"",assetType:"",assetContractAddress:"",selfUri:"",R:"",Hr:"",Code:""},paymentCodeRules:{amount:[{validator:(e,t,n)=>{if(!t)return n(new Error("金额不能为空"));t<0?n(new Error("请输入正确的数字值")):n()},trigger:"blur"}],assetType:[{validator:(e,t,n)=>{""===t?n(new Error("请选择资产类型")):n()},trigger:"change"}]},isPaymentCodeBoxShow:!1}),watch:{},mounted(){this.$nextTick(function(){})},methods:{copyfun(){let e=this;clipboard&&clipboard.destroy(),clipboard=new ClipboardJS(".btncopy"),clipboard.on("success",function(t){e.$notify.info({title:"消息",dangerouslyUseHTMLString:!0,message:"复制成功",duration:3e3})}),clipboard.on("error",function(t){e.$notify.info({title:"警告",dangerouslyUseHTMLString:!0,message:"复制失败，请自行复制",duration:3e3,type:"warning"})})},createPaymentCode(){let e=this;e.$refs.paymentCodeForm.validate(t=>{if(!t)return console.log("error submit!!"),!1;{if(console.log("submit!"),"TNC"==e.paymentCodeForm.assetType)e.paymentCodeForm.assetContractAddress=e.$store.state.vuexStore.tncContractAddress;else{if("ETH"!=e.paymentCodeForm.assetType)return e.$notify.info({title:"警告",dangerouslyUseHTMLString:!0,message:"资产类型出错",duration:3e3,type:"warning"}),!1;e.paymentCodeForm.assetContractAddress=""}if(e.paymentCodeForm.R=createR(),e.paymentCodeForm.Hr=createHr(e.paymentCodeForm.R),e.$store.state.vuexStore.channelList.forEach(function(t,n){3==t.State&&t.assetType==e.paymentCodeForm.assetType&&(e.paymentCodeForm.selfUri=t.SelfUri)}),""==e.paymentCodeForm.selfUri)return e.$notify.info({title:"警告",dangerouslyUseHTMLString:!0,message:"资产合约地址出错",duration:3e3,type:"warning"}),!1;let t=e.paymentCodeForm.selfUri+"&"+e.paymentCodeForm.Hr+"&"+e.paymentCodeForm.assetContractAddress+"&"+e.paymentCodeForm.amount+"&PaymentCode";console.log(t),e.paymentCodeForm.Code="TN"+base58encode(t),console.log(e.paymentCodeForm.Code),e.isPaymentCodeBoxShow=!0}})},resetForm(){this.isPaymentCodeBoxShow=!1,this.paymentCodeForm={amount:"",assetType:"",selfUri:"",R:"",Hr:"",Code:""}}}},X={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"receiveForm",class:{fullPage:!e.$store.state.vuexStore.isNavShow}},[n("div",{staticClass:"contentBox"},[n("h2",[e._v("收款")]),e._v(" "),n("hr",{staticStyle:{height:"2px",border:"none","border-top":"2px dotted #EBEEF5"}}),e._v(" "),n("el-tabs",{staticStyle:{width:"100%","max-width":"440px"},attrs:{type:"border-card",stretch:!0}},[n("el-tab-pane",{attrs:{label:"链上"}},[n("div",{staticClass:"QRCodeBox QRCodeBox-white"},[n("h3",[e._v("收款地址")]),e._v(" "),n("qriously",{attrs:{value:this.$store.state.vuexStore.walletInfo.address,level:"H",size:210}}),e._v(" "),n("p",{domProps:{textContent:e._s(this.$store.state.vuexStore.walletInfo.address)}})],1),e._v(" "),n("el-input",{attrs:{id:"receiveAddress",placeholder:"Address",readonly:"readonly"},model:{value:this.$store.state.vuexStore.walletInfo.address,callback:function(t){e.$set(this.$store.state.vuexStore.walletInfo,"address",t)},expression:"this.$store.state.vuexStore.walletInfo.address"}},[n("el-button",{staticClass:"btncopy",attrs:{slot:"append","data-clipboard-target":"#receiveAddress",icon:"el-icon-share"},on:{click:function(t){e.copyfun()}},slot:"append"},[e._v("Copy")])],1)],1),e._v(" "),n("el-tab-pane",{attrs:{label:"通道"}},[e.isPaymentCodeBoxShow?e._e():n("el-form",{ref:"paymentCodeForm",staticClass:"demo-ruleForm",staticStyle:{"text-align":"center"},attrs:{model:e.paymentCodeForm,"status-icon":"",rules:e.paymentCodeRules,"label-width":"80px"}},[n("el-form-item",{attrs:{label:"金额",prop:"amount"}},[n("el-input",{attrs:{type:"number","auto-complete":"off"},model:{value:e.paymentCodeForm.amount,callback:function(t){e.$set(e.paymentCodeForm,"amount",e._n(t))},expression:"paymentCodeForm.amount"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"资产类型",prop:"assetType"}},[n("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择资产类型"},model:{value:e.paymentCodeForm.assetType,callback:function(t){e.$set(e.paymentCodeForm,"assetType",t)},expression:"paymentCodeForm.assetType"}},[n("el-option",{attrs:{label:"TNC",value:"TNC"}}),e._v(" "),n("el-option",{attrs:{label:"ETH",value:"ETH"}})],1)],1),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:function(t){e.createPaymentCode()}}},[e._v("创建")])],1),e._v(" "),e.isPaymentCodeBoxShow?n("div",[n("el-button",{on:{click:function(t){e.resetForm("ruleForm")}}},[e._v("重置")]),e._v(" "),n("div",{staticClass:"QRCodeBox QRCodeBox-white"},[n("h3",[e._v("收款码")]),e._v(" "),n("qriously",{attrs:{value:e.paymentCodeForm.Code,level:"H",size:210}}),e._v(" "),n("p",{staticStyle:{width:"378px","text-overflow":"ellipsis","white-space":"nowrap",overflow:"hidden"}},[e._v(e._s(e.paymentCodeForm.Code))])],1),e._v(" "),n("el-input",{attrs:{id:"receivePaymentCode",placeholder:"Receive Payment Code"},model:{value:e.paymentCodeForm.Code,callback:function(t){e.$set(e.paymentCodeForm,"Code",t)},expression:"paymentCodeForm.Code"}},[n("el-button",{staticClass:"btncopy",attrs:{slot:"append","data-clipboard-target":"#receivePaymentCode",icon:"el-icon-search"},on:{click:function(t){e.copyfun()}},slot:"append"},[e._v("Copy")])],1)],1):e._e()],1)],1)],1)])},staticRenderFns:[]};var z=n("VU/8")(J,X,!1,function(e){n("piej")},"data-v-75ef3658",null).exports,j={name:"addChannelForm",data(){return{addChannelForm:{uri:"",assetType:"",selfDeposit:0,otherDeposit:0,alice:"",channelName:"",selfSignedData:"",keyStorePass:""},addChannelRules:{uri:[{validator:(e,t,n)=>{let a=this;if(!t)return n(new Error("对端URI不能为空"));t.indexOf("@")<-1?n(new Error("URI格式不正确")):42!==t.split("@")[0].length?n(new Error("URI格式不正确")):(a.$store.state.vuexStore.channelList.forEach(function(e,t){e.otherUri===a.addChannelForm.uri&&n(new Error("你已经和这个TNAP有一个通道了"))}),n())},trigger:"blur"}],assetType:[{validator:(e,t,n)=>{""===t?n(new Error("请选择资产类型")):n()},trigger:"change"}],selfDeposit:[{validator:(e,t,n)=>{if(""===t)n(new Error("本端押金数量不能为空"));else if(t<=0)n(new Error("本端押金数量必须大于0"));else if(t>this.$store.state.vuexStore.balanceData.Chain[this.addChannelForm.assetType])n(new Error("押金数量不能大于钱包余额"));else if(String(t).indexOf(".")>-1){let e=String(t).indexOf(".")+1;String(t).length-e>8?n(new Error("本端押金小数最多为8位")):n()}else n()},trigger:"blur"}],otherDeposit:[{validator:(e,t,n)=>{""===t?n(new Error("对端押金数量不能为空")):t<=0?n(new Error("对端押金数量必须大于0")):n()},trigger:"blur"}],alice:[{validator:(e,t,n)=>{""===t?n(new Error("通道名称不能为空")):n()},trigger:"blur"}],keyStorePass:[{validator:(e,t,n)=>{if(!t)return n(new Error("钱包密码不能为空，否则将无法交易"));{let e=this.$parent.decryptPrivateKey(this.$store.state.vuexStore.walletInfo.keyStore,t);setTimeout(()=>{if(!e)return n(new Error("钱包解锁失败 - 可能是密码错误"));n()},2e3)}},trigger:"blur"}]}}},methods:{addChannel(){let e=this;e.$refs.addChannelForm.validate(t=>{if(!t)return console.log("error submit!!"),!1;e.$parent.showLoading(),web3.eth.getGasPrice().then(function(t){console.log(t);new web3.eth.Contract(e.$store.state.vuexStore.tncContractAbi,e.$store.state.vuexStore.tncContractAddress,{from:e.$store.state.vuexStore.walletInfo.address,gasPrice:10*t});let n=e.$parent.decryptPrivateKey(e.$store.state.vuexStore.walletInfo.keyStore,e.addChannelForm.keyStorePass);web3.eth.getTransactionCount(e.$store.state.vuexStore.walletInfo.address,web3.eth.defaultBlock.pending).then(function(a){console.log(a);let s=web3.eth.abi.encodeFunctionSignature("approve(address,uint256)");console.log(s);let o=web3.eth.abi.encodeParameters(["address","uint256"],[e.$store.state.vuexStore.trinityContractAddress,1e8*e.addChannelForm.selfDeposit]);console.log(o);var r={nonce:web3.utils.toHex(a++),gasPrice:web3.utils.toHex(10*t),gasLimit:web3.utils.toHex(45e5),to:e.$store.state.vuexStore.tncContractAddress,from:e.$store.state.vuexStore.walletInfo.address,value:"0x00",data:s+o.substr(2)};console.log(r);let i=signData(r,n.privateKey);console.log(i),web3.eth.sendSignedTransaction("0x"+i).on("transactionHash",function(e){console.log(e)}).on("receipt",function(t){console.log(t);let n=e.$parent.uri2Ip(e.addChannelForm.uri,8766);const a="ws://"+n+"/";var s=e.$store.state.vuexStore.channelList.length;console.log(s);let o=e.$store.state.vuexStore.walletInfo.address+"@"+n,r=e.addChannelForm.uri.split("@")[0],i=(new Date).getTime(),l=md5encode(e.addChannelForm.uri,i),c=md5encode(o,i);e.addChannelForm.channelName="0x"+l+c,console.log(e.addChannelForm.channelName);var d={websock:new WebSocket(a)};console.log(d),e.$store.state.vuexStore.channelList.push(d),e.$store.state.vuexStore.channelList[s].websock.onmessage=e.$parent.websocketOnmessage,e.$store.state.vuexStore.channelList[s].websock.onclose=e.$parent.websocketClose;let u=web3.utils.soliditySha3({t:"bytes32",v:e.addChannelForm.channelName},{t:"uint256",v:0},{t:"address",v:e.$store.state.vuexStore.walletInfo.address},{t:"uint256",v:1e8*e.addChannelForm.selfDeposit},{t:"address",v:r},{t:"uint256",v:1e8*e.addChannelForm.otherDeposit});console.log(u);let p=e.$parent.decryptPrivateKey(e.$store.state.vuexStore.walletInfo.keyStore,e.addChannelForm.keyStorePass),h=ecSign(u,p.privateKey);console.log(h),e.addChannelForm.selfSignedData=h;var m={MessageType:"Founder",Sender:o,Receiver:e.addChannelForm.uri,TxNonce:0,ChannelName:e.addChannelForm.channelName,NetMagic:e.$store.state.vuexStore.NetMagic,MessageBody:{FounderDeposit:parseInt(1e8*e.addChannelForm.selfDeposit)/1e8,PartnerDeposit:parseInt(1e8*e.addChannelForm.otherDeposit)/1e8,Commitment:e.addChannelForm.selfSignedData,AssetType:e.addChannelForm.assetType}};setTimeout(function(){e.$store.state.vuexStore.channelList[s].websock.send(JSON.stringify(m))},2e3),e.$store.state.vuexStore.addChannelInfo=e.addChannelForm,console.log(e.$store.state.vuexStore.addChannelInfo),e.$store.state.vuexStore.channelList[s].ChannelName=e.addChannelForm.channelName,e.$store.state.vuexStore.channelList[s].Alice=e.addChannelForm.alice,e.$store.state.vuexStore.channelList[s].State=2,e.$store.state.vuexStore.channelList[s].isConnect=!0,e.$store.state.vuexStore.channelList[s].SelfBalance=1e8*e.addChannelForm.selfDeposit,e.$store.state.vuexStore.channelList[s].OtherBalance=1e8*e.addChannelForm.otherDeposit,e.$store.state.vuexStore.channelList[s].assetType=e.addChannelForm.assetType,e.$store.state.vuexStore.channelList[s].isTestNet=!0,e.$store.state.vuexStore.channelList[s].SelfUri=o,e.$store.state.vuexStore.channelList[s].OtherUri=e.addChannelForm.uri,e.$store.state.vuexStore.channelList[s].TxNonce=0,e.$store.state.vuexStore.channelList[s].date=i,e.$store.state.vuexStore.channelList[s].Ip=e.$parent.uri2Ip(e.addChannelForm.uri,null),e.$parent.StoreChannel(),e.$router.push("/channelList"),e.$parent.closeLoading()}).on("confirmation",function(e,t){}).on("error",console.error)})})})},CreateFounder(){},removeAddChannelData(){this.$refs.addChannelForm.resetFields(),this.$router.push("/channelList")}}},G={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"addChannelBox"},[n("div",{staticClass:"contentBox"},[n("div",[e.addChannelForm.assetType?n("p",{staticStyle:{float:"right",margin:"5px 0"}},[e._v("资产余额："+e._s(e.$store.state.vuexStore.balanceData.Chain[e.addChannelForm.assetType])+e._s(e.addChannelForm.assetType))]):e._e(),e._v(" "),n("h2",[e._v("添加通道")])]),e._v(" "),n("hr",{staticStyle:{height:"2px",border:"none","border-top":"2px dotted #EBEEF5"}}),e._v(" "),n("el-form",{ref:"addChannelForm",staticClass:"addChannelForm",attrs:{model:e.addChannelForm,"status-icon":"",rules:e.addChannelRules,"label-width":"100px"}},[n("el-form-item",{attrs:{label:"对端URI",prop:"uri"}},[n("el-input",{attrs:{"auto-complete":"off"},model:{value:e.addChannelForm.uri,callback:function(t){e.$set(e.addChannelForm,"uri",t)},expression:"addChannelForm.uri"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"资产类型",prop:"assetType"}},[n("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择资产类型"},model:{value:e.addChannelForm.assetType,callback:function(t){e.$set(e.addChannelForm,"assetType",t)},expression:"addChannelForm.assetType"}},[n("el-option",{attrs:{label:"TNC",value:"TNC"}}),e._v(" "),n("el-option",{attrs:{label:"ETH",value:"ETH"}})],1)],1),e._v(" "),n("el-form-item",{attrs:{label:"本端押金",prop:"selfDeposit"}},[n("el-input",{attrs:{"auto-complete":"off"},model:{value:e.addChannelForm.selfDeposit,callback:function(t){e.$set(e.addChannelForm,"selfDeposit",e._n(t))},expression:"addChannelForm.selfDeposit"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"对端押金",prop:"otherDeposit"}},[n("el-slider",{attrs:{"show-input-controls":!1,max:e.addChannelForm.selfDeposit,step:1e-8,"show-input":""},model:{value:e.addChannelForm.otherDeposit,callback:function(t){e.$set(e.addChannelForm,"otherDeposit",t)},expression:"addChannelForm.otherDeposit"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"通道名称",prop:"alice"}},[n("el-input",{attrs:{"auto-complete":"off"},model:{value:e.addChannelForm.alice,callback:function(t){e.$set(e.addChannelForm,"alice",t)},expression:"addChannelForm.alice"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"密码",prop:"keyStorePass"}},[n("el-input",{attrs:{type:"password","auto-complete":"off"},model:{value:e.addChannelForm.keyStorePass,callback:function(t){e.$set(e.addChannelForm,"keyStorePass",t)},expression:"addChannelForm.keyStorePass"}})],1),e._v(" "),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:function(t){e.addChannel()}}},[e._v("添加通道")]),e._v(" "),n("el-button",{on:{click:function(t){e.removeAddChannelData()}}},[e._v("返回")])],1)],1)],1)])},staticRenderFns:[]};var Q=n("VU/8")(j,G,!1,function(e){n("5Clm")},"data-v-f41079ca",null).exports,q={name:"channelListForm",data(){return{isChannelInfoBoxShow:!1,activeInfo:{Alice:"",date:"",ChannelName:"",SelfUri:"",SelfBalance:"",OtherUri:"",OtherBalance:"",assetType:"",isConnect:"",isTestNet:"",State:"",keyStorePass:""},isConfirmCloseChannel:!1,confirmCloseRules:{keyStorePass:[{validator:(e,t,n)=>{if(!t)return n(new Error("钱包密码不能为空，否则将无法交易"));{let e=this.$parent.decryptPrivateKey(this.$store.state.vuexStore.walletInfo.keyStore,this.activeInfo.keyStorePass);setTimeout(()=>{if(!e)return n(new Error("钱包解锁失败 - 可能是密码错误"));n()},2e3)}},trigger:"blur"}]}}},computed:{channelList(){return this.$store.state.vuexStore.channelList}},filters:{formatStatus:function(e){let t;switch(e){case 1:t="Closing";break;case 2:t="Opening";break;case 3:t="Open";break;default:t="Error"}return t},formatBalance:function(e){let t;return t=e<0||isNaN(e)?"error":e/1e8},formatDateTime:function(e){let t=new Date;t.setTime(e);let n=t.getFullYear(),a=t.getMonth()+1;a=a<10?"0"+a:a;let s=t.getDate();return n+"-"+a+"-"+(s=s<10?"0"+s:s)},formatConnect:function(e){let t;return t=e?"已连接":"未连接"},formatNet:function(e){let t;return t=e?"测试网":"主网"}},mounted(){this.$nextTick(function(){0==this.$store.state.vuexStore.channelList.length&&this.$router.push("/addChannel")})},watch:{"$store.state.vuexStore.walletInfo.channelList":"getAddressInfo"},methods:{showChannelInfo(e,t){this.isChannelInfoBoxShow=!0,this.activeInfo=e,this.activeInfo.keyStorePass="",console.log(t),console.log(e)},showConfirmCloseChannelData(){this.isConfirmCloseChannel=!0},closeChannel(){let e=this;e.$refs.activeInfo.validate(t=>{if(!t)return console.log("error submit!!"),!1;{let t=this.$parent.getChannelSerial("ChannelName",e.activeInfo.ChannelName);if(console.log(t),null===t)return void e.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"未找到该通道,请重试一次",duration:3e3});if(console.log(e.$store.state.vuexStore.channelList[t].isConnect),1==e.$store.state.vuexStore.channelList[t].isConnect){let n=web3.utils.soliditySha3({t:"bytes32",v:e.activeInfo.ChannelName},{t:"uint256",v:4294967295},{t:"address",v:e.$store.state.vuexStore.walletInfo.address},{t:"uint256",v:e.activeInfo.SelfBalance},{t:"address",v:e.activeInfo.OtherUri.split("@")[0]},{t:"uint256",v:e.activeInfo.OtherBalance});console.log(n);let a=e.$parent.decryptPrivateKey(e.$store.state.vuexStore.walletInfo.keyStore,e.activeInfo.keyStorePass),s=ecSign(n,a.privateKey);console.log(s);let o={MessageType:"Settle",Sender:e.activeInfo.SelfUri,Receiver:e.activeInfo.OtherUri,TxNonce:4294967295,ChannelName:e.activeInfo.ChannelName,AssetType:e.activeInfo.assetType,NetMagic:e.$store.state.vuexStore.NetMagic,MessageBody:{Commitment:s,SenderBalance:e.activeInfo.SelfBalance/1e8,ReceiverBalance:e.activeInfo.OtherBalance/1e8},Comments:{}};e.$store.state.vuexStore.channelList[t].websock.send(JSON.stringify(o)),e.$store.state.vuexStore.closeChannelInfo=e.activeInfo,console.log(e.$store.state.vuexStore.closeChannelInfo.keyStorePass),e.$store.state.vuexStore.closeChannelInfo.selfSignedData=s,e.$store.state.vuexStore.channelList[t].State=1,e.isChannelInfoBoxShow=!1,e.isConfirmCloseChannel=!1}else console.log("\b进入强制拆通道")}})}}},Y={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"channelListForm",class:{fullPage:!e.$store.state.vuexStore.isNavShow}},[n("div",{staticClass:"contentBox"},[n("div",[n("router-link",{staticStyle:{float:"right"},attrs:{to:"/addChannel"}},[n("el-button",{attrs:{size:"mini",icon:"el-icon-plus",type:"primary"}},[e._v("添加通道")])],1),e._v(" "),n("h2",[e._v("通道列表")])],1),e._v(" "),n("hr",{staticStyle:{height:"2px",border:"none","border-top":"2px dotted #EBEEF5"}}),e._v(" "),e.channelList.length?n("ul",e._l(e.channelList,function(t,a){return n("li",{key:a,on:{click:function(n){e.showChannelInfo(t,a)}}},[n("h3",[e._v(e._s(t.Alice))]),n("br"),e._v(" "),n("p",[e._v(e._s(e._f("formatDateTime")(t.date)))]),e._v(" "),t.isConnect?n("p",[e._v("State："+e._s(e._f("formatStatus")(t.State)))]):e._e(),e._v(" "),t.isConnect?e._e():n("p",[e._v("State：NotConnect")]),e._v(" "),n("span",[e._v(e._s(e._f("formatBalance")(t.SelfBalance))),n("sup",[e._v(e._s(t.assetType))])])])})):e._e(),e._v(" "),e.channelList.length?e._e():n("p",{staticStyle:{"text-align":"center","margin-top":"20vh","font-size":"14px",color:"#5e6d82","line-height":"1.5em","font-weight":"400"}},[e._v("\n          还没有通道，立即去添加\n      ")])]),e._v(" "),n("el-dialog",{staticClass:"channelInfoBox",attrs:{title:e.activeInfo.Alice,visible:e.isChannelInfoBoxShow,width:"30%",center:"","modal-append-to-body":!1},on:{"update:visible":function(t){e.isChannelInfoBoxShow=t}}},[n("span",[e._v("通道名称："+e._s(e.activeInfo.ChannelName))]),e._v(" "),n("span",[e._v("开通时间："+e._s(e._f("formatDateTime")(e.activeInfo.date)))]),e._v(" "),n("span",[e._v("本端地址："+e._s(e.activeInfo.SelfUri))]),e._v(" "),n("span",[e._v("本端余额："+e._s(e._f("formatBalance")(e.activeInfo.SelfBalance))+e._s(e.activeInfo.assetType))]),e._v(" "),n("span",[e._v("对端地址："+e._s(e.activeInfo.OtherUri))]),e._v(" "),n("span",[e._v("对端余额："+e._s(e._f("formatBalance")(e.activeInfo.OtherBalance))+e._s(e.activeInfo.assetType))]),e._v(" "),n("span",[e._v("通道状态："+e._s(e._f("formatStatus")(e.activeInfo.State)))]),e._v(" "),n("span",[e._v("是否连接："+e._s(e._f("formatConnect")(e.activeInfo.isConnect)))]),e._v(" "),n("span",[e._v("网络："+e._s(e._f("formatNet")(e.activeInfo.isTestNet)))]),e._v(" "),e.isConfirmCloseChannel?e._e():n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"danger"},on:{click:function(t){e.showConfirmCloseChannelData()}}},[e._v(" 关闭通道 ")])],1),e._v(" "),e.isConfirmCloseChannel?n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-form",{ref:"activeInfo",staticClass:"demo-ruleForm",attrs:{model:e.activeInfo,"status-icon":"",rules:e.confirmCloseRules,"label-width":"80px"}},[n("el-form-item",{attrs:{label:"密码",prop:"keyStorePass"}},[n("el-input",{attrs:{placeholder:"在此输入密码",type:"password","auto-complete":"off"},model:{value:e.activeInfo.keyStorePass,callback:function(t){e.$set(e.activeInfo,"keyStorePass",t)},expression:"activeInfo.keyStorePass"}})],1),e._v(" "),n("el-form-item",{staticStyle:{"text-align":"center","margin-left":"-80px"}},[n("el-button",{attrs:{type:"danger"},on:{click:function(t){e.closeChannel()}}},[e._v(" 确定 ")]),e._v(" "),n("el-button",{on:{click:function(t){e.isChannelInfoBoxShow=!1,e.isConfirmCloseChannel=!1}}},[e._v(" 取消 ")])],1)],1)],1):e._e()])],1)},staticRenderFns:[]};var Z=n("VU/8")(q,Y,!1,function(e){n("QRuK")},"data-v-03f6e3b8",null).exports,ee={name:"recordForm",data:()=>({tableData:[{date:"1495157126",name:"王小虎",Amount:"87",assetType:"TNC",isPay:!0},{date:"1495157126",name:"王小虎",Amount:"87",assetType:"TNC",isPay:!0},{date:"1495157126",name:"王小虎",Amount:"127",assetType:"ETH",isPay:!1},{date:"1495157126",name:"王小虎",Amount:"87",assetType:"TNC",isPay:!0}],isRecordInfoBoxShow:!1,activeInfo:{date:"",name:"",Amount:"",assetType:"",isPay:!0}}),filters:{formatIsPay:function(e){return e?"-":"+"},formatDateTime:function(e){var t=new Date;t.setTime(1e3*e);var n=t.getFullYear(),a=t.getMonth()+1;a=a<10?"0"+a:a;var s=t.getDate();return n+"-"+a+"-"+(s=s<10?"0"+s:s)}},methods:{showRecordInfo(e){this.isRecordInfoBoxShow=!0,this.activeInfo=e,console.log(e)}}},te={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"recordForm",class:{fullPage:!e.$store.state.vuexStore.isNavShow}},[n("div",{staticClass:"contentBox"},[n("h2",[e._v("交易记录")]),e._v(" "),n("hr",{staticStyle:{height:"2px",border:"none","border-top":"2px dotted #EBEEF5"}}),e._v(" "),n("ul",e._l(e.tableData,function(t,a){return n("li",{key:a,on:{click:function(n){e.showRecordInfo(t)}}},[n("h3",[e._v(e._s(t.name))]),n("br"),e._v(" "),n("p",[e._v(e._s(e._f("formatDateTime")(t.date)))]),e._v(" "),n("p",[e._v("State：Success")]),e._v(" "),n("span",[e._v(e._s(e._f("formatIsPay")(t.isPay))+e._s(t.Amount)),n("sup",[e._v(e._s(t.assetType))])])])}))]),e._v(" "),n("el-dialog",{staticClass:"recordInfoBox",attrs:{title:"通道信息",visible:e.isRecordInfoBoxShow,width:"30%",center:"","modal-append-to-body":!1},on:{"update:visible":function(t){e.isRecordInfoBoxShow=t}}},[n("span",[e._v("对端地址："+e._s(e.activeInfo.name))]),e._v(" "),n("span",[e._v("交易时间："+e._s(e._f("formatDateTime")(e.activeInfo.date)))]),e._v(" "),n("span",[e._v("交易金额："+e._s(e.activeInfo.Amount)+e._s(e.activeInfo.assetType))]),e._v(" "),n("span",[e._v("transactionHash:")]),e._v(" "),n("span",[e._v("blockHash:")]),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.isRecordInfoBoxShow=!1}}},[e._v(" 关闭 ")])],1)])],1)},staticRenderFns:[]};var ne=n("VU/8")(ee,te,!1,function(e){n("+LLG")},"data-v-f6562aa6",null).exports,ae={name:"aboutForm",data:()=>({}),filters:{},methods:{}},se={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"aboutForm",class:{fullPage:!e.$store.state.vuexStore.isNavShow}},[a("div",{staticClass:"contentBox"},[a("h2",[e._v("关于我们")]),e._v(" "),a("hr",{staticStyle:{height:"2px",border:"none","border-top":"2px dotted #EBEEF5"}}),e._v(" "),a("div",{staticStyle:{"text-align":"center"}},[a("img",{attrs:{src:n("N+8p"),alt:"Trinity"}}),e._v(" "),a("p",[e._v("Version: V"+e._s(e.$store.state.vuexStore.version))])]),e._v(" "),e._m(0)])])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("p",[this._v("从场景上说，MessageBox 的作用是美化系统自带的，因此适合展示较为简单的内容。如果需要弹出较为复杂的内容，请使用 Dialog。")]),this._v(" "),t("p",[this._v("从场景上说，MessageBox 的作用是美化系统自带的，因此适合展示较为简单的内容。如果需要弹出较为复杂的内容，请使用 Dialog。")]),this._v(" "),t("p",[this._v("从场景上说，MessageBox 的作用是美化系统自带的，因此适合展示较为简单的内容。如果需要弹出较为复杂的内容，请使用 Dialog。")])])}]};var oe=n("VU/8")(ae,se,!1,function(e){n("4IkI")},"data-v-33791004",null).exports;a.default.use(S.a);var re=new S.a({routes:[{path:"/",name:"index",component:w},{path:"/backup",name:"BackupForm",component:H},{path:"/contact",name:"contactForm",component:K},{path:"/receive",name:"receiveForm",component:z},{path:"/start",name:"startForm",component:T},{path:"/create",name:"createForm",component:B},{path:"/loginByPrivateKey",name:"loginByPrivateKeyForm",component:M},{path:"/loginByKeyStore",name:"loginByKeyStoreForm",component:R},{path:"/addChannel",name:"addChannelForm",component:Q},{path:"/about",name:"aboutForm",component:oe},{path:"/channelList",name:"channelListForm",component:Z},{path:"/record",name:"recordForm",component:ne}],mode:"hash"}),ie=n("zL8q"),le=n.n(ie),ce=(n("tvR6"),n("NYxO")),de=n("urW8"),ue=n.n(de),pe=n("TXmL");n("wUZ8");var he={navMenu:{title:"Menu",wallet:{title:"Wallet",index:"Index",receive:"Receive",addChannel:"Add Channel",channelList:"Channel",record:"Record"},contact:"Contact",setting:{title:"Setting",switchLang:"更改语言",switchNet:"Switch Net",nightMode:"Night Mode",changePass:"Change Pass",backup:"Backup",signOut:"Sign Out"},about:"About Us"},backup:{title:"Backup",backupBtn:"Backup Wallet",tips:"Tips"}};n("Vi3T");var me={en:he,cn:{navMenu:{title:"菜单",wallet:{title:"钱包",index:"首页",receive:"收款",addChannel:"添加通道",channelList:"通道",record:"交易记录"},contact:"联系人",setting:{title:"设置",switchLang:"Switch Language",switchNet:"选择网络",nightMode:"夜间模式",changePass:"修改密码",backup:"备份",signOut:"退出"},about:"关于我们"},backup:{title:"备份",backupBtn:"备份钱包",tips:"温馨提醒"}}};a.default.use(pe.a);const ye=new pe.a({locale:localStorage.lang||"cn",messages:me});ue.a.i18n((e,t)=>ye.vm._t(e,t));var ve=ye,fe=(n("7xIN"),{state:{version:"0.0.1",isLogin:!1,isTestNet:!0,isNightMode:!1,activeNavIndex:"1-1",isNavShow:!0,isMessageBoxShow:!1,NetMagic:"195378745719990331",NodeUriWebSocket:"",tncContractAddress:"0x65096f2B7A8dc1592479F1911cd2B98dae4d2218",tncContractAbi:[{constant:!0,inputs:[],name:"mintingFinished",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"name",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_spender",type:"address"},{name:"_value",type:"uint256"}],name:"approve",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"totalSupply",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_from",type:"address"},{name:"_to",type:"address"},{name:"_value",type:"uint256"}],name:"transferFrom",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"decimals",outputs:[{name:"",type:"uint8"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"cap",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[],name:"unpause",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"_to",type:"address"},{name:"_amount",type:"uint256"}],name:"mint",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"_value",type:"uint256"}],name:"burn",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"paused",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_spender",type:"address"},{name:"_subtractedValue",type:"uint256"}],name:"decreaseApproval",outputs:[{name:"success",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"_owner",type:"address"}],name:"balanceOf",outputs:[{name:"balance",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[],name:"finishMinting",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[],name:"pause",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"owner",outputs:[{name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"symbol",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_to",type:"address"},{name:"_value",type:"uint256"}],name:"transfer",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"_spender",type:"address"},{name:"_addedValue",type:"uint256"}],name:"increaseApproval",outputs:[{name:"success",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"_owner",type:"address"},{name:"_spender",type:"address"}],name:"allowance",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"newOwner",type:"address"}],name:"transferOwnership",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"burner",type:"address"},{indexed:!1,name:"value",type:"uint256"}],name:"Burn",type:"event"},{anonymous:!1,inputs:[],name:"Pause",type:"event"},{anonymous:!1,inputs:[],name:"Unpause",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"to",type:"address"},{indexed:!1,name:"amount",type:"uint256"}],name:"Mint",type:"event"},{anonymous:!1,inputs:[],name:"MintFinished",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"owner",type:"address"},{indexed:!0,name:"spender",type:"address"},{indexed:!1,name:"value",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"from",type:"address"},{indexed:!0,name:"to",type:"address"},{indexed:!1,name:"value",type:"uint256"}],name:"Transfer",type:"event"}],trinityContractAddress:"0x1002D9FE1afD4DDB629E3fcdB578297EFf380106",trinityContractAbi:[{anonymous:!1,inputs:[{indexed:!1,name:"tokenValue",type:"address"}],name:"SetToken",type:"event"},{constant:!1,inputs:[{name:"channelId",type:"bytes32"},{name:"nonce",type:"uint256"},{name:"closer",type:"address"},{name:"closeBalance",type:"uint256"},{name:"partner",type:"address"},{name:"partnerBalance",type:"uint256"},{name:"closerSignature",type:"bytes"},{name:"partnerSignature",type:"bytes"}],name:"closeChannel",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"channelId",type:"bytes32"},{name:"nonce",type:"uint256"},{name:"funderAddress",type:"address"},{name:"funderAmount",type:"uint256"},{name:"partnerAddress",type:"address"},{name:"partnerAmount",type:"uint256"},{name:"funderSignature",type:"bytes"},{name:"partnerSignature",type:"bytes"}],name:"deposit",outputs:[],payable:!0,stateMutability:"payable",type:"function"},{constant:!1,inputs:[{name:"channelId",type:"bytes32"},{name:"nonce",type:"uint256"},{name:"closer",type:"address"},{name:"closerBalance",type:"uint256"},{name:"partner",type:"address"},{name:"partnerBalance",type:"uint256"},{name:"closerSignature",type:"bytes"},{name:"partnerSignature",type:"bytes"}],name:"quickCloseChannel",outputs:[],payable:!0,stateMutability:"payable",type:"function"},{constant:!1,inputs:[{name:"blockNumber",type:"uint256"}],name:"setSettleTimeout",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"channelId",type:"bytes32"}],name:"settleTransaction",outputs:[],payable:!0,stateMutability:"payable",type:"function"},{constant:!1,inputs:[{name:"tokenAddress",type:"address"}],name:"setToken",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"channelId",type:"bytes32"},{name:"nonce",type:"uint256"},{name:"funderAddress",type:"address"},{name:"funderAmount",type:"uint256"},{name:"partnerAddress",type:"address"},{name:"partnerAmount",type:"uint256"},{name:"funderSignature",type:"bytes"},{name:"partnerSignature",type:"bytes"}],name:"updateDeposit",outputs:[],payable:!0,stateMutability:"payable",type:"function"},{constant:!1,inputs:[{name:"channelId",type:"bytes32"},{name:"nonce",type:"uint256"},{name:"partnerA",type:"address"},{name:"updateBalanceA",type:"uint256"},{name:"partnerB",type:"address"},{name:"updateBalanceB",type:"uint256"},{name:"signedStringA",type:"bytes"},{name:"signedStringB",type:"bytes"}],name:"updateTransaction",outputs:[],payable:!0,stateMutability:"payable",type:"function"},{constant:!1,inputs:[{name:"channelId",type:"bytes32"},{name:"nonce",type:"uint256"},{name:"sender",type:"address"},{name:"receiver",type:"address"},{name:"lockTime",type:"uint256"},{name:"lockAmount",type:"uint256"},{name:"lockHash",type:"bytes32"},{name:"partnerAsignature",type:"bytes"},{name:"partnerBsignature",type:"bytes"},{name:"secret",type:"bytes32"}],name:"withdraw",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"channelId",type:"bytes32"},{name:"nonce",type:"uint256"},{name:"sender",type:"address"},{name:"receiver",type:"address"},{name:"lockTime",type:"uint256"},{name:"lockAmount",type:"uint256"},{name:"lockHash",type:"bytes32"},{name:"partnerAsignature",type:"bytes"},{name:"partnerBsignature",type:"bytes"},{name:"secret",type:"bytes32"}],name:"withdrawSettle",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"channelId",type:"bytes32"},{name:"nonce",type:"uint256"},{name:"sender",type:"address"},{name:"receiver",type:"address"},{name:"lockTime",type:"uint256"},{name:"lockAmount",type:"uint256"},{name:"lockHash",type:"bytes32"},{name:"partnerAsignature",type:"bytes"},{name:"partnerBsignature",type:"bytes"}],name:"withdrawUpdate",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!1,name:"channleId",type:"bytes32"},{indexed:!1,name:"hashLock",type:"bytes32"}],name:"WithdrawUpdate",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"timeoutBlock",type:"uint256"}],name:"SetSettleTimeout",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"channleId",type:"bytes32"},{indexed:!1,name:"hashLock",type:"bytes32"}],name:"WithdrawSettle",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"channleId",type:"bytes32"},{indexed:!1,name:"hashLock",type:"bytes32"}],name:"Withdraw",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"channleId",type:"bytes32"},{indexed:!1,name:"partnerA",type:"address"},{indexed:!1,name:"partnerB",type:"address"},{indexed:!1,name:"amountB",type:"uint256"}],name:"Deposit",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"channleId",type:"bytes32"},{indexed:!1,name:"partnerA",type:"address"},{indexed:!1,name:"partnerB",type:"address"},{indexed:!1,name:"amountB",type:"uint256"}],name:"DepositFalture",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"channleId",type:"bytes32"},{indexed:!1,name:"partnerA",type:"address"},{indexed:!1,name:"partnerB",type:"address"},{indexed:!1,name:"amountB",type:"uint256"}],name:"UpdateDeposit",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"channleId",type:"bytes32"},{indexed:!1,name:"closer",type:"address"},{indexed:!1,name:"amount1",type:"uint256"},{indexed:!1,name:"partner",type:"address"},{indexed:!1,name:"amount2",type:"uint256"}],name:"QuickCloseChannel",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"channleId",type:"bytes32"},{indexed:!1,name:"closer",type:"address"},{indexed:!1,name:"partner",type:"address"}],name:"CloseChannel",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"channleId",type:"bytes32"},{indexed:!1,name:"partnerA",type:"address"},{indexed:!1,name:"amountA",type:"uint256"},{indexed:!1,name:"partnerB",type:"address"},{indexed:!1,name:"amountB",type:"uint256"}],name:"UpdateTransaction",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"channleId",type:"bytes32"},{indexed:!1,name:"sender",type:"address"},{indexed:!1,name:"amount",type:"uint256"}],name:"Settle",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"re_addr",type:"address"}],name:"Logger",type:"event"},{inputs:[{name:"token_address",type:"address"},{name:"Timeout",type:"uint256"}],payable:!0,stateMutability:"payable",type:"constructor"},{constant:!0,inputs:[{name:"channelId",type:"bytes32"}],name:"getChannelBalance",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"channelId",type:"bytes32"}],name:"getChannelById",outputs:[{name:"channelCloser",type:"address"},{name:"channelSettler",type:"address"},{name:"timeLockVerifier",type:"address"},{name:"partner1",type:"address"},{name:"partner2",type:"address"},{name:"channelTotalBalance",type:"uint256"},{name:"closingNonce",type:"uint256"},{name:"withdrawNonce",type:"uint256"},{name:"expectedSettleBlock",type:"uint256"},{name:"closerSettleBalance",type:"uint256"},{name:"partnerSettleBalance",type:"uint256"},{name:"channelStatus",type:"uint8"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"getChannelCount",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"Mytoken",outputs:[{name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"trinityData",outputs:[{name:"channelNumber",type:"uint8"},{name:"settleTimeout",type:"uint256"},{name:"contractOwner",type:"address"}],payable:!1,stateMutability:"view",type:"function"}],rpcIp:"",walletInfo:{keyStore:"",publicKey:"",address:""},balanceData:{Chain:{TNC:0,ETH:0},Channel:{TNC:0,ETH:0}},channelList:[],addChannelInfo:[],closeChannelInfo:[],contactList:{},FoundertxDataSign:""},getters:{channelList:e=>!e.channelList},mutations:{switch_dialog(e){e.show=!e.show}},actions:{switch_dialog(e){e.commit("switch_dialog")}}});a.default.use(ce.a);var ge=new ce.a.Store({modules:{vuexStore:fe}});a.default.use(le.a),a.default.use(ce.a),a.default.config.productionTip=!1,new a.default({el:"#app",router:re,store:ge,i18n:ve,components:{App:x},template:"<App/>"})},PH7Z:function(e,t,n){"use strict";(function(e){t.a={name:"loginByKeyStoreForm",data:()=>({fileList:[],keyStoreContent:"",keyStorePass:""}),mounted(){this.$nextTick(function(){})},methods:{handleChange(e,t){var n=this;if(e.raw){let t=new FileReader;t.onload=function(e){n.keyStoreContent=JSON.parse(e.target.result),40!==n.keyStoreContent.address.length&&(n.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"KeyStore文件读取错误",duration:3e3}),n.keyStoreContent="")},t.readAsText(e.raw,"gb2312")}},login(){if(""==this.keyStoreContent)return this.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"KeyStore文件不能为空",duration:3e3}),!1;if(""==this.keyStoreContent)return this.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"密码不能为空",duration:3e3}),!1;let e=this.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)",target:document.querySelector(".loginByKeyStoreContentBox")}),t=this;setTimeout(function(){t.loginByKeyStore(),e.close()},2e3)},loginByKeyStore(){let t;try{t=web3.eth.accounts.decrypt(this.keyStoreContent,this.keyStorePass)}catch(e){return"Key derivation failed - possibly wrong password"==e.message?(this.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"钱包解锁失败 - 可能是密码错误",duration:3e3}),!1):(this.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:e.message,duration:3e3}),!1)}let n=new e(t.privateKey.substring(2),"hex").toString("hex"),a=web3.eth.accounts.privateKeyToAccount("0x"+n).address;a=web3.utils.toChecksumAddress(a),web3.utils.checkAddressChecksum(a)?(this.$store.state.vuexStore.walletInfo.keyStore=this.keyStoreContent,this.$store.state.vuexStore.walletInfo.address=a,this.$store.state.vuexStore.isLogin=!0,this.$notify({title:"成功",dangerouslyUseHTMLString:!0,message:"导入成功",duration:3e3,type:"success"}),this.$router.push("/"),this.$store.state.vuexStore.activeNavIndex="1-1"):this.$notify.error({title:"警告",dangerouslyUseHTMLString:!0,message:"导入失败，请确认KeyStore和密码正确",duration:3e3}),this.keyStoreContent="",this.keyStorePass=""}}}}).call(t,n("EuP9").Buffer)},QRuK:function(e,t){},TehK:function(e,t){},oM9L:function(e,t){},pOFe:function(e,t){},piej:function(e,t){},"r/t0":function(e,t){},tvR6:function(e,t){},uBob:function(e,t){},uEPo:function(e,t){},z7CD:function(e,t){}},["NHnr"]);